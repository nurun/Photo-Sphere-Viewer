{"version":3,"file":"photo-sphere-viewer.js","sources":["../src/data/constants.js","../src/utils/browser.js","../src/utils/math.js","../src/utils/misc.js","../src/PSVError.js","../src/utils/psv.js","../src/utils/index.js","../src/Animation.js","../src/components/AbstractComponent.js","../src/buttons/AbstractButton.js","../src/buttons/AutorotateButton.js","../src/buttons/CustomButton.js","../src/buttons/DownloadButton.js","../src/buttons/FullscreenButton.js","../src/templates/menu.js","../src/buttons/MenuButton.js","../src/data/system.js","../src/buttons/AbstractZoomButton.js","../src/buttons/ZoomInButton.js","../src/buttons/ZoomOutButton.js","../src/buttons/ZoomRangeButton.js","../src/data/config.js","../src/buttons/CaptionButton.js","../src/components/NavbarCaption.js","../src/components/Navbar.js","../src/plugins/AbstractPlugin.js","../src/components/Loader.js","../src/components/Notification.js","../src/components/Overlay.js","../src/components/Panel.js","../src/services/AbstractService.js","../src/services/DataHelper.js","../src/services/EventsHandler.js","../src/services/Renderer.js","../src/services/TextureLoader.js","../src/components/Tooltip.js","../src/services/TooltipRenderer.js","../src/Viewer.js"],"sourcesContent":["/**\r\n * @namespace PSV.constants\r\n */\r\n\r\n/**\r\n * @summary Number of pixels bellow which a mouse move will be considered as a click\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const MOVE_THRESHOLD = 4;\r\n\r\n/**\r\n * @summary Delay in milliseconds between two clicks to consider a double click\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const DBLCLICK_DELAY = 300;\r\n\r\n/**\r\n * @summary Delay in milliseconds to emulate a long touch\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const LONGTOUCH_DELAY = 500;\r\n\r\n/**\r\n * @summary Delay in milliseconds to for the two fingers overlay to appear\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const TWOFINGERSOVERLAY_DELAY = 100;\r\n\r\n/**\r\n * @summary Time size of the mouse position history used to compute inertia\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const INERTIA_WINDOW = 300;\r\n\r\n/**\r\n * @summary Radius of the THREE.SphereGeometry, Half-length of the THREE.BoxGeometry\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const SPHERE_RADIUS = 100;\r\n\r\n/**\r\n * @summary Number of vertice of the THREE.SphereGeometry\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const SPHERE_VERTICES = 64;\r\n\r\n/**\r\n * @summary Number of vertices of each side of the THREE.BoxGeometry\r\n * @memberOf PSV.constants\r\n * @type {number}\r\n * @constant\r\n */\r\nexport const CUBE_VERTICES = 8;\r\n\r\n/**\r\n * @summary Order of cube textures for arrays\r\n * @memberOf PSV.constants\r\n * @type {number[]}\r\n * @constant\r\n */\r\nexport const CUBE_MAP = [0, 2, 4, 5, 3, 1];\r\n\r\n/**\r\n * @summary Order of cube textures for maps\r\n * @memberOf PSV.constants\r\n * @type {string[]}\r\n * @constant\r\n */\r\nexport const CUBE_HASHMAP = ['left', 'right', 'top', 'bottom', 'back', 'front'];\r\n\r\n/**\r\n * @summary Property name added to buttons list\r\n * @memberOf PSV.constants\r\n * @type {string}\r\n * @constant\r\n */\r\nexport const BUTTON_DATA = 'psvButton';\r\n\r\n/**\r\n * @summary Property name added to viewer element\r\n * @memberOf PSV.constants\r\n * @type {string}\r\n * @constant\r\n */\r\nexport const VIEWER_DATA = 'photoSphereViewer';\r\n\r\n/**\r\n * @summary Available actions\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const ACTIONS = {\r\n  ROTATE_LAT_UP    : 'rotateLatitudeUp',\r\n  ROTATE_LAT_DOWN  : 'rotateLatitudeDown',\r\n  ROTATE_LONG_RIGHT: 'rotateLongitudeRight',\r\n  ROTATE_LONG_LEFT : 'rotateLongitudeLeft',\r\n  ZOOM_IN          : 'zoomIn',\r\n  ZOOM_OUT         : 'zoomOut',\r\n  TOGGLE_AUTOROTATE: 'toggleAutorotate',\r\n};\r\n\r\n/**\r\n * @summary Available events names\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const EVENTS = {\r\n  /**\r\n   * @event autorotate\r\n   * @memberof PSV\r\n   * @summary Triggered when the automatic rotation is enabled/disabled\r\n   * @param {boolean} enabled\r\n   */\r\n  AUTOROTATE        : 'autorotate',\r\n  /**\r\n   * @event before-render\r\n   * @memberof PSV\r\n   * @summary Triggered before a render, used to modify the view\r\n   * @param {number} timestamp - time provided by requestAnimationFrame\r\n   */\r\n  BEFORE_RENDER     : 'before-render',\r\n  /**\r\n   * @event before-rotate\r\n   * @memberOf PSV\r\n   * @summary Triggered before a rotate operation, can be cancelled\r\n   * @param {PSV.ExtendedPosition}\r\n   */\r\n  BEFORE_ROTATE     : 'before-rotate',\r\n  /**\r\n   * @event click\r\n   * @memberof PSV\r\n   * @summary Triggered when the user clicks on the viewer (everywhere excluding the navbar and the side panel)\r\n   * @param {PSV.ClickData} data\r\n   */\r\n  CLICK             : 'click',\r\n  /**\r\n   * @event close-panel\r\n   * @memberof PSV\r\n   * @summary Trigered when the panel is closed\r\n   * @param {string} [id]\r\n   */\r\n  CLOSE_PANEL       : 'close-panel',\r\n  /**\r\n   * @event config-changed\r\n   * @memberOf PSV\r\n   * @summary Triggered after a call to setOption/setOptions\r\n   * @param {string[]} name of changed options\r\n   */\r\n  CONFIG_CHANGED    : 'config-changed',\r\n  /**\r\n   * @event dblclick\r\n   * @memberof PSV\r\n   * @summary Triggered when the user double clicks on the viewer. The simple `click` event is always fired before `dblclick`\r\n   * @param {PSV.ClickData} data\r\n   */\r\n  DOUBLE_CLICK      : 'dblclick',\r\n  /**\r\n   * @event fullscreen-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the fullscreen mode is enabled/disabled\r\n   * @param {boolean} enabled\r\n   */\r\n  FULLSCREEN_UPDATED: 'fullscreen-updated',\r\n  /**\r\n   * @event hide-notification\r\n   * @memberof PSV\r\n   * @summary Trigered when the notification is hidden\r\n   */\r\n  HIDE_NOTIFICATION : 'hide-notification',\r\n  /**\r\n   * @event hide-overlay\r\n   * @memberof PSV\r\n   * @summary Trigered when the overlay is hidden\r\n   * @param {string} [id]\r\n   */\r\n  HIDE_OVERLAY      : 'hide-overlay',\r\n  /**\r\n   * @event hide-tooltip\r\n   * @memberof PSV\r\n   * @summary Trigered when the tooltip is hidden\r\n   * @param {*} Data associated to this tooltip\r\n   */\r\n  HIDE_TOOLTIP      : 'hide-tooltip',\r\n  /**\r\n   * @event open-panel\r\n   * @memberof PSV\r\n   * @summary Triggered when the panel is opened\r\n   * @param {string} [id]\r\n   */\r\n  OPEN_PANEL        : 'open-panel',\r\n  /**\r\n   * @event panorama-loaded\r\n   * @memberof PSV\r\n   * @summary Triggered when a panorama image has been loaded\r\n   */\r\n  PANORAMA_LOADED   : 'panorama-loaded',\r\n  /**\r\n   * @event position-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the view longitude and/or latitude changes\r\n   * @param {PSV.Position} position\r\n   */\r\n  POSITION_UPDATED  : 'position-updated',\r\n  /**\r\n   * @event ready\r\n   * @memberof PSV\r\n   * @summary Triggered when the panorama image has been loaded and the viewer is ready to perform the first render\r\n   */\r\n  READY             : 'ready',\r\n  /**\r\n   * @event render\r\n   * @memberof PSV\r\n   * @summary Triggered on each viewer render, **this event is triggered very often**\r\n   */\r\n  RENDER            : 'render',\r\n  /**\r\n   * @event show-notification\r\n   * @memberof PSV\r\n   * @summary Trigered when the notification is shown\r\n   */\r\n  SHOW_NOTIFICATION : 'show-notification',\r\n  /**\r\n   * @event show-overlay\r\n   * @memberof PSV\r\n   * @summary Trigered when the overlay is shown\r\n   * @param {string} [id]\r\n   */\r\n  SHOW_OVERLAY      : 'show-overlay',\r\n  /**\r\n   * @event show-tooltip\r\n   * @memberof PSV\r\n   * @summary Trigered when the tooltip is shown\r\n   * @param {*} Data associated to this tooltip\r\n   * @param {PSV.components.Tooltip} Instance of the tooltip\r\n   */\r\n  SHOW_TOOLTIP      : 'show-tooltip',\r\n  /**\r\n   * @event size-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the viewer size changes\r\n   * @param {PSV.Size} size\r\n   */\r\n  SIZE_UPDATED      : 'size-updated',\r\n  /**\r\n   * @event stop-all\r\n   * @memberof PSV\r\n   * @summary Triggered when all current animations are stopped\r\n   */\r\n  STOP_ALL          : 'stop-all',\r\n  /**\r\n   * @event zoom-updated\r\n   * @memberof PSV\r\n   * @summary Triggered when the zoom level changes\r\n   * @param {number} zoomLevel\r\n   */\r\n  ZOOM_UPDATED      : 'zoom-updated',\r\n};\r\n\r\n/**\r\n * @summary Available change events names\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const CHANGE_EVENTS = {\r\n  /**\r\n   * @event get-animate-position\r\n   * @memberof PSV\r\n   * @param {Position} position\r\n   * @returns {Position}\r\n   * @summary Called to alter the target position of an animation\r\n   */\r\n  GET_ANIMATE_POSITION: 'get-animate-position',\r\n  /**\r\n   * @event get-rotate-position\r\n   * @memberof PSV\r\n   * @param {Position} position\r\n   * @returns {Position}\r\n   * @summary Called to alter the target position of a rotation\r\n   */\r\n  GET_ROTATE_POSITION : 'get-rotate-position',\r\n};\r\n\r\n/**\r\n * @summary Internal identifiers for various stuff\r\n * @memberOf PSV.constants\r\n * @enum {string}\r\n * @constant\r\n */\r\nexport const IDS = {\r\n  MENU       : 'menu',\r\n  TWO_FINGERS: 'twoFingers',\r\n  ERROR      : 'error',\r\n};\r\n\r\n/* eslint-disable */\r\n// @formatter:off\r\n/**\r\n * @summary Collection of easing functions\r\n * @memberOf PSV.constants\r\n * @see {@link https://gist.github.com/frederickk/6165768}\r\n * @type {Object<string, Function>}\r\n * @constant\r\n */\r\nexport const EASINGS = {\r\n  linear    : (t) => t,\r\n\r\n  inQuad    : (t) => t*t,\r\n  outQuad   : (t) => t*(2-t),\r\n  inOutQuad : (t) => t<.5 ? 2*t*t : -1+(4-2*t)*t,\r\n\r\n  inCubic   : (t) => t*t*t,\r\n  outCubic  : (t) => (--t)*t*t+1,\r\n  inOutCubic: (t) => t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1,\r\n\r\n  inQuart   : (t) => t*t*t*t,\r\n  outQuart  : (t) => 1-(--t)*t*t*t,\r\n  inOutQuart: (t) => t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t,\r\n\r\n  inQuint   : (t) => t*t*t*t*t,\r\n  outQuint  : (t) => 1+(--t)*t*t*t*t,\r\n  inOutQuint: (t) => t<.5 ? 16*t*t*t*t*t : 1+16*(--t)*t*t*t*t,\r\n\r\n  inSine    : (t) => 1-Math.cos(t*(Math.PI/2)),\r\n  outSine   : (t) => Math.sin(t*(Math.PI/2)),\r\n  inOutSine : (t) => .5-.5*Math.cos(Math.PI*t),\r\n\r\n  inExpo    : (t) => Math.pow(2, 10*(t-1)),\r\n  outExpo   : (t) => 1-Math.pow(2, -10*t),\r\n  inOutExpo : (t) => (t=t*2-1)<0 ? .5*Math.pow(2, 10*t) : 1-.5*Math.pow(2, -10*t),\r\n\r\n  inCirc    : (t) => 1-Math.sqrt(1-t*t),\r\n  outCirc   : (t) => Math.sqrt(1-(t-1)*(t-1)),\r\n  inOutCirc : (t) => (t*=2)<1 ? .5-.5*Math.sqrt(1-t*t) : .5+.5*Math.sqrt(1-(t-=2)*t)\r\n};\r\n// @formatter:on\r\n/* eslint-enable */\r\n","/**\r\n * @summary Toggles a CSS class\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement|SVGElement} element\r\n * @param {string} className\r\n * @param {boolean} [active] - forced state\r\n */\r\nexport function toggleClass(element, className, active) {\r\n  // manual implementation for IE11 and SVGElement\r\n  if (!element.classList) {\r\n    let currentClassName = element.getAttribute('class') || '';\r\n    const currentActive = currentClassName.indexOf(className) !== -1;\r\n    const regex = new RegExp('(?:^|\\\\s)' + className + '(?:\\\\s|$)');\r\n\r\n    if ((active === undefined || active) && !currentActive) {\r\n      currentClassName += currentClassName.length > 0 ? ' ' + className : className;\r\n    }\r\n    else if (!active) {\r\n      currentClassName = currentClassName.replace(regex, ' ');\r\n    }\r\n\r\n    element.setAttribute('class', currentClassName);\r\n  }\r\n  else if (active === undefined) {\r\n    element.classList.toggle(className);\r\n  }\r\n  else if (active && !element.classList.contains(className)) {\r\n    element.classList.add(className);\r\n  }\r\n  else if (!active) {\r\n    element.classList.remove(className);\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Adds one or several CSS classes to an element\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} element\r\n * @param {string} className\r\n */\r\nexport function addClasses(element, className) {\r\n  if (className) {\r\n    className.split(' ').forEach((name) => {\r\n      toggleClass(element, name, true);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Removes one or several CSS classes to an element\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} element\r\n * @param {string} className\r\n */\r\nexport function removeClasses(element, className) {\r\n  if (className) {\r\n    className.split(' ').forEach((name) => {\r\n      toggleClass(element, name, false);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Searches if an element has a particular parent at any level including itself\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} el\r\n * @param {HTMLElement} parent\r\n * @returns {boolean}\r\n */\r\nexport function hasParent(el, parent) {\r\n  let test = el;\r\n\r\n  do {\r\n    if (test === parent) {\r\n      return true;\r\n    }\r\n    test = test.parentNode;\r\n  } while (test);\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * @summary Gets the closest parent (can by itself)\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement|SVGElement} el\r\n * @param {string} selector\r\n * @returns {HTMLElement}\r\n */\r\nexport function getClosest(el, selector) {\r\n  const matches = el.matches || el.msMatchesSelector;\r\n  let test = el;\r\n  // When el is document or window, the matches does not exist\r\n  if (!matches) {\r\n    return null;\r\n  }\r\n\r\n  do {\r\n    if (matches.bind(test)(selector)) {\r\n      return test;\r\n    }\r\n    test = test instanceof SVGElement ? test.parentNode : test.parentElement;\r\n  } while (test);\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * @summary Map between keyboard events `keyCode|which` and `key`\r\n * @memberOf PSV.utils\r\n * @type {Object<int, string>}\r\n * @readonly\r\n * @private\r\n */\r\nconst KEYMAP = {\r\n  13 : 'Enter',\r\n  27 : 'Escape',\r\n  32 : ' ',\r\n  33 : 'PageUp',\r\n  34 : 'PageDown',\r\n  37 : 'ArrowLeft',\r\n  38 : 'ArrowUp',\r\n  39 : 'ArrowRight',\r\n  40 : 'ArrowDown',\r\n  46 : 'Delete',\r\n  107: '+',\r\n  109: '-',\r\n};\r\n\r\n/**\r\n * @summary Map for non standard keyboard events `key` for IE and Edge\r\n * @see https://github.com/shvaikalesh/shim-keyboard-event-key\r\n * @type {Object<string, string>}\r\n * @readonly\r\n * @private\r\n */\r\nconst MS_KEYMAP = {\r\n  Add     : '+',\r\n  Del     : 'Delete',\r\n  Down    : 'ArrowDown',\r\n  Esc     : 'Escape',\r\n  Left    : 'ArrowLeft',\r\n  Right   : 'ArrowRight',\r\n  Spacebar: ' ',\r\n  Subtract: '-',\r\n  Up      : 'ArrowUp',\r\n};\r\n\r\n/**\r\n * @summary Returns the key name of a KeyboardEvent\r\n * @memberOf PSV.utils\r\n * @param {KeyboardEvent} evt\r\n * @returns {string}\r\n */\r\nexport function getEventKey(evt) {\r\n  let key = evt.key || KEYMAP[evt.keyCode || evt.which];\r\n\r\n  if (key && MS_KEYMAP[key]) {\r\n    key = MS_KEYMAP[key];\r\n  }\r\n\r\n  return key;\r\n}\r\n\r\n/**\r\n * @summary Detects if fullscreen is enabled\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} elt\r\n * @returns {boolean}\r\n */\r\nexport function isFullscreenEnabled(elt) {\r\n  /* eslint-disable-next-line max-len */\r\n  return (document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement) === elt;\r\n}\r\n\r\n/**\r\n * @summary Enters fullscreen mode\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} elt\r\n */\r\nexport function requestFullscreen(elt) {\r\n  /* eslint-disable-next-line max-len */\r\n  (elt.requestFullscreen || elt.mozRequestFullScreen || elt.webkitRequestFullscreen || elt.msRequestFullscreen).call(elt);\r\n}\r\n\r\n/**\r\n * @summary Exits fullscreen mode\r\n * @memberOf PSV.utils\r\n */\r\nexport function exitFullscreen() {\r\n  /* eslint-disable-next-line max-len */\r\n  (document.exitFullscreen || document.mozCancelFullScreen || document.webkitExitFullscreen || document.msExitFullscreen).call(document);\r\n}\r\n\r\n/**\r\n * @summary Gets an element style\r\n * @memberOf PSV.utils\r\n * @param {HTMLElement} elt\r\n * @param {string} prop\r\n * @returns {*}\r\n */\r\nexport function getStyle(elt, prop) {\r\n  return window.getComputedStyle(elt, null)[prop];\r\n}\r\n\r\n/**\r\n * @summary Normalize mousewheel values accross browsers\r\n * @memberOf PSV.utils\r\n * @description From Facebook's Fixed Data Table\r\n * {@link https://github.com/facebookarchive/fixed-data-table/blob/master/src/vendor_upstream/dom/normalizeWheel.js}\r\n * @copyright Facebook\r\n * @param {MouseWheelEvent} event\r\n * @returns {{spinX: number, spinY: number, pixelX: number, pixelY: number}}\r\n */\r\nexport function normalizeWheel(event) {\r\n  const PIXEL_STEP = 10;\r\n  const LINE_HEIGHT = 40;\r\n  const PAGE_HEIGHT = 800;\r\n\r\n  let spinX = 0;\r\n  let spinY = 0;\r\n  let pixelX = 0;\r\n  let pixelY = 0;\r\n\r\n  // Legacy\r\n  if ('detail' in event) {\r\n    spinY = event.detail;\r\n  }\r\n  if ('wheelDelta' in event) {\r\n    spinY = -event.wheelDelta / 120;\r\n  }\r\n  if ('wheelDeltaY' in event) {\r\n    spinY = -event.wheelDeltaY / 120;\r\n  }\r\n  if ('wheelDeltaX' in event) {\r\n    spinX = -event.wheelDeltaX / 120;\r\n  }\r\n\r\n  // side scrolling on FF with DOMMouseScroll\r\n  if ('axis' in event && event.axis === event.HORIZONTAL_AXIS) {\r\n    spinX = spinY;\r\n    spinY = 0;\r\n  }\r\n\r\n  pixelX = spinX * PIXEL_STEP;\r\n  pixelY = spinY * PIXEL_STEP;\r\n\r\n  if ('deltaY' in event) {\r\n    pixelY = event.deltaY;\r\n  }\r\n  if ('deltaX' in event) {\r\n    pixelX = event.deltaX;\r\n  }\r\n\r\n  if ((pixelX || pixelY) && event.deltaMode) {\r\n    // delta in LINE units\r\n    if (event.deltaMode === 1) {\r\n      pixelX *= LINE_HEIGHT;\r\n      pixelY *= LINE_HEIGHT;\r\n    }\r\n    // delta in PAGE units\r\n    else {\r\n      pixelX *= PAGE_HEIGHT;\r\n      pixelY *= PAGE_HEIGHT;\r\n    }\r\n  }\r\n\r\n  // Fall-back if spin cannot be determined\r\n  if (pixelX && !spinX) {\r\n    spinX = (pixelX < 1) ? -1 : 1;\r\n  }\r\n  if (pixelY && !spinY) {\r\n    spinY = (pixelY < 1) ? -1 : 1;\r\n  }\r\n\r\n  return { spinX, spinY, pixelX, pixelY };\r\n}\r\n","/**\r\n * @summary Ensures that a number is in a given interval\r\n * @memberOf PSV.utils\r\n * @param {number} x\r\n * @param {number} min\r\n * @param {number} max\r\n * @returns {number}\r\n */\r\nexport function bound(x, min, max) {\r\n  return Math.max(min, Math.min(max, x));\r\n}\r\n\r\n/**\r\n * @summary Checks if a value is an integer\r\n * @memberOf PSV.utils\r\n * @param {*} value\r\n * @returns {boolean}\r\n */\r\nexport function isInteger(value) {\r\n  if (Number.isInteger) {\r\n    return Number.isInteger(value);\r\n  }\r\n  return typeof value === 'number' && Number.isFinite(value) && Math.floor(value) === value;\r\n}\r\n\r\n\r\n/**\r\n * @summary Computes the sum of an array\r\n * @memberOf PSV.utils\r\n * @param {number[]} array\r\n * @returns {number}\r\n */\r\nexport function sum(array) {\r\n  return array.reduce((a, b) => a + b, 0);\r\n}\r\n\r\n/**\r\n * @summary Computes the distance between two points\r\n * @memberOf PSV.utils\r\n * @param {PSV.Point} p1\r\n * @param {PSV.Point} p2\r\n * @returns {number}\r\n */\r\nexport function distance(p1, p2) {\r\n  return Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));\r\n}\r\n\r\n/**\r\n * @summary Compute the shortest offset between two longitudes\r\n * @memberOf PSV.utils\r\n * @param {number} from\r\n * @param {number} to\r\n * @returns {number}\r\n */\r\nexport function getShortestArc(from, to) {\r\n  const tCandidates = [\r\n    0, // direct\r\n    Math.PI * 2, // clock-wise cross zero\r\n    -Math.PI * 2, // counter-clock-wise cross zero\r\n  ];\r\n\r\n  return tCandidates.reduce((value, candidate) => {\r\n    const newCandidate = to - from + candidate;\r\n    return Math.abs(newCandidate) < Math.abs(value) ? newCandidate : value;\r\n  }, Infinity);\r\n}\r\n\r\n/**\r\n * @summary Computes the angle between the current position and a target position\r\n * @memberOf PSV.utils\r\n * @param {PSV.Position} position1\r\n * @param {PSV.Position} position2\r\n * @returns {number}\r\n */\r\nexport function getAngle(position1, position2) {\r\n  return Math.acos(\r\n    Math.cos(position1.latitude)\r\n    * Math.cos(position2.latitude)\r\n    * Math.cos(position1.longitude - position2.longitude)\r\n    + Math.sin(position1.latitude)\r\n    * Math.sin(position2.latitude)\r\n  );\r\n}\r\n\r\n/**\r\n * Returns the distance between two points on a sphere of radius one\r\n * @memberOf PSV.utils\r\n * @param {number[]} p1\r\n * @param {number[]} p2\r\n * @returns {number}\r\n */\r\nexport function greatArcDistance(p1, p2) {\r\n  const [λ1, φ1] = p1;\r\n  const [λ2, φ2] = p2;\r\n\r\n  const x = (λ2 - λ1) * Math.cos((φ1 + φ2) / 2);\r\n  const y = (φ2 - φ1);\r\n  return Math.sqrt(x * x + y * y);\r\n}\r\n","/**\r\n * @summary Transforms a string to dash-case{@link https://github.com/shahata/dasherize}\r\n * @memberOf PSV.utils\r\n * @param {string} str\r\n * @returns {string}\r\n */\r\nexport function dasherize(str) {\r\n  return str.replace(/[A-Z](?:(?=[^A-Z])|[A-Z]*(?=[A-Z][^A-Z]|$))/g, (s, i) => {\r\n    return (i > 0 ? '-' : '') + s.toLowerCase();\r\n  });\r\n}\r\n\r\n/**\r\n * @summary Returns a function, that, when invoked, will only be triggered at most once during a given window of time.\r\n * @memberOf PSV.utils\r\n * @copyright underscore.js - modified by Clément Prévost {@link http://stackoverflow.com/a/27078401}\r\n * @param {Function} func\r\n * @param {number} wait\r\n * @returns {Function}\r\n */\r\nexport function throttle(func, wait) {\r\n  /* eslint-disable */\r\n  let self, args, result;\r\n  let timeout;\r\n  let previous = 0;\r\n  const later = function() {\r\n    previous = Date.now();\r\n    timeout = undefined;\r\n    result = func.apply(self, args);\r\n    if (!timeout) {\r\n      self = args = null;\r\n    }\r\n  };\r\n  return function() {\r\n    const now = Date.now();\r\n    if (!previous) {\r\n      previous = now;\r\n    }\r\n    const remaining = wait - (now - previous);\r\n    self = this;\r\n    args = arguments;\r\n    if (remaining <= 0 || remaining > wait) {\r\n      if (timeout) {\r\n        clearTimeout(timeout);\r\n        timeout = undefined;\r\n      }\r\n      previous = now;\r\n      result = func.apply(self, args);\r\n      if (!timeout) {\r\n        self = args = null;\r\n      }\r\n    }\r\n    else if (!timeout) {\r\n      timeout = setTimeout(later, remaining);\r\n    }\r\n    return result;\r\n  };\r\n  /* eslint-enable */\r\n}\r\n\r\n/**\r\n * @summary Test if an object is a plain object\r\n * @memberOf PSV.utils\r\n * @description Test if an object is a plain object, i.e. is constructed\r\n * by the built-in Object constructor and inherits directly from Object.prototype\r\n * or null. Some built-in objects pass the test, e.g. Math which is a plain object\r\n * and some host or exotic objects may pass also.\r\n * {@link http://stackoverflow.com/a/5878101/1207670}\r\n * @param {*} obj\r\n * @returns {boolean}\r\n */\r\nexport function isPlainObject(obj) {\r\n  // Basic check for Type object that's not null\r\n  if (typeof obj === 'object' && obj !== null) {\r\n    // If Object.getPrototypeOf supported, use it\r\n    if (typeof Object.getPrototypeOf === 'function') {\r\n      const proto = Object.getPrototypeOf(obj);\r\n      return proto === Object.prototype || proto === null;\r\n    }\r\n\r\n    // Otherwise, use internal class\r\n    // This should be reliable as if getPrototypeOf not supported, is pre-ES5\r\n    return Object.prototype.toString.call(obj) === '[object Object]';\r\n  }\r\n\r\n  // Not an object\r\n  return false;\r\n}\r\n\r\n/**\r\n * @summary Merges the enumerable attributes of two objects\r\n * @memberOf PSV.utils\r\n * @description Replaces arrays and alters the target object.\r\n * @copyright Nicholas Fisher <nfisher110@gmail.com>\r\n * @param {Object} target\r\n * @param {Object} src\r\n * @returns {Object} target\r\n */\r\nexport function deepmerge(target, src) {\r\n  /* eslint-disable */\r\n  let first = src;\r\n\r\n  return (function merge(target, src) {\r\n    if (Array.isArray(src)) {\r\n      if (!target || !Array.isArray(target)) {\r\n        target = [];\r\n      }\r\n      else {\r\n        target.length = 0;\r\n      }\r\n      src.forEach(function(e, i) {\r\n        target[i] = merge(null, e);\r\n      });\r\n    }\r\n    else if (typeof src === 'object') {\r\n      if (!target || Array.isArray(target)) {\r\n        target = {};\r\n      }\r\n      Object.keys(src).forEach(function(key) {\r\n        if (typeof src[key] !== 'object' || !src[key] || !isPlainObject(src[key])) {\r\n          target[key] = src[key];\r\n        }\r\n        else if (src[key] != first) {\r\n          if (!target[key]) {\r\n            target[key] = merge(null, src[key]);\r\n          }\r\n          else {\r\n            merge(target[key], src[key]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      target = src;\r\n    }\r\n\r\n    return target;\r\n  }(target, src));\r\n  /* eslint-enable */\r\n}\r\n\r\n/**\r\n * @summary Deeply clones an object\r\n * @memberOf PSV.utils\r\n * @param {Object} src\r\n * @returns {Object}\r\n */\r\nexport function clone(src) {\r\n  return deepmerge(null, src);\r\n}\r\n\r\n/**\r\n * @summery Test of an object is empty\r\n * @memberOf PSV.utils\r\n * @param {object} obj\r\n * @returns {boolean}\r\n */\r\nexport function isEmpty(obj) {\r\n  return !obj || (Object.keys(obj).length === 0 && obj.constructor === Object);\r\n}\r\n\r\n/**\r\n * @summary Loops over enumerable properties of an object\r\n * @memberOf PSV.utils\r\n * @param {Object} object\r\n * @param {Function} callback\r\n */\r\nexport function each(object, callback) {\r\n  Object.keys(object).forEach((key) => {\r\n    callback(object[key], key);\r\n  });\r\n}\r\n\r\n/**\r\n * @summary Returns the intersection between two arrays\r\n * @memberOf PSV.utils\r\n * @template T\r\n * @param {T[]} array1\r\n * @param {T[]} array2\r\n * @returns {T[]}\r\n */\r\nexport function intersect(array1, array2) {\r\n  return array1.filter(value => array2.indexOf(value) !== -1);\r\n}\r\n","/**\r\n * @summary Custom error used in the lib\r\n * @param {string} message\r\n * @constructor\r\n * @memberOf PSV\r\n */\r\nfunction PSVError(message) {\r\n  this.message = message;\r\n\r\n  // Use V8's native method if available, otherwise fallback\r\n  if ('captureStackTrace' in Error) {\r\n    Error.captureStackTrace(this, PSVError);\r\n  }\r\n  else {\r\n    this.stack = (new Error()).stack;\r\n  }\r\n}\r\n\r\nPSVError.prototype = Object.create(Error.prototype);\r\nPSVError.prototype.name = 'PSVError';\r\nPSVError.prototype.constructor = PSVError;\r\n\r\nexport { PSVError };\r\n","import * as THREE from 'three';\r\nimport { PSVError } from '../PSVError';\r\nimport { bound } from './math';\r\n\r\n/**\r\n * @summary Displays a warning in the console\r\n * @memberOf PSV.utils\r\n * @param {string} message\r\n */\r\nexport function logWarn(message) {\r\n  console.warn(`PhotoSphereViewer: ${message}`);\r\n}\r\n\r\n/**\r\n * @summary Returns the value of a given attribute in the panorama metadata\r\n * @memberOf PSV.utils\r\n * @param {string} data\r\n * @param {string} attr\r\n * @returns (string)\r\n */\r\nexport function getXMPValue(data, attr) {\r\n  // XMP data are stored in children\r\n  let result = data.match('<GPano:' + attr + '>(.*)</GPano:' + attr + '>');\r\n  if (result !== null) {\r\n    return result[1];\r\n  }\r\n\r\n  // XMP data are stored in attributes\r\n  result = data.match('GPano:' + attr + '=\"(.*?)\"');\r\n  if (result !== null) {\r\n    return result[1];\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * @readonly\r\n * @private\r\n * @type {{top: string, left: string, bottom: string, center: string, right: string}}\r\n */\r\nconst CSS_POSITIONS = {\r\n  top   : '0%',\r\n  bottom: '100%',\r\n  left  : '0%',\r\n  right : '100%',\r\n  center: '50%',\r\n};\r\n\r\n/**\r\n * @summary Translate CSS values like \"top center\" or \"10% 50%\" as top and left positions\r\n * @memberOf PSV.utils\r\n * @description The implementation is as close as possible to the \"background-position\" specification\r\n * {@link https://developer.mozilla.org/en-US/docs/Web/CSS/background-position}\r\n * @param {string|object} value\r\n * @returns {PSV.Point}\r\n */\r\nexport function parsePosition(value) {\r\n  if (!value) {\r\n    return { x: 0.5, y: 0.5 };\r\n  }\r\n\r\n  if (typeof value === 'object') {\r\n    return value;\r\n  }\r\n\r\n  let tokens = value.toLocaleLowerCase().split(' ').slice(0, 2);\r\n\r\n  if (tokens.length === 1) {\r\n    if (CSS_POSITIONS[tokens[0]] !== undefined) {\r\n      tokens = [tokens[0], 'center'];\r\n    }\r\n    else {\r\n      tokens = [tokens[0], tokens[0]];\r\n    }\r\n  }\r\n\r\n  const xFirst = tokens[1] !== 'left' && tokens[1] !== 'right' && tokens[0] !== 'top' && tokens[0] !== 'bottom';\r\n\r\n  tokens = tokens.map(token => CSS_POSITIONS[token] || token);\r\n\r\n  if (!xFirst) {\r\n    tokens.reverse();\r\n  }\r\n\r\n  const parsed = tokens.join(' ').match(/^([0-9.]+)% ([0-9.]+)%$/);\r\n\r\n  if (parsed) {\r\n    return {\r\n      x: parseFloat(parsed[1]) / 100,\r\n      y: parseFloat(parsed[2]) / 100,\r\n    };\r\n  }\r\n  else {\r\n    return { x: 0.5, y: 0.5 };\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Parses an speed\r\n * @memberOf PSV.utils\r\n * @param {string|number} speed - The speed, in radians/degrees/revolutions per second/minute\r\n * @returns {number} radians per second\r\n * @throws {PSV.PSVError} when the speed cannot be parsed\r\n */\r\nexport function parseSpeed(speed) {\r\n  let parsed;\r\n\r\n  if (typeof speed === 'string') {\r\n    const speedStr = speed.toString().trim();\r\n\r\n    // Speed extraction\r\n    let speedValue = parseFloat(speedStr.replace(/^(-?[0-9]+(?:\\.[0-9]*)?).*$/, '$1'));\r\n    const speedUnit = speedStr.replace(/^-?[0-9]+(?:\\.[0-9]*)?(.*)$/, '$1').trim();\r\n\r\n    // \"per minute\" -> \"per second\"\r\n    if (speedUnit.match(/(pm|per minute)$/)) {\r\n      speedValue /= 60;\r\n    }\r\n\r\n    // Which unit?\r\n    switch (speedUnit) {\r\n      // Degrees per minute / second\r\n      case 'dpm':\r\n      case 'degrees per minute':\r\n      case 'dps':\r\n      case 'degrees per second':\r\n        parsed = THREE.Math.degToRad(speedValue);\r\n        break;\r\n\r\n      // Radians per minute / second\r\n      case 'rdpm':\r\n      case 'radians per minute':\r\n      case 'rdps':\r\n      case 'radians per second':\r\n        parsed = speedValue;\r\n        break;\r\n\r\n      // Revolutions per minute / second\r\n      case 'rpm':\r\n      case 'revolutions per minute':\r\n      case 'rps':\r\n      case 'revolutions per second':\r\n        parsed = speedValue * Math.PI * 2;\r\n        break;\r\n\r\n      // Unknown unit\r\n      default:\r\n        throw new PSVError('Unknown speed unit \"' + speedUnit + '\"');\r\n    }\r\n  }\r\n  else {\r\n    parsed = speed;\r\n  }\r\n\r\n  return parsed;\r\n}\r\n\r\n/**\r\n * @summary Parses an angle value in radians or degrees and returns a normalized value in radians\r\n * @memberOf PSV.utils\r\n * @param {string|number} angle - eg: 3.14, 3.14rad, 180deg\r\n * @param {boolean} [zeroCenter=false] - normalize between -Pi - Pi instead of 0 - 2*Pi\r\n * @param {boolean} [halfCircle=zeroCenter] - normalize between -Pi/2 - Pi/2 instead of -Pi - Pi\r\n * @returns {number}\r\n * @throws {PSV.PSVError} when the angle cannot be parsed\r\n */\r\nexport function parseAngle(angle, zeroCenter = false, halfCircle = zeroCenter) {\r\n  let parsed;\r\n\r\n  if (typeof angle === 'string') {\r\n    const match = angle.toLowerCase().trim().match(/^(-?[0-9]+(?:\\.[0-9]*)?)(.*)$/);\r\n\r\n    if (!match) {\r\n      throw new PSVError('Unknown angle \"' + angle + '\"');\r\n    }\r\n\r\n    const value = parseFloat(match[1]);\r\n    const unit = match[2];\r\n\r\n    if (unit) {\r\n      switch (unit) {\r\n        case 'deg':\r\n        case 'degs':\r\n          parsed = THREE.Math.degToRad(value);\r\n          break;\r\n        case 'rad':\r\n        case 'rads':\r\n          parsed = value;\r\n          break;\r\n        default:\r\n          throw new PSVError('Unknown angle unit \"' + unit + '\"');\r\n      }\r\n    }\r\n    else {\r\n      parsed = value;\r\n    }\r\n  }\r\n  else if (typeof angle === 'number' && !Number.isNaN(angle)) {\r\n    parsed = angle;\r\n  }\r\n  else {\r\n    throw new PSVError('Unknown angle \"' + angle + '\"');\r\n  }\r\n\r\n  parsed = (zeroCenter ? parsed + Math.PI : parsed) % (Math.PI * 2);\r\n\r\n  if (parsed < 0) {\r\n    parsed += Math.PI * 2;\r\n  }\r\n\r\n  return zeroCenter ? bound(parsed - Math.PI, -Math.PI / (halfCircle ? 2 : 1), Math.PI / (halfCircle ? 2 : 1)) : parsed;\r\n}\r\n","/**\r\n * @namespace PSV.utils\r\n */\r\n\r\nexport * from './browser.js';\r\nexport * from './math.js';\r\nexport * from './misc.js';\r\nexport * from './psv.js';\r\n","import { EASINGS } from './data/constants';\r\nimport { each } from './utils';\r\n\r\n/**\r\n * @callback OnTick\r\n * @summary Function called for each animation frame with computed properties\r\n * @memberOf PSV.Animation\r\n * @param {Object.<string, number>} properties - current values\r\n * @param {float} progress - 0 to 1\r\n */\r\n\r\n/**\r\n * @summary Interpolation helper for animations\r\n * @memberOf PSV\r\n * @description\r\n * Implements the Promise API with an additional \"cancel\" and \"finally\" methods.\r\n * The promise is resolved when the animation is complete and rejected if the animation is cancelled.\r\n * @example\r\n * new Animation({\r\n *     properties: {\r\n *         width: {start: 100, end: 200}\r\n *     },\r\n *     duration: 5000,\r\n *     onTick: (properties) => element.style.width = `${properties.width}px`;\r\n * })\r\n */\r\nexport class Animation {\r\n\r\n  /**\r\n   * @param {Object} options\r\n   * @param {Object.<string, Object>} options.properties\r\n   * @param {number} options.properties[].start\r\n   * @param {number} options.properties[].end\r\n   * @param {number} options.duration\r\n   * @param {number} [options.delay=0]\r\n   * @param {string} [options.easing='linear']\r\n   * @param {PSV.Animation.OnTick} options.onTick - called on each frame\r\n   */\r\n  constructor(options) {\r\n    this.__cancelled = false;\r\n    this.__resolved = false;\r\n\r\n    this.__promise = new Promise((resolve, reject) => {\r\n      this.__resolve = resolve;\r\n      this.__reject = reject;\r\n    });\r\n\r\n    if (options) {\r\n      if (!options.easing || typeof options.easing === 'string') {\r\n        options.easing = EASINGS[options.easing || 'linear'];\r\n      }\r\n      this.__start = null;\r\n      this.options = options;\r\n\r\n      if (options.delay) {\r\n        this.__delayTimeout = setTimeout(() => {\r\n          this.__delayTimeout = null;\r\n          window.requestAnimationFrame(t => this.__run(t));\r\n        }, options.delay);\r\n      }\r\n      else {\r\n        window.requestAnimationFrame(t => this.__run(t));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Main loop for the animation\r\n   * @param {number} timestamp\r\n   * @private\r\n   */\r\n  __run(timestamp) {\r\n    // the animation has been cancelled\r\n    if (this.__cancelled) {\r\n      return;\r\n    }\r\n\r\n    // first iteration\r\n    if (this.__start === null) {\r\n      this.__start = timestamp;\r\n    }\r\n\r\n    // compute progress\r\n    const progress = (timestamp - this.__start) / this.options.duration;\r\n    const current = {};\r\n\r\n    if (progress < 1.0) {\r\n      // interpolate properties\r\n      each(this.options.properties, (prop, name) => {\r\n        if (prop) {\r\n          current[name] = prop.start + (prop.end - prop.start) * this.options.easing(progress);\r\n        }\r\n      });\r\n\r\n      this.options.onTick(current, progress);\r\n\r\n      window.requestAnimationFrame(t => this.__run(t));\r\n    }\r\n    else {\r\n      // call onTick one last time with final values\r\n      each(this.options.properties, (prop, name) => {\r\n        if (prop) {\r\n          current[name] = prop.end;\r\n        }\r\n      });\r\n\r\n      this.options.onTick(current, 1.0);\r\n\r\n      window.requestAnimationFrame(() => {\r\n        this.__resolved = true;\r\n        this.__resolve();\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Animation chaining\r\n   * @param {Function} [onFulfilled] - Called when the animation is complete, can return a new animation\r\n   * @param {Function} [onRejected] - Called when the animation is cancelled\r\n   * @returns {PSV.Animation}\r\n   */\r\n  then(onFulfilled = null, onRejected = null) {\r\n    const p = new Animation();\r\n\r\n    // Allow cancellation to climb up the promise chain\r\n    p.__promise.then(null, () => this.cancel());\r\n\r\n    this.__promise.then(\r\n      () => p.__resolve(onFulfilled ? onFulfilled() : undefined),\r\n      () => p.__reject(onRejected ? onRejected() : undefined)\r\n    );\r\n\r\n    return p;\r\n  }\r\n\r\n  /**\r\n   * @summary Alias to `.then(null, onRejected)`\r\n   * @param {Function} onRejected - Called when the animation has been cancelled\r\n   * @returns {PSV.Animation}\r\n   */\r\n  catch(onRejected) {\r\n    return this.then(undefined, onRejected);\r\n  }\r\n\r\n  /**\r\n   * @summary Alias to `.then(onFinally, onFinally)`\r\n   * @param {Function} onFinally - Called when the animation is either complete or cancelled\r\n   * @returns {PSV.Animation}\r\n   */\r\n  finally(onFinally) {\r\n    return this.then(onFinally, onFinally);\r\n  }\r\n\r\n  /**\r\n   * @summary Cancels the animation\r\n   */\r\n  cancel() {\r\n    if (!this.__cancelled && !this.__resolved) {\r\n      this.__cancelled = true;\r\n      this.__reject();\r\n\r\n      if (this.__delayTimeout) {\r\n        window.cancelAnimationFrame(this.__delayTimeout);\r\n        this.__delayTimeout = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Returns a resolved animation promise\r\n   * @returns {PSV.Animation}\r\n   */\r\n  static resolve() {\r\n    const p = Promise.resolve();\r\n    p.cancel = () => {\r\n    };\r\n    p.finally = (onFinally) => {\r\n      return p.then(onFinally, onFinally);\r\n    };\r\n    return p;\r\n  }\r\n\r\n}\r\n","/**\r\n * @namespace PSV.components\r\n */\r\n\r\n/**\r\n * @summary Base component class\r\n * @memberof PSV.components\r\n * @abstract\r\n */\r\nexport class AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer | PSV.components.AbstractComponent} parent\r\n   * @param {string} className - CSS class added to the component's container\r\n   */\r\n  constructor(parent, className) {\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = parent.psv || parent;\r\n\r\n    /**\r\n     * @member {PSV.Viewer|PSV.components.AbstractComponent}\r\n     * @readonly\r\n     */\r\n    this.parent = parent;\r\n    this.parent.children.push(this);\r\n\r\n    /**\r\n     * @summary All child components\r\n     * @type {PSV.components.AbstractComponent[]}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.children = [];\r\n\r\n    /**\r\n     * @summary Internal properties\r\n     * @member {Object}\r\n     * @protected\r\n     * @property {boolean} visible - Visibility of the component\r\n     */\r\n    this.prop = {\r\n      visible: true,\r\n    };\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     */\r\n    this.container = document.createElement('div');\r\n    this.container.className = className;\r\n    this.parent.container.appendChild(this.container);\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the component\r\n   * @protected\r\n   */\r\n  destroy() {\r\n    this.parent.container.removeChild(this.container);\r\n\r\n    const childIdx = this.parent.children.indexOf(this);\r\n    if (childIdx !== -1) {\r\n      this.parent.children.splice(childIdx, 1);\r\n    }\r\n\r\n    this.children.slice().forEach(child => child.destroy());\r\n    this.children.length = 0;\r\n\r\n    delete this.container;\r\n    delete this.parent;\r\n    delete this.psv;\r\n    delete this.prop;\r\n  }\r\n\r\n  /**\r\n   * @summary Refresh UI\r\n   * @description Must be be a very lightweight operation\r\n   * @package\r\n   */\r\n  refreshUi() {\r\n    this.children.every((child) => {\r\n      child.refreshUi();\r\n      return this.psv.prop.uiRefresh === true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Displays or hides the component\r\n   */\r\n  toggle() {\r\n    if (this.isVisible()) {\r\n      this.hide();\r\n    }\r\n    else {\r\n      this.show();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the component\r\n   */\r\n  hide() {\r\n    this.container.style.display = 'none';\r\n    this.prop.visible = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Displays the component\r\n   */\r\n  show() {\r\n    this.container.style.display = '';\r\n    this.prop.visible = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Check if the component is visible\r\n   * @returns {boolean}\r\n   */\r\n  isVisible() {\r\n    return this.prop.visible;\r\n  }\r\n\r\n}\r\n","import { AbstractComponent } from '../components/AbstractComponent';\r\nimport { PSVError } from '../PSVError';\r\nimport { isPlainObject, toggleClass } from '../utils';\r\n\r\n/**\r\n * @namespace PSV.buttons\r\n */\r\n\r\n/**\r\n * @summary Base navbar button class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.buttons\r\n * @abstract\r\n */\r\nexport class AbstractButton extends AbstractComponent {\r\n\r\n  /**\r\n   * @summary Unique identifier of the button\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static id = null;\r\n\r\n  /**\r\n   * @summary SVG icon name injected in the button\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static icon = null;\r\n\r\n  /**\r\n   * @summary SVG icon name injected in the button when it is active\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static iconActive = null;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {string} [className] - Additional CSS classes\r\n   * @param {boolean} [collapsable=false] - `true` if the button can be moved to menu when the navbar is too small\r\n   */\r\n  constructor(navbar, className = '', collapsable = false) {\r\n    super(navbar, 'psv-button ' + className);\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} id - Unique identifier of the button\r\n     * @property {boolean} enabled\r\n     * @property {boolean} supported\r\n     * @property {boolean} collapsed\r\n     * @property {boolean} active\r\n     * @property {number} width\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      id         : this.constructor.id,\r\n      collapsable: collapsable,\r\n      enabled    : true,\r\n      supported  : true,\r\n      collapsed  : false,\r\n      active     : false,\r\n      width      : this.container.offsetWidth,\r\n    };\r\n\r\n    if (this.constructor.icon) {\r\n      this.__setIcon(this.constructor.icon);\r\n    }\r\n\r\n    if (this.prop.id && this.psv.config.lang[this.prop.id]) {\r\n      this.container.title = this.psv.config.lang[this.prop.id];\r\n    }\r\n\r\n    this.container.addEventListener('click', (e) => {\r\n      if (this.prop.enabled) {\r\n        this.onClick();\r\n      }\r\n      e.stopPropagation();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @package\r\n   */\r\n  checkSupported() {\r\n    const supportedOrObject = this.isSupported();\r\n    if (isPlainObject(supportedOrObject)) {\r\n      if (supportedOrObject.initial === false) {\r\n        this.hide();\r\n        this.prop.supported = false;\r\n      }\r\n\r\n      supportedOrObject.promise.then((supported) => {\r\n        if (!this.prop) {\r\n          return; // the component has been destroyed\r\n        }\r\n        this.prop.supported = supported;\r\n        if (!supported && this.prop.visible) {\r\n          this.hide();\r\n        }\r\n        else if (supported && !this.prop.visible) {\r\n          this.show();\r\n        }\r\n      });\r\n    }\r\n    else if (!supportedOrObject) {\r\n      this.hide();\r\n      this.prop.supported = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the button can be displayed\r\n   * @returns {boolean|{initial: boolean, promise: Promise<boolean>}}\r\n   */\r\n  isSupported() {\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * @summary Changes the active state of the button\r\n   * @param {boolean} [active] - forced state\r\n   */\r\n  toggleActive(active) {\r\n    this.prop.active = active !== undefined ? active : !this.prop.active;\r\n    toggleClass(this.container, 'psv-button--active', this.prop.active);\r\n\r\n    if (this.constructor.iconActive) {\r\n      this.__setIcon(this.prop.active ? this.constructor.iconActive : this.constructor.icon);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  show(refresh = true) {\r\n    if (!this.isVisible()) {\r\n      this.prop.visible = true;\r\n      if (!this.prop.collapsed) {\r\n        this.container.style.display = '';\r\n      }\r\n      if (refresh) {\r\n        this.psv.refreshUi(`show button ${this.prop.id}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  hide(refresh = true) {\r\n    if (this.isVisible()) {\r\n      this.prop.visible = false;\r\n      this.container.style.display = 'none';\r\n      if (refresh) {\r\n        this.psv.refreshUi(`hide button ${this.prop.id}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Disables the button\r\n   */\r\n  disable() {\r\n    this.container.classList.add('psv-button--disabled');\r\n    this.prop.enabled = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Enables the button\r\n   */\r\n  enable() {\r\n    this.container.classList.remove('psv-button--disabled');\r\n    this.prop.enabled = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Collapses the button in the navbar menu\r\n   */\r\n  collapse() {\r\n    this.prop.collapsed = true;\r\n    this.container.style.display = 'none';\r\n  }\r\n\r\n  /**\r\n   * @summary Uncollapses the button from the navbar menu\r\n   */\r\n  uncollapse() {\r\n    this.prop.collapsed = false;\r\n    if (this.prop.visible) {\r\n      this.container.style.display = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Set the button icon\r\n   * @param {string} icon SVG\r\n   * @param {HTMLElement} [container] - default is the main button container\r\n   * @private\r\n   */\r\n  __setIcon(icon, container = this.container) {\r\n    if (icon) {\r\n      container.innerHTML = icon;\r\n      // classList not supported on IE11, className is read-only !!!!\r\n      container.querySelector('svg').setAttribute('class', 'psv-button-svg');\r\n    }\r\n    else {\r\n      container.innerHTML = '';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Action when the button is clicked\r\n   * @private\r\n   * @abstract\r\n   */\r\n  onClick() {\r\n    throw new PSVError(`onClick not implemented for button \"${this.prop.id}\".`);\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport playActive from '../icons/play-active.svg';\r\nimport play from '../icons/play.svg';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\nimport '../styles/buttons/autorotate.scss';\r\n\r\n/**\r\n * @summary Navigation bar autorotate button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class AutorotateButton extends AbstractButton {\r\n\r\n  static id = 'autorotate';\r\n  static icon = play;\r\n  static iconActive = playActive;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-autorotate-button', true);\r\n\r\n    this.psv.on(EVENTS.AUTOROTATE, this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.AUTOROTATE, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.AUTOROTATE: this.toggleActive(e.args[0]); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles autorotate\r\n   */\r\n  onClick() {\r\n    this.psv.toggleAutorotate();\r\n  }\r\n\r\n}\r\n","import { addClasses } from '../utils';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar custom button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class CustomButton extends AbstractButton {\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {PSV.NavbarCustomButton} config\r\n   */\r\n  constructor(navbar, config) {\r\n    super(navbar, 'psv-custom-button', config.collapsable !== false);\r\n\r\n    /**\r\n     * @member {Object}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.config = config;\r\n\r\n    if (this.config.id) {\r\n      this.prop.id = this.config.id;\r\n    }\r\n    else {\r\n      this.prop.id = 'psvButton-' + Math.random().toString(36).substr(2, 9);\r\n    }\r\n\r\n    if (this.config.className) {\r\n      addClasses(this.container, this.config.className);\r\n    }\r\n\r\n    if (this.config.title) {\r\n      this.container.title = this.config.title;\r\n    }\r\n\r\n    if (this.config.content) {\r\n      this.container.innerHTML = this.config.content;\r\n    }\r\n\r\n    this.width = this.container.offsetWidth;\r\n\r\n    if (this.config.enabled === false) {\r\n      this.disable();\r\n    }\r\n\r\n    if (this.config.visible === false) {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.config;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Calls user method\r\n   */\r\n  onClick() {\r\n    if (this.config.onClick) {\r\n      this.config.onClick.apply(this.psv);\r\n    }\r\n  }\r\n\r\n}\r\n","import { AbstractButton } from './AbstractButton';\r\nimport download from '../icons/download.svg';\r\n\r\n/**\r\n * @summary Navigation bar download button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class DownloadButton extends AbstractButton {\r\n\r\n  static id = 'download';\r\n  static icon = download;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-download-button', true);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Asks the browser to download the panorama source file\r\n   */\r\n  onClick() {\r\n    const link = document.createElement('a');\r\n    link.href = this.psv.config.panorama;\r\n    link.download = this.psv.config.panorama;\r\n    this.psv.container.appendChild(link);\r\n    link.click();\r\n\r\n    setTimeout(() => {\r\n      this.psv.container.removeChild(link);\r\n    }, 100);\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport fullscreenIn from '../icons/fullscreen-in.svg';\r\nimport fullscreenOut from '../icons/fullscreen-out.svg';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar fullscreen button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class FullscreenButton extends AbstractButton {\r\n\r\n  static id = 'fullscreen';\r\n  static icon = fullscreenIn;\r\n  static iconActive = fullscreenOut;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-fullscreen-button');\r\n\r\n    this.psv.on(EVENTS.FULLSCREEN_UPDATED, this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.FULLSCREEN_UPDATED, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * Handle events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.FULLSCREEN_UPDATED: this.toggleActive(e.args[0]); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles fullscreen\r\n   */\r\n  onClick() {\r\n    this.psv.toggleFullscreen();\r\n  }\r\n\r\n}\r\n","import { BUTTON_DATA } from '../data/constants';\r\nimport { dasherize } from '../utils';\r\n\r\nconst HTML_BUTTON_DATA = 'data-' + dasherize(BUTTON_DATA);\r\n\r\n/**\r\n * @summary Menu template\r\n * @param {AbstractButton[]} buttons\r\n * @param {PSV.Viewer} psv\r\n * @returns {string}\r\n */\r\nexport default (buttons, psv) => `\r\n<div class=\"psv-markers-list-container\">\r\n  <h1 class=\"psv-markers-list-title\">${psv.config.lang.menu}</h1>\r\n  <ul class=\"psv-markers-list\">\r\n    ${buttons.map(button => `\r\n    <li ${HTML_BUTTON_DATA}=\"${button.prop.id}\" class=\"psv-markers-list-item\">\r\n      <span class=\"psv-markers-list-image\">${button.container.innerHTML}</span>\r\n      <p class=\"psv-markers-list-name\">${button.container.title}</p>\r\n    </li>\r\n    `).join('')}\r\n  </ul>\r\n</div>\r\n`;\r\n","import { BUTTON_DATA, EVENTS, IDS } from '../data/constants';\r\nimport menuIcon from '../icons/menu.svg';\r\nimport menuTemplate from '../templates/menu';\r\nimport { getClosest } from '../utils';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar menu button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class MenuButton extends AbstractButton {\r\n\r\n  static id = 'menu';\r\n  static icon = menuIcon;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-menu-button');\r\n\r\n    this.psv.on(EVENTS.OPEN_PANEL, this);\r\n    this.psv.on(EVENTS.CLOSE_PANEL, this);\r\n\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.OPEN_PANEL, this);\r\n    this.psv.off(EVENTS.CLOSE_PANEL, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.OPEN_PANEL:  this.toggleActive(e.args[0] === IDS.MENU); break;\r\n      case EVENTS.CLOSE_PANEL: this.toggleActive(false); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  hide(refresh) {\r\n    super.hide(refresh);\r\n    this.__hideMenu();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  show(refresh) {\r\n    super.show(refresh);\r\n\r\n    if (this.prop.active) {\r\n      this.__showMenu();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles menu\r\n   */\r\n  onClick() {\r\n    if (this.prop.active) {\r\n      this.__hideMenu();\r\n    }\r\n    else {\r\n      this.__showMenu();\r\n    }\r\n  }\r\n\r\n  __showMenu() {\r\n    this.psv.panel.show({\r\n      id          : IDS.MENU,\r\n      content     : menuTemplate(this.parent.collapsed, this.psv),\r\n      noMargin    : true,\r\n      clickHandler: (e) => {\r\n        const li = e.target ? getClosest(e.target, 'li') : undefined;\r\n        const buttonId = li ? li.dataset[BUTTON_DATA] : undefined;\r\n\r\n        if (buttonId) {\r\n          this.parent.getButton(buttonId).onClick();\r\n          this.__hideMenu();\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  __hideMenu() {\r\n    if (this.psv.panel) {\r\n      this.psv.panel.hide(IDS.MENU);\r\n    }\r\n  }\r\n\r\n}\r\n","/**\r\n * @summary General information about the system\r\n * @constant\r\n * @memberOf PSV\r\n * @property {boolean} loaded - Indicates if the system has been loaded yet\r\n * @property {Function} load - Loads the system if not already loaded\r\n * @property {number} pixelRatio\r\n * @property {boolean} isWebGLSupported\r\n * @property {number} maxTextureWidth\r\n * @property {number} maxCanvasWidth\r\n * @property {string} mouseWheelEvent\r\n * @property {string} fullscreenEvent\r\n * @property {Promise<boolean>} isTouchEnabled\r\n */\r\nexport const SYSTEM = {\r\n  loaded          : false,\r\n  pixelRatio      : 1,\r\n  isWebGLSupported: false,\r\n  isTouchEnabled  : null,\r\n  maxTextureWidth : 0,\r\n  maxCanvasWidth  : 0,\r\n  mouseWheelEvent : null,\r\n  fullscreenEvent : null,\r\n};\r\n\r\n/**\r\n * @summary Loads the system if not already loaded\r\n */\r\nSYSTEM.load = () => {\r\n  if (!SYSTEM.loaded) {\r\n    const ctx = getWebGLCtx();\r\n\r\n    SYSTEM.loaded = true;\r\n    SYSTEM.pixelRatio = window.devicePixelRatio || 1;\r\n    SYSTEM.isWebGLSupported = ctx != null;\r\n    SYSTEM.isTouchEnabled = isTouchEnabled();\r\n    SYSTEM.maxTextureWidth = getMaxTextureWidth(ctx);\r\n    SYSTEM.maxCanvasWidth = getMaxCanvasWidth(SYSTEM.maxTextureWidth);\r\n    SYSTEM.mouseWheelEvent = getMouseWheelEvent();\r\n    SYSTEM.fullscreenEvent = getFullscreenEvent();\r\n  }\r\n};\r\n\r\n/**\r\n * @summary Tries to return a canvas webgl context\r\n * @returns {WebGLRenderingContext}\r\n * @private\r\n */\r\nfunction getWebGLCtx() {\r\n  const canvas = document.createElement('canvas');\r\n  const names = ['webgl', 'experimental-webgl', 'moz-webgl', 'webkit-3d'];\r\n  let context = null;\r\n\r\n  if (!canvas.getContext) {\r\n    return null;\r\n  }\r\n\r\n  if (names.some((name) => {\r\n    try {\r\n      context = canvas.getContext(name);\r\n      return context !== null;\r\n    }\r\n    catch (e) {\r\n      return false;\r\n    }\r\n  })) {\r\n    return context;\r\n  }\r\n  else {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Detects if the user is using a touch screen\r\n * @returns {Promise<boolean>}\r\n * @private\r\n */\r\nfunction isTouchEnabled() {\r\n  return new Promise((resolve) => {\r\n    const listener = (e) => {\r\n      if (e) {\r\n        resolve(true);\r\n      }\r\n      else {\r\n        resolve(false);\r\n      }\r\n\r\n      window.removeEventListener('touchstart', listener);\r\n    };\r\n\r\n    window.addEventListener('touchstart', listener, false);\r\n\r\n    // after 10 secs auto-reject the promise\r\n    setTimeout(listener, 10000);\r\n  });\r\n}\r\n\r\n/**\r\n * @summary Gets max texture width in WebGL context\r\n * @returns {number}\r\n * @private\r\n */\r\nfunction getMaxTextureWidth(ctx) {\r\n  if (ctx !== null) {\r\n    return ctx.getParameter(ctx.MAX_TEXTURE_SIZE);\r\n  }\r\n  else {\r\n    return 0;\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Gets max canvas width supported by the browser.\r\n * We only test powers of 2 and height = width / 2 because that's what we need to generate WebGL textures\r\n * @param maxWidth\r\n * @return {number}\r\n * @private\r\n */\r\nfunction getMaxCanvasWidth(maxWidth) {\r\n  const canvas = document.createElement('canvas');\r\n  const ctx = canvas.getContext('2d');\r\n  canvas.width = maxWidth;\r\n  canvas.height = 1;\r\n\r\n  while (canvas.width > 1024) {\r\n    ctx.fillStyle = 'white';\r\n    ctx.fillRect(0, 0, 1, 1);\r\n\r\n    try {\r\n      if (ctx.getImageData(0, 0, 1, 1).data[0] === 255) {\r\n        return canvas.width;\r\n      }\r\n    }\r\n    catch (e) {\r\n      // continue\r\n    }\r\n\r\n    canvas.width /= 2;\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\n/**\r\n * @summary Gets the event name for mouse wheel\r\n * @returns {string}\r\n * @private\r\n */\r\nfunction getMouseWheelEvent() {\r\n  if ('onwheel' in document.createElement('div')) { // Modern browsers support \"wheel\"\r\n    return 'wheel';\r\n  }\r\n  else if (document.onmousewheel !== undefined) { // Webkit and IE support at least \"mousewheel\"\r\n    return 'mousewheel';\r\n  }\r\n  else { // let's assume that remaining browsers are older Firefox\r\n    return 'DOMMouseScroll';\r\n  }\r\n}\r\n\r\n/**\r\n * @summary Map between fullsceen method and fullscreen event name\r\n * @type {Object<string, string>}\r\n * @readonly\r\n * @private\r\n */\r\nconst FULLSCREEN_EVT_MAP = {\r\n  exitFullscreen      : 'fullscreenchange',\r\n  webkitExitFullscreen: 'webkitfullscreenchange',\r\n  mozCancelFullScreen : 'mozfullscreenchange',\r\n  msExitFullscreen    : 'MSFullscreenChange',\r\n};\r\n\r\n\r\n/**\r\n * @summary  Gets the event name for fullscreen\r\n * @returns {string}\r\n * @private\r\n */\r\nfunction getFullscreenEvent() {\r\n  const validExits = Object.keys(FULLSCREEN_EVT_MAP).filter(exit => exit in document);\r\n\r\n  if (validExits.length) {\r\n    return FULLSCREEN_EVT_MAP[validExits[0]];\r\n  }\r\n  else {\r\n    return null;\r\n  }\r\n}\r\n","import { Animation } from '../Animation';\r\nimport { SYSTEM } from '../data/system';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\n/**\r\n * @summary Navigation bar zoom button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class AbstractZoomButton extends AbstractButton {\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {number} value\r\n   */\r\n  constructor(navbar, value) {\r\n    super(navbar, 'psv-button--hover-scale psv-zoom-button', true);\r\n\r\n    /**\r\n     * @override\r\n     * @property {number} value\r\n     * @property {boolean} buttondown\r\n     * @property {*} longPressTimeout\r\n     * @property {PSV.Animation} longPressAnimation\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      value             : value,\r\n      buttondown        : false,\r\n      longPressTimeout  : null,\r\n      longPressAnimation: null,\r\n    };\r\n\r\n    this.container.addEventListener('mousedown', this);\r\n    this.psv.container.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchend', this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.__onMouseUp();\r\n\r\n    this.psv.container.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchend', this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'mousedown': this.__onMouseDown(); break;\r\n      case 'mouseup':   this.__onMouseUp(); break;\r\n      case 'touchend':  this.__onMouseUp(); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  isSupported() {\r\n    return { initial: true, promise: SYSTEM.isTouchEnabled.then(enabled => !enabled) };\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  onClick() {\r\n    // nothing\r\n  }\r\n\r\n  /**\r\n   * @summary Handles click events\r\n   * @description Zooms in and register long press timer\r\n   * @private\r\n   */\r\n  __onMouseDown() {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.prop.buttondown = true;\r\n    this.prop.longPressTimeout = setTimeout(() => this.__startLongPressInterval(), 100);\r\n  }\r\n\r\n  /**\r\n   * @summary Continues zooming as long as the user presses the button\r\n   * @private\r\n   */\r\n  __startLongPressInterval() {\r\n    if (!this.prop.buttondown) {\r\n      return;\r\n    }\r\n\r\n    const end = this.prop.value < 0 ? 0 : 100;\r\n\r\n    this.prop.longPressAnimation = new Animation({\r\n      properties: {\r\n        zoom: { start: this.psv.prop.zoomLvl, end: end },\r\n      },\r\n      duration  : 1500 * Math.abs(this.psv.prop.zoomLvl - end) / 100,\r\n      easing    : 'linear',\r\n      onTick    : (properties) => {\r\n        this.psv.zoom(properties.zoom);\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse up events\r\n   * @private\r\n   */\r\n  __onMouseUp() {\r\n    if (!this.prop.enabled || !this.prop.buttondown) {\r\n      return;\r\n    }\r\n\r\n    if (this.prop.longPressAnimation) {\r\n      this.prop.longPressAnimation.cancel();\r\n      this.prop.longPressAnimation = null;\r\n    }\r\n    else {\r\n      this.psv.zoom(this.psv.prop.zoomLvl + this.prop.value * this.psv.config.zoomButtonIncrement);\r\n    }\r\n\r\n    if (this.prop.longPressTimeout) {\r\n      clearTimeout(this.prop.longPressTimeout);\r\n    }\r\n\r\n    this.prop.buttondown = false;\r\n  }\r\n\r\n}\r\n","import { AbstractZoomButton } from './AbstractZoomButton';\r\nimport zoomIn from '../icons/zoom-in.svg';\r\n\r\n/**\r\n * @summary Navigation bar zoom-in button class\r\n * @extends PSV.buttons.AbstractZoomButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class ZoomInButton extends AbstractZoomButton {\r\n\r\n  static id = 'zoomIn';\r\n  static icon = zoomIn;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 1);\r\n  }\r\n\r\n}\r\n","import { AbstractZoomButton } from './AbstractZoomButton';\r\nimport zoomOut from '../icons/zoom-out.svg';\r\n\r\n/**\r\n * @summary Navigation bar zoom-out button class\r\n * @extends PSV.buttons.AbstractZoomButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class ZoomOutButton extends AbstractZoomButton {\r\n\r\n  static id = 'zoomOut';\r\n  static icon = zoomOut;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, -1);\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { getStyle } from '../utils';\r\nimport { AbstractButton } from './AbstractButton';\r\n\r\nimport '../styles/buttons/zoom-range.scss';\r\n\r\n/**\r\n * @summary Navigation bar zoom button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class ZoomRangeButton extends AbstractButton {\r\n\r\n  static id = 'zoomRange';\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-zoom-range');\r\n\r\n    /**\r\n     * @override\r\n     * @property {boolean} mousedown\r\n     * @property {number} mediaMinWidth\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      mousedown    : false,\r\n      mediaMinWidth: 0,\r\n    };\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.zoomRange = document.createElement('div');\r\n    this.zoomRange.className = 'psv-zoom-range-line';\r\n    this.container.appendChild(this.zoomRange);\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.zoomValue = document.createElement('div');\r\n    this.zoomValue.className = 'psv-zoom-range-handle';\r\n    this.zoomRange.appendChild(this.zoomValue);\r\n\r\n    this.prop.mediaMinWidth = parseInt(getStyle(this.container, 'maxWidth'), 10);\r\n\r\n    this.container.addEventListener('mousedown', this);\r\n    this.container.addEventListener('touchstart', this);\r\n    this.psv.container.addEventListener('mousemove', this);\r\n    this.psv.container.addEventListener('touchmove', this);\r\n    this.psv.container.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchend', this);\r\n\r\n    this.psv.on(EVENTS.ZOOM_UPDATED, this);\r\n\r\n    if (this.psv.prop.ready) {\r\n      this.__moveZoomValue(this.psv.prop.zoomLvl);\r\n    }\r\n    else {\r\n      this.psv.once(EVENTS.READY, this);\r\n    }\r\n\r\n    this.refreshUi();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.__stopZoomChange();\r\n\r\n    this.psv.container.removeEventListener('mousemove', this);\r\n    this.psv.container.removeEventListener('touchmove', this);\r\n    this.psv.container.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchend', this);\r\n\r\n    delete this.zoomRange;\r\n    delete this.zoomValue;\r\n\r\n    this.psv.off(EVENTS.ZOOM_UPDATED, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'mousedown':    this.__initZoomChangeWithMouse(e); break;\r\n      case 'touchstart':   this.__initZoomChangeByTouch(e);   break;\r\n      case 'mousemove':    this.__changeZoomWithMouse(e);     break;\r\n      case 'touchmove':    this.__changeZoomByTouch(e);       break;\r\n      case 'mouseup':      this.__stopZoomChange(e);          break;\r\n      case 'touchend':     this.__stopZoomChange(e);          break;\r\n      case EVENTS.ZOOM_UPDATED: this.__moveZoomValue(e.args[0]); break;\r\n      case EVENTS.READY:        this.__moveZoomValue(this.psv.prop.zoomLvl); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  isSupported() {\r\n    return { initial: true, promise: SYSTEM.isTouchEnabled.then(enabled => !enabled) };\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  refreshUi() {\r\n    if (this.prop.supported) {\r\n      if (this.psv.prop.size.width <= this.prop.mediaMinWidth && this.prop.visible) {\r\n        this.hide();\r\n      }\r\n      else if (this.psv.prop.size.width > this.prop.mediaMinWidth && !this.prop.visible) {\r\n        this.show();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  onClick() {\r\n    // nothing\r\n  }\r\n\r\n  /**\r\n   * @summary Moves the zoom cursor\r\n   * @param {number} level\r\n   * @private\r\n   */\r\n  __moveZoomValue(level) {\r\n    this.zoomValue.style.left = (level / 100 * this.zoomRange.offsetWidth - this.zoomValue.offsetWidth / 2) + 'px';\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse down events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __initZoomChangeWithMouse(evt) {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.prop.mousedown = true;\r\n    this.__changeZoom(evt.clientX);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __initZoomChangeByTouch(evt) {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.prop.mousedown = true;\r\n    this.__changeZoom(evt.changedTouches[0].clientX);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse up events\r\n   * @private\r\n   */\r\n  __stopZoomChange() {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    this.prop.mousedown = false;\r\n    this.prop.buttondown = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse move events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __changeZoomWithMouse(evt) {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n\r\n    evt.preventDefault();\r\n    this.__changeZoom(evt.clientX);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch move events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __changeZoomByTouch(evt) {\r\n    if (!this.prop.enabled) {\r\n      return;\r\n    }\r\n    this.__changeZoom(evt.changedTouches[0].clientX);\r\n  }\r\n\r\n  /**\r\n   * @summary Zoom change\r\n   * @param {number} x - mouse/touch position\r\n   * @private\r\n   */\r\n  __changeZoom(x) {\r\n    if (this.prop.mousedown) {\r\n      const userInput = x - this.zoomRange.getBoundingClientRect().left;\r\n      const zoomLevel = userInput / this.zoomRange.offsetWidth * 100;\r\n      this.psv.zoom(zoomLevel);\r\n    }\r\n  }\r\n\r\n}\r\n","import { PSVError } from '../PSVError';\r\nimport { bound, clone, deepmerge, each, logWarn, parseAngle, parseSpeed } from '../utils';\r\nimport { ACTIONS } from './constants';\r\n\r\n/**\r\n * @summary Default options\r\n * @type {PSV.Options}\r\n * @memberOf PSV\r\n * @constant\r\n */\r\nexport const DEFAULTS = {\r\n  panorama           : null,\r\n  container          : null,\r\n  caption            : null,\r\n  loadingImg         : null,\r\n  loadingTxt         : 'Loading...',\r\n  size               : null,\r\n  fisheye            : false,\r\n  minFov             : 30,\r\n  maxFov             : 90,\r\n  defaultZoomLvl     : 50,\r\n  defaultLong        : 0,\r\n  defaultLat         : 0,\r\n  sphereCorrection   : {\r\n    pan : 0,\r\n    tilt: 0,\r\n    roll: 0,\r\n  },\r\n  moveSpeed          : 1,\r\n  zoomButtonIncrement: 2,\r\n  autorotateDelay    : null,\r\n  autorotateSpeed    : '2rpm',\r\n  autorotateLat      : null,\r\n  moveInertia        : true,\r\n  mousewheel         : true,\r\n  mousewheelSpeed    : 1,\r\n  mousemove          : true,\r\n  captureCursor      : false,\r\n  touchmoveTwoFingers: false,\r\n  useXmpData         : true,\r\n  panoData           : null,\r\n  withCredentials    : false,\r\n  navbar             : [\r\n    'autorotate',\r\n    'zoomOut',\r\n    'zoomRange',\r\n    'zoomIn',\r\n    'download',\r\n    'caption',\r\n    'fullscreen',\r\n  ],\r\n  lang               : {\r\n    autorotate: 'Automatic rotation',\r\n    zoom      : 'Zoom',\r\n    zoomOut   : 'Zoom out',\r\n    zoomIn    : 'Zoom in',\r\n    download  : 'Download',\r\n    fullscreen: 'Fullscreen',\r\n    menu      : 'Menu',\r\n    twoFingers: ['Use two fingers to navigate'],\r\n    loadError : 'The panorama can\\'t be loaded',\r\n  },\r\n  keyboard           : {\r\n    'ArrowUp'   : ACTIONS.ROTATE_LAT_UP,\r\n    'ArrowDown' : ACTIONS.ROTATE_LAT_DOWN,\r\n    'ArrowRight': ACTIONS.ROTATE_LONG_RIGHT,\r\n    'ArrowLeft' : ACTIONS.ROTATE_LONG_LEFT,\r\n    'PageUp'    : ACTIONS.ZOOM_IN,\r\n    'PageDown'  : ACTIONS.ZOOM_OUT,\r\n    '+'         : ACTIONS.ZOOM_IN,\r\n    '-'         : ACTIONS.ZOOM_OUT,\r\n    ' '         : ACTIONS.TOGGLE_AUTOROTATE,\r\n  },\r\n  plugins            : [],\r\n};\r\n\r\n/**\r\n * @summary List of unmodifiable options and their error messages\r\n * @private\r\n */\r\nexport const READONLY_OPTIONS = {\r\n  panorama : 'Use setPanorama method to change the panorama',\r\n  panoData : 'Use setPanorama method to change the panorama',\r\n  container: 'Cannot change viewer container',\r\n  plugins  : 'Cannot change plugins',\r\n};\r\n\r\n/**\r\n * @summary Parsers/validators for each option\r\n * @private\r\n */\r\nexport const CONFIG_PARSERS = {\r\n  container      : (container) => {\r\n    if (!container) {\r\n      throw new PSVError('No value given for container.');\r\n    }\r\n    return container;\r\n  },\r\n  defaultLat     : (defaultLat) => {\r\n    // defaultLat is between -PI/2 and PI/2\r\n    return parseAngle(defaultLat, true);\r\n  },\r\n  minFov         : (minFov, config) => {\r\n    // minFov and maxFov must be ordered\r\n    if (config.maxFov < minFov) {\r\n      logWarn('maxFov cannot be lower than minFov');\r\n      // eslint-disable-next-line no-param-reassign\r\n      minFov = config.maxFov;\r\n    }\r\n    // minFov between 1 and 179\r\n    return bound(minFov, 1, 179);\r\n  },\r\n  maxFov         : (maxFov, config) => {\r\n    // minFov and maxFov must be ordered\r\n    if (maxFov < config.minFov) {\r\n      // eslint-disable-next-line no-param-reassign\r\n      maxFov = config.minFov;\r\n    }\r\n    // maxFov between 1 and 179\r\n    return bound(maxFov, 1, 179);\r\n  },\r\n  lang           : (lang) => {\r\n    return {\r\n      ...DEFAULTS.lang,\r\n      ...lang,\r\n    };\r\n  },\r\n  keyboard       : (keyboard) => {\r\n    // keyboard=true becomes the default map\r\n    if (keyboard === true) {\r\n      return clone(DEFAULTS.keyboard);\r\n    }\r\n    return keyboard;\r\n  },\r\n  autorotateLat  : (autorotateLat, config) => {\r\n    // default autorotateLat is defaultLat\r\n    if (autorotateLat === null) {\r\n      return parseAngle(config.defaultLat, true);\r\n    }\r\n    // autorotateLat is between -PI/2 and PI/2\r\n    else {\r\n      return parseAngle(autorotateLat, true);\r\n    }\r\n  },\r\n  autorotateSpeed: (autorotateSpeed) => {\r\n    return parseSpeed(autorotateSpeed);\r\n  },\r\n  fisheye        : (fisheye) => {\r\n    // translate boolean fisheye to amount\r\n    if (fisheye === true) {\r\n      return 1;\r\n    }\r\n    else if (fisheye === false) {\r\n      return 0;\r\n    }\r\n    return fisheye;\r\n  },\r\n  plugins        : (plugins) => {\r\n    return plugins\r\n      .map((plugin) => {\r\n        if (Array.isArray(plugin)) {\r\n          return plugin;\r\n        }\r\n        else {\r\n          return [plugin];\r\n        }\r\n      })\r\n      .filter(plugin => !!plugin[0]);\r\n  },\r\n};\r\n\r\n/**\r\n * @summary Merge user config with default config and performs validation\r\n * @param {PSV.Options} options\r\n * @returns {PSV.Options}\r\n * @memberOf PSV\r\n * @private\r\n */\r\nexport function getConfig(options) {\r\n  const tempConfig = clone(DEFAULTS);\r\n  deepmerge(tempConfig, options);\r\n\r\n  const config = {};\r\n\r\n  each(tempConfig, (value, key) => {\r\n    if (!Object.prototype.hasOwnProperty.call(DEFAULTS, key)) {\r\n      throw new PSVError(`Unknown option ${key}`);\r\n    }\r\n\r\n    if (CONFIG_PARSERS[key]) {\r\n      config[key] = CONFIG_PARSERS[key](value, tempConfig);\r\n    }\r\n    else {\r\n      config[key] = value;\r\n    }\r\n  });\r\n\r\n  return config;\r\n}\r\n","import { AbstractButton } from './AbstractButton';\r\nimport { EVENTS } from '../data/constants';\r\nimport info from '../icons/info.svg';\r\n\r\n/**\r\n * @summary Navigation bar caption button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class CaptionButton extends AbstractButton {\r\n\r\n  static id = 'caption';\r\n  static icon = info;\r\n\r\n  /**\r\n   * @param {PSV.components.NavbarCaption} caption\r\n   */\r\n  constructor(caption) {\r\n    super(caption, 'psv-button--hover-scale psv-caption-button');\r\n\r\n    this.psv.on(EVENTS.HIDE_NOTIFICATION, this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.off(EVENTS.HIDE_NOTIFICATION, this);\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case EVENTS.HIDE_NOTIFICATION: this.toggleActive(false); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles caption\r\n   */\r\n  onClick() {\r\n    if (this.psv.notification.prop.visible) {\r\n      this.psv.notification.hide();\r\n    }\r\n    else {\r\n      this.psv.notification.show(this.parent.prop.caption);\r\n      this.toggleActive(true);\r\n    }\r\n  }\r\n\r\n}\r\n","import { CaptionButton } from '../buttons/CaptionButton';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\n/**\r\n * @summary Navbar caption class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class NavbarCaption extends AbstractComponent {\r\n\r\n  static id = 'caption';\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   * @param {string} caption\r\n   */\r\n  constructor(navbar, caption) {\r\n    super(navbar, 'psv-caption');\r\n\r\n    /**\r\n     * @member {PSV.buttons.CaptionButton}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.button = new CaptionButton(this);\r\n    this.button.hide();\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} id\r\n     * @property {boolean} collapsable\r\n     * @property {number} width\r\n     * @property {string} caption\r\n     * @property {boolean} contentVisible - if the content is visible in the navbar\r\n     * @property {number} contentWidth - with of the caption content\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      id            : this.constructor.id,\r\n      collapsable   : false,\r\n      width         : this.button.prop.width,\r\n      caption       : '',\r\n      contentVisible: true,\r\n      contentWidth  : 0,\r\n    };\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-caption-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    this.setCaption(caption);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.button;\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the bar caption\r\n   * @param {string} html\r\n   */\r\n  setCaption(html) {\r\n    this.prop.caption = html || '';\r\n    this.content.innerHTML = this.prop.caption;\r\n\r\n    if (html) {\r\n      this.show(false);\r\n\r\n      this.content.style.display = '';\r\n      this.prop.contentWidth = this.content.offsetWidth;\r\n\r\n      this.refreshUi();\r\n    }\r\n    else {\r\n      this.hide();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Toggles content and icon depending on available space\r\n   * @private\r\n   */\r\n  refreshUi() {\r\n    const availableWidth = this.container.offsetWidth;\r\n    if (availableWidth >= this.prop.contentWidth && !this.prop.contentVisible) {\r\n      this.content.style.display = '';\r\n      this.prop.contentVisible = true;\r\n      this.button.hide(false);\r\n    }\r\n    else if (availableWidth < this.prop.contentWidth && this.prop.contentVisible) {\r\n      this.content.style.display = 'none';\r\n      this.prop.contentVisible = false;\r\n      this.button.show(false);\r\n    }\r\n  }\r\n\r\n}\r\n","import { AutorotateButton } from '../buttons/AutorotateButton';\r\nimport { CustomButton } from '../buttons/CustomButton';\r\nimport { DownloadButton } from '../buttons/DownloadButton';\r\nimport { FullscreenButton } from '../buttons/FullscreenButton';\r\nimport { MenuButton } from '../buttons/MenuButton';\r\nimport { ZoomInButton } from '../buttons/ZoomInButton';\r\nimport { ZoomOutButton } from '../buttons/ZoomOutButton';\r\nimport { ZoomRangeButton } from '../buttons/ZoomRangeButton';\r\nimport { DEFAULTS } from '../data/config';\r\nimport { PSVError } from '../PSVError';\r\nimport '../styles/navbar.scss';\r\nimport { clone, logWarn } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\nimport { NavbarCaption } from './NavbarCaption';\r\n\r\n/**\r\n * @summary List of available buttons\r\n * @type {Object<string, Class<PSV.buttons.AbstractButton>>}\r\n * @private\r\n */\r\nconst AVAILABLE_BUTTONS = {};\r\n\r\n/**\r\n * @summary Register a new button available for all viewers\r\n * @param {Class<PSV.buttons.AbstractButton>} button\r\n * @memberOf PSV\r\n */\r\nexport function registerButton(button) {\r\n  if (!button.id) {\r\n    throw new PSVError('Button ID is required');\r\n  }\r\n\r\n  AVAILABLE_BUTTONS[button.id] = button;\r\n}\r\n\r\n[\r\n  AutorotateButton,\r\n  ZoomInButton,\r\n  ZoomRangeButton,\r\n  ZoomOutButton,\r\n  DownloadButton,\r\n  FullscreenButton,\r\n].forEach(registerButton);\r\n\r\n/**\r\n * @summary Navigation bar class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Navbar extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-navbar');\r\n\r\n    /**\r\n     * @summary List of buttons of the navbar\r\n     * @member {PSV.buttons.AbstractButton[]}\r\n     * @override\r\n     */\r\n    this.children = [];\r\n\r\n    /**\r\n     * @summary List of collapsed buttons\r\n     * @member {PSV.buttons.AbstractButton[]}\r\n     * @private\r\n     */\r\n    this.collapsed = [];\r\n  }\r\n\r\n  /**\r\n   * @summary Change the buttons visible on the navbar\r\n   * @param {string|Array<string|PSV.NavbarCustomButton>} buttons\r\n   */\r\n  setButtons(buttons) {\r\n    this.children.slice().forEach(item => item.destroy());\r\n    this.children.length = 0;\r\n\r\n    /* eslint-disable no-new */\r\n    this.__cleanButtons(buttons).forEach((button) => {\r\n      if (typeof button === 'object') {\r\n        new CustomButton(this, button);\r\n      }\r\n      else if (AVAILABLE_BUTTONS[button]) {\r\n        new AVAILABLE_BUTTONS[button](this);\r\n      }\r\n      else if (button === 'caption') {\r\n        new NavbarCaption(this, this.psv.config.caption);\r\n      }\r\n      else if (button === 'zoom') {\r\n        new ZoomOutButton(this);\r\n        new ZoomRangeButton(this);\r\n        new ZoomInButton(this);\r\n      }\r\n      else {\r\n        throw new PSVError('Unknown button ' + button);\r\n      }\r\n    });\r\n\r\n    new MenuButton(this);\r\n    /* eslint-enable no-new */\r\n\r\n    this.children.forEach((item) => {\r\n      if (typeof item.checkSupported === 'function') {\r\n        item.checkSupported();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the bar caption\r\n   * @param {string} html\r\n   */\r\n  setCaption(html) {\r\n    const caption = this.getButton('caption', false);\r\n\r\n    if (!caption) {\r\n      throw new PSVError('Cannot set caption, the navbar caption container is not initialized.');\r\n    }\r\n\r\n    caption.setCaption(html);\r\n  }\r\n\r\n  /**\r\n   * @summary Returns a button by its identifier\r\n   * @param {string} id\r\n   * @param {boolean} [warnNotFound=true]\r\n   * @returns {PSV.buttons.AbstractButton}\r\n   */\r\n  getButton(id, warnNotFound = true) {\r\n    let button = null;\r\n\r\n    this.children.some((item) => {\r\n      if (item.prop.id === id) {\r\n        button = item;\r\n        return true;\r\n      }\r\n      else {\r\n        return false;\r\n      }\r\n    });\r\n\r\n    if (!button && warnNotFound) {\r\n      logWarn(`button \"${id}\" not found in the navbar`);\r\n    }\r\n\r\n    return button;\r\n  }\r\n\r\n  /**\r\n   * @summary Shows the navbar\r\n   */\r\n  show() {\r\n    this.container.classList.add('psv-navbar--open');\r\n    this.prop.visible = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the navbar\r\n   */\r\n  hide() {\r\n    this.container.classList.remove('psv-navbar--open');\r\n    this.prop.visible = false;\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  refreshUi() {\r\n    super.refreshUi();\r\n\r\n    if (this.psv.prop.uiRefresh === true) {\r\n      const availableWidth = this.container.offsetWidth;\r\n\r\n      let totalWidth = 0;\r\n      const visibleButtons = [];\r\n      const collapsableButtons = [];\r\n\r\n      this.children.forEach((item) => {\r\n        if (item.prop.visible) {\r\n          totalWidth += item.prop.width;\r\n          visibleButtons.push(item);\r\n          if (item.prop.collapsable) {\r\n            collapsableButtons.push(item);\r\n          }\r\n        }\r\n      });\r\n\r\n      if (!visibleButtons.length) {\r\n        return;\r\n      }\r\n\r\n      if (availableWidth < totalWidth && collapsableButtons.length > 0) {\r\n        collapsableButtons.forEach(item => item.collapse());\r\n        this.collapsed = collapsableButtons;\r\n\r\n        this.getButton(MenuButton.id).show(false);\r\n      }\r\n      else if (availableWidth >= totalWidth && this.collapsed.length > 0) {\r\n        this.collapsed.forEach(item => item.uncollapse());\r\n        this.collapsed = [];\r\n\r\n        this.getButton(MenuButton.id).hide(false);\r\n      }\r\n\r\n      const caption = this.getButton(NavbarCaption.id, false);\r\n      if (caption) {\r\n        caption.refreshUi();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Ensure the buttons configuration is correct\r\n   * @private\r\n   */\r\n  __cleanButtons(buttons) {\r\n    // true becomes the default array\r\n    if (buttons === true) {\r\n      return clone(DEFAULTS.navbar);\r\n    }\r\n    // can be a space or coma separated list\r\n    else if (typeof buttons === 'string') {\r\n      return buttons.split(/[ ,]/);\r\n    }\r\n    else {\r\n      return buttons || [];\r\n    }\r\n  }\r\n\r\n}\r\n","import { EventEmitter } from 'uevent';\r\n\r\n/**\r\n * @namespace PSV.plugins\r\n */\r\n\r\n/**\r\n * @summary Base plugins class\r\n * @memberof PSV.plugins\r\n * @abstract\r\n */\r\nexport class AbstractPlugin extends EventEmitter {\r\n\r\n  /**\r\n   * @summary Unique identifier of the plugin\r\n   * @member {string}\r\n   * @readonly\r\n   * @static\r\n   */\r\n  static id = null;\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super();\r\n\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = psv;\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the plugin\r\n   * @package\r\n   */\r\n  destroy() {\r\n    delete this.psv;\r\n  }\r\n\r\n}\r\n","import { SYSTEM } from '../data/system';\r\nimport { getStyle } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\nimport '../styles/loader.scss';\r\n\r\n/**\r\n * @summary Loader class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Loader extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-loader-container');\r\n\r\n    /**\r\n     * @summary Inner container for vertical center\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.loader = document.createElement('div');\r\n    this.loader.className = 'psv-loader';\r\n    this.container.appendChild(this.loader);\r\n\r\n    /**\r\n     * @summary Animation canvas\r\n     * @member {HTMLCanvasElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.className = 'psv-loader-canvas';\r\n\r\n    this.canvas.width = this.loader.clientWidth * SYSTEM.pixelRatio;\r\n    this.canvas.height = this.loader.clientWidth * SYSTEM.pixelRatio;\r\n    this.loader.appendChild(this.canvas);\r\n\r\n    /**\r\n     * @override\r\n     * @property {number} thickness\r\n     * @property {string} current\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      tickness: (this.loader.offsetWidth - this.loader.clientWidth) / 2 * SYSTEM.pixelRatio,\r\n      current : null,\r\n    };\r\n\r\n    this.refreshUi();\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.loader;\r\n    delete this.canvas;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  refreshUi() {\r\n    if (this.prop.current !== (this.psv.config.loadingImg || this.psv.config.loadingTxt)) {\r\n      if (this.prop.current) {\r\n        this.loader.removeChild(this.loader.lastChild);\r\n      }\r\n\r\n      let inner;\r\n      if (this.psv.config.loadingImg) {\r\n        inner = document.createElement('img');\r\n        inner.className = 'psv-loader-image';\r\n        inner.src = this.psv.config.loadingImg;\r\n      }\r\n      else if (this.psv.config.loadingTxt) {\r\n        inner = document.createElement('div');\r\n        inner.className = 'psv-loader-text';\r\n        inner.innerHTML = this.psv.config.loadingTxt;\r\n      }\r\n      if (inner) {\r\n        const size = Math.round(Math.sqrt(2 * Math.pow((this.canvas.width / 2 - this.prop.tickness / 2) / SYSTEM.pixelRatio, 2)));\r\n        inner.style.maxWidth = size + 'px';\r\n        inner.style.maxHeight = size + 'px';\r\n        this.loader.appendChild(inner);\r\n      }\r\n\r\n      this.prop.current = this.psv.config.loadingImg || this.psv.config.loadingTxt;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Sets the loader progression\r\n   * @param {number} value - from 0 to 100\r\n   */\r\n  setProgress(value) {\r\n    const context = this.canvas.getContext('2d');\r\n\r\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    context.lineWidth = this.prop.tickness;\r\n    context.strokeStyle = getStyle(this.loader, 'color');\r\n\r\n    context.beginPath();\r\n    context.arc(\r\n      this.canvas.width / 2, this.canvas.height / 2,\r\n      this.canvas.width / 2 - this.prop.tickness / 2,\r\n      -Math.PI / 2, value / 100 * 2 * Math.PI - Math.PI / 2\r\n    );\r\n    context.stroke();\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\nimport '../styles/notification.scss';\r\n\r\n/**\r\n * @summary Notification class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Notification extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-notification');\r\n\r\n    /**\r\n     * @override\r\n     * @property {*} timeout\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      visible: false,\r\n      timeout: null,\r\n    };\r\n\r\n    /**\r\n     * Notification content\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-notification-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    this.content.addEventListener('click', () => this.hide());\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Displays a notification on the viewer\r\n   * @param {Object|string} config\r\n   * @param {string} config.content\r\n   * @param {number} [config.timeout]\r\n   * @fires PSV.show-notification\r\n   *\r\n   * @example\r\n   * viewer.showNotification({ content: 'Hello world', timeout: 5000 })\r\n   * @example\r\n   * viewer.showNotification('Hello world')\r\n   */\r\n  show(config) {\r\n    if (this.prop.timeout) {\r\n      clearTimeout(this.prop.timeout);\r\n      this.prop.timeout = null;\r\n    }\r\n\r\n    if (typeof config === 'string') {\r\n      config = { content: config }; // eslint-disable-line no-param-reassign\r\n    }\r\n\r\n    this.content.innerHTML = config.content;\r\n    this.prop.visible = true;\r\n\r\n    this.container.classList.add('psv-notification--visible');\r\n\r\n    this.psv.trigger(EVENTS.SHOW_NOTIFICATION);\r\n\r\n    if (config.timeout) {\r\n      this.prop.timeout = setTimeout(() => this.hide(), config.timeout);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the notification\r\n   * @fires PSV.hide-notification\r\n   */\r\n  hide() {\r\n    if (this.prop.visible) {\r\n      this.container.classList.remove('psv-notification--visible');\r\n\r\n      this.prop.visible = false;\r\n\r\n      this.psv.trigger(EVENTS.HIDE_NOTIFICATION);\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { AbstractComponent } from './AbstractComponent';\r\nimport { PSVError } from '../PSVError';\r\n\r\nimport '../styles/overlay.scss';\r\n\r\n/**\r\n * @summary Overlay class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Overlay extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-overlay');\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} contentId\r\n     * @property {boolean} dissmisable\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      contentId  : undefined,\r\n      dissmisable: true,\r\n    };\r\n\r\n    /**\r\n     * Image container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.image = document.createElement('div');\r\n    this.image.className = 'psv-overlay-image';\r\n    this.container.appendChild(this.image);\r\n\r\n    /**\r\n     * Text container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.text = document.createElement('div');\r\n    this.text.className = 'psv-overlay-text';\r\n    this.container.appendChild(this.text);\r\n\r\n    /**\r\n     * Subtext container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.subtext = document.createElement('div');\r\n    this.subtext.className = 'psv-overlay-subtext';\r\n    this.container.appendChild(this.subtext);\r\n\r\n    this.container.addEventListener('mouseup', (e) => {\r\n      e.stopPropagation();\r\n      if (this.prop.dissmisable) {\r\n        this.hide();\r\n      }\r\n    }, true);\r\n\r\n    super.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.image;\r\n    delete this.text;\r\n    delete this.subtext;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {string} [id]\r\n   */\r\n  isVisible(id) {\r\n    return this.prop.visible && (!id || !this.prop.contentId || this.prop.contentId === id);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  toggle() {\r\n    throw new PSVError('Overlay cannot be toggled');\r\n  }\r\n\r\n  /**\r\n   * @summary Displays an overlay on the viewer\r\n   * @param {Object|string} config\r\n   * @param {string} [config.id]\r\n   * @param {string} config.image\r\n   * @param {string} config.text\r\n   * @param {string} [config.subtext]\r\n   * @param {boolean} [config.dissmisable=true]\r\n   * @fires PSV.show-overlay\r\n   *\r\n   * @example\r\n   * viewer.showOverlay({\r\n   *   image: '<svg></svg>',\r\n   *   text: '....',\r\n   *   subtext: '....'\r\n   * })\r\n   */\r\n  show(config) {\r\n    if (typeof config === 'string') {\r\n      config = { text: config }; // eslint-disable-line no-param-reassign\r\n    }\r\n\r\n    this.prop.contentId = config.id;\r\n    this.prop.dissmisable = config.dissmisable !== false;\r\n    this.image.innerHTML = config.image || '';\r\n    this.text.innerHTML = config.text || '';\r\n    this.subtext.innerHTML = config.subtext || '';\r\n\r\n    super.show();\r\n\r\n    this.psv.trigger(EVENTS.SHOW_OVERLAY, config.id);\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the overlay\r\n   * @param {string} [id]\r\n   * @fires PSV.hide-overlay\r\n   */\r\n  hide(id) {\r\n    if (this.isVisible() && (!id || !this.prop.contentId || this.prop.contentId === id)) {\r\n      const contentId = this.prop.contentId;\r\n\r\n      super.hide();\r\n\r\n      this.prop.contentId = undefined;\r\n\r\n      this.psv.trigger(EVENTS.HIDE_OVERLAY, contentId);\r\n    }\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { PSVError } from '../PSVError';\r\n\r\nimport '../styles/panel.scss';\r\nimport { toggleClass } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\n/**\r\n * @summary Minimum width of the panel\r\n * @type {number}\r\n * @constant\r\n * @private\r\n */\r\nconst PANEL_MIN_WIDTH = 200;\r\n\r\n/**\r\n * @summary Panel class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Panel extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv, 'psv-panel');\r\n\r\n    /**\r\n     * @override\r\n     * @property {string} contentId\r\n     * @property {number} mouseX\r\n     * @property {number} mouseY\r\n     * @property {boolean} mousedown\r\n     * @property {function} clickHandler\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      visible     : false,\r\n      contentId   : undefined,\r\n      mouseX      : 0,\r\n      mouseY      : 0,\r\n      mousedown   : false,\r\n      clickHandler: null,\r\n    };\r\n\r\n    const resizer = document.createElement('div');\r\n    resizer.className = 'psv-panel-resizer';\r\n    this.container.appendChild(resizer);\r\n\r\n    const closeBtn = document.createElement('div');\r\n    closeBtn.className = 'psv-panel-close-button';\r\n    this.container.appendChild(closeBtn);\r\n\r\n    /**\r\n     * @summary Content container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-panel-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    // Stop wheel event bubling from panel\r\n    this.container.addEventListener(SYSTEM.mouseWheelEvent, e => e.stopPropagation());\r\n\r\n    closeBtn.addEventListener('click', () => this.hide());\r\n\r\n    // Event for panel resizing + stop bubling\r\n    resizer.addEventListener('mousedown', this);\r\n    resizer.addEventListener('touchstart', this);\r\n    this.psv.container.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchend', this);\r\n    this.psv.container.addEventListener('mousemove', this);\r\n    this.psv.container.addEventListener('touchmove', this);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.psv.container.removeEventListener('mousemove', this);\r\n    this.psv.container.removeEventListener('touchmove', this);\r\n    this.psv.container.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchend', this);\r\n\r\n    delete this.prop;\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'mousedown':  this.__onMouseDown(e);  break;\r\n      case 'touchstart': this.__onTouchStart(e); break;\r\n      case 'mousemove':  this.__onMouseMove(e);  break;\r\n      case 'touchmove':  this.__onTouchMove(e);  break;\r\n      case 'mouseup':    this.__onMouseUp(e);    break;\r\n      case 'touchend':   this.__onMouseUp(e);    break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @param {string} [id]\r\n   */\r\n  isVisible(id) {\r\n    return this.prop.visible && (!id || !this.prop.contentId || this.prop.contentId === id);\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  toggle() {\r\n    throw new PSVError('Panel cannot be toggled');\r\n  }\r\n\r\n  /**\r\n   * @summary Shows the panel\r\n   * @param {Object} config\r\n   * @param {string} [config.id]\r\n   * @param {string} config.content\r\n   * @param {boolean} [config.noMargin=false]\r\n   * @param {Function} [config.clickHandler]\r\n   * @fires PSV.open-panel\r\n   */\r\n  show(config) {\r\n    if (typeof config === 'string') {\r\n      config = { content: config }; // eslint-disable-line no-param-reassign\r\n    }\r\n\r\n    this.prop.contentId = config.id;\r\n    this.prop.visible = true;\r\n\r\n    if (this.prop.clickHandler) {\r\n      this.content.removeEventListener('click', this.prop.clickHandler);\r\n      this.prop.clickHandler = null;\r\n    }\r\n\r\n    this.content.innerHTML = config.content;\r\n    this.content.scrollTop = 0;\r\n    this.container.classList.add('psv-panel--open');\r\n\r\n    toggleClass(this.content, 'psv-panel-content--no-margin', config.noMargin === true);\r\n\r\n    if (config.clickHandler) {\r\n      this.prop.clickHandler = config.clickHandler;\r\n      this.content.addEventListener('click', config.clickHandler);\r\n    }\r\n\r\n    this.psv.trigger(EVENTS.OPEN_PANEL, config.id);\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the panel\r\n   * @param {string} [id]\r\n   * @fires PSV.close-panel\r\n   */\r\n  hide(id) {\r\n    if (this.isVisible(id)) {\r\n      const contentId = this.prop.contentId;\r\n\r\n      this.prop.visible = false;\r\n      this.prop.contentId = undefined;\r\n\r\n      this.content.innerHTML = null;\r\n      this.container.classList.remove('psv-panel--open');\r\n\r\n      if (this.prop.clickHandler) {\r\n        this.content.removeEventListener('click', this.prop.clickHandler);\r\n        this.prop.clickHandler = null;\r\n      }\r\n\r\n      this.psv.trigger(EVENTS.CLOSE_PANEL, contentId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse down events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseDown(evt) {\r\n    evt.stopPropagation();\r\n    this.__startResize(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchStart(evt) {\r\n    evt.stopPropagation();\r\n    this.__startResize(evt.changedTouches[0]);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse up events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseUp(evt) {\r\n    if (this.prop.mousedown) {\r\n      evt.stopPropagation();\r\n      this.prop.mousedown = false;\r\n      this.content.classList.remove('psv-panel-content--no-interaction');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse move events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseMove(evt) {\r\n    if (this.prop.mousedown) {\r\n      evt.stopPropagation();\r\n      this.__resize(evt);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch move events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchMove(evt) {\r\n    if (this.prop.mousedown) {\r\n      this.__resize(evt.touches[0]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes the panel resize\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __startResize(evt) {\r\n    this.prop.mouseX = evt.clientX;\r\n    this.prop.mouseY = evt.clientY;\r\n    this.prop.mousedown = true;\r\n    this.content.classList.add('psv-panel-content--no-interaction');\r\n  }\r\n\r\n  /**\r\n   * @summary Resizes the panel\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __resize(evt) {\r\n    const x = evt.clientX;\r\n    const y = evt.clientY;\r\n\r\n    this.container.style.width = Math.max(PANEL_MIN_WIDTH, this.container.offsetWidth - (x - this.prop.mouseX)) + 'px';\r\n\r\n    this.prop.mouseX = x;\r\n    this.prop.mouseY = y;\r\n  }\r\n\r\n}\r\n","/**\r\n * @namespace PSV.services\r\n */\r\n\r\n/**\r\n * @summary Base services class\r\n * @memberof PSV.services\r\n * @abstract\r\n */\r\nexport class AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    /**\r\n     * @summary Reference to main controller\r\n     * @type {PSV.Viewer}\r\n     * @readonly\r\n     */\r\n    this.psv = psv;\r\n\r\n    /**\r\n     * @summary Configuration holder\r\n     * @type {PSV.Options}\r\n     * @readonly\r\n     */\r\n    this.config = psv.config;\r\n\r\n    /**\r\n     * @summary Properties holder\r\n     * @type {Object}\r\n     * @readonly\r\n     */\r\n    this.prop = psv.prop;\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the service\r\n   */\r\n  destroy() {\r\n    delete this.psv;\r\n    delete this.config;\r\n    delete this.prop;\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { SPHERE_RADIUS } from '../data/constants';\r\nimport { PSVError } from '../PSVError';\r\nimport { parseAngle, parseSpeed } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Collections of data converters for the current viewer\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class DataHelper extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n  }\r\n\r\n  /**\r\n   * @summary Converts vertical FOV to zoom level\r\n   * @param {number} fov\r\n   * @returns {number}\r\n   */\r\n  fovToZoomLevel(fov) {\r\n    const temp = Math.round((fov - this.config.minFov) / (this.config.maxFov - this.config.minFov) * 100);\r\n    return temp - 2 * (temp - 50);\r\n  }\r\n\r\n  /**\r\n   * @summary Converts zoom level to vertical FOV\r\n   * @param {number} level\r\n   * @returns {number}\r\n   */\r\n  zoomLevelToFov(level) {\r\n    return this.config.maxFov + (level / 100) * (this.config.minFov - this.config.maxFov);\r\n  }\r\n\r\n  /**\r\n   * @summary Convert vertical FOV to horizontal FOV\r\n   * @param {number} vFov\r\n   * @returns {number}\r\n   */\r\n  vFovToHFov(vFov) {\r\n    return THREE.Math.radToDeg(2 * Math.atan(Math.tan(THREE.Math.degToRad(vFov) / 2) * this.prop.aspect));\r\n  }\r\n\r\n  /**\r\n   * @summary Converts a speed into a duration from current position to a new position\r\n   * @param {string|number} value\r\n   * @param {number} angle\r\n   * @returns {number}\r\n   */\r\n  speedToDuration(value, angle) {\r\n    if (!value || typeof value !== 'number') {\r\n      // desired radial speed\r\n      const speed = value ? parseSpeed(value) : this.config.autorotateSpeed;\r\n      // compute duration\r\n      return angle / Math.abs(speed) * 1000;\r\n    }\r\n    else {\r\n      return Math.abs(value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Converts pixel texture coordinates to spherical radians coordinates\r\n   * @param {PSV.Point} point\r\n   * @returns {PSV.Position}\r\n   */\r\n  textureCoordsToSphericalCoords(point) {\r\n    if (this.prop.isCubemap) {\r\n      throw new PSVError('Unable to use texture coords with cubemap.');\r\n    }\r\n\r\n    const panoData = this.prop.panoData;\r\n    const relativeX = (point.x + panoData.croppedX) / panoData.fullWidth * Math.PI * 2;\r\n    const relativeY = (point.y + panoData.croppedY) / panoData.fullHeight * Math.PI;\r\n\r\n    return {\r\n      longitude: relativeX >= Math.PI ? relativeX - Math.PI : relativeX + Math.PI,\r\n      latitude : Math.PI / 2 - relativeY,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Converts spherical radians coordinates to pixel texture coordinates\r\n   * @param {PSV.Position} position\r\n   * @returns {PSV.Point}\r\n   */\r\n  sphericalCoordsToTextureCoords(position) {\r\n    if (this.prop.isCubemap) {\r\n      throw new PSVError('Unable to use texture coords with cubemap.');\r\n    }\r\n\r\n    const panoData = this.prop.panoData;\r\n    const relativeLong = position.longitude / Math.PI / 2 * panoData.fullWidth;\r\n    const relativeLat = position.latitude / Math.PI * panoData.fullHeight;\r\n\r\n    return {\r\n      x: Math.round(position.longitude < Math.PI ? relativeLong + panoData.fullWidth / 2 : relativeLong - panoData.fullWidth / 2) - panoData.croppedX,\r\n      y: Math.round(panoData.fullHeight / 2 - relativeLat) - panoData.croppedY,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Converts spherical radians coordinates to a THREE.Vector3\r\n   * @param {PSV.Position} position\r\n   * @returns {external:THREE.Vector3}\r\n   */\r\n  sphericalCoordsToVector3(position) {\r\n    return new THREE.Vector3(\r\n      SPHERE_RADIUS * -Math.cos(position.latitude) * Math.sin(position.longitude),\r\n      SPHERE_RADIUS * Math.sin(position.latitude),\r\n      SPHERE_RADIUS * Math.cos(position.latitude) * Math.cos(position.longitude)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @summary Converts a THREE.Vector3 to spherical radians coordinates\r\n   * @param {external:THREE.Vector3} vector\r\n   * @returns {PSV.Position}\r\n   */\r\n  vector3ToSphericalCoords(vector) {\r\n    const phi = Math.acos(vector.y / Math.sqrt(vector.x * vector.x + vector.y * vector.y + vector.z * vector.z));\r\n    const theta = Math.atan2(vector.x, vector.z);\r\n\r\n    return {\r\n      longitude: theta < 0 ? -theta : Math.PI * 2 - theta,\r\n      latitude : Math.PI / 2 - phi,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Converts position on the viewer to a THREE.Vector3\r\n   * @param {PSV.Point} viewerPoint\r\n   * @returns {external:THREE.Vector3}\r\n   */\r\n  viewerCoordsToVector3(viewerPoint) {\r\n    const screen = new THREE.Vector2(\r\n      2 * viewerPoint.x / this.prop.size.width - 1,\r\n      -2 * viewerPoint.y / this.prop.size.height + 1\r\n    );\r\n\r\n    this.psv.renderer.raycaster.setFromCamera(screen, this.psv.renderer.camera);\r\n\r\n    const intersects = this.psv.renderer.raycaster.intersectObjects(this.psv.renderer.scene.children);\r\n\r\n    if (intersects.length === 1) {\r\n      return intersects[0].point;\r\n    }\r\n    else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Converts a THREE.Vector3 to position on the viewer\r\n   * @param {external:THREE.Vector3} vector\r\n   * @returns {PSV.Point}\r\n   */\r\n  vector3ToViewerCoords(vector) {\r\n    const vectorClone = vector.clone();\r\n    vectorClone.project(this.psv.renderer.camera);\r\n\r\n    return {\r\n      x: Math.round((vectorClone.x + 1) / 2 * this.prop.size.width),\r\n      y: Math.round((1 - vectorClone.y) / 2 * this.prop.size.height),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if an object is a {PSV.ExtendedPosition}, ie has x/y or longitude/latitude\r\n   * @param {object} object\r\n   * @returns {boolean}\r\n   */\r\n  isExtendedPosition(object) {\r\n    return [['x', 'y'], ['longitude', 'latitude']].some(([key1, key2]) => {\r\n      return key1 in object && key2 in object;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Converts x/y to latitude/longitude if present and ensure boundaries\r\n   * @param {PSV.ExtendedPosition} position\r\n   * @returns {PSV.Position}\r\n   */\r\n  cleanPosition(position) {\r\n    if ('x' in position && 'y' in position) {\r\n      return this.textureCoordsToSphericalCoords(position);\r\n    }\r\n    else {\r\n      return {\r\n        longitude: parseAngle(position.longitude),\r\n        latitude : parseAngle(position.latitude, true),\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Ensure a SphereCorrection object is valide\r\n   * @param {PSV.SphereCorrection} sphereCorrection\r\n   * @returns {PSV.SphereCorrection}\r\n   */\r\n  cleanSphereCorrection(sphereCorrection) {\r\n    return {\r\n      pan : parseAngle(sphereCorrection.pan || 0),\r\n      tilt: parseAngle(sphereCorrection.tilt || 0, true),\r\n      roll: parseAngle(sphereCorrection.roll || 0, true, false),\r\n    };\r\n  }\r\n\r\n}\r\n","import { Animation } from '../Animation';\r\nimport {\r\n  ACTIONS,\r\n  DBLCLICK_DELAY,\r\n  EVENTS,\r\n  IDS,\r\n  INERTIA_WINDOW,\r\n  LONGTOUCH_DELAY,\r\n  TWOFINGERSOVERLAY_DELAY,\r\n  MOVE_THRESHOLD\r\n} from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport gestureIcon from '../icons/gesture.svg';\r\nimport { clone, distance, getClosest, getEventKey, isFullscreenEnabled, normalizeWheel, throttle } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Events handler\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class EventsHandler extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @summary Internal properties\r\n     * @member {Object}\r\n     * @property {boolean} moving - is the user moving\r\n     * @property {boolean} zooming - is the user zooming\r\n     * @property {number} startMouseX - start x position of the click/touch\r\n     * @property {number} startMouseY - start y position of the click/touch\r\n     * @property {number} mouseX - current x position of the cursor\r\n     * @property {number} mouseY - current y position of the cursor\r\n     * @property {number[][]} mouseHistory - list of latest positions of the cursor, [time, x, y]\r\n     * @property {number} pinchDist - distance between fingers when zooming\r\n     * @property {PSV.ClickData} dblclickData - temporary storage of click data between two clicks\r\n     * @property {number} dblclickTimeout - timeout id for double click\r\n     * @protected\r\n     */\r\n    this.state = {\r\n      keyboardEnabled : false,\r\n      moving          : false,\r\n      zooming         : false,\r\n      startMouseX     : 0,\r\n      startMouseY     : 0,\r\n      mouseX          : 0,\r\n      mouseY          : 0,\r\n      mouseHistory    : [],\r\n      pinchDist       : 0,\r\n      dblclickData    : null,\r\n      dblclickTimeout : null,\r\n      longtouchTimeout: null,\r\n      twofingersTimeout: null,\r\n    };\r\n\r\n    /**\r\n     * @summary Throttled wrapper of {@link PSV.Viewer#autoSize}\r\n     * @type {Function}\r\n     * @private\r\n     */\r\n    this.__onResize = throttle(() => this.psv.autoSize(), 50);\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes event handlers\r\n   * @protected\r\n   */\r\n  init() {\r\n    window.addEventListener('resize', this);\r\n    window.addEventListener('keydown', this);\r\n    this.psv.container.addEventListener('mouseenter', this);\r\n    this.psv.container.addEventListener('mousedown', this);\r\n    this.psv.container.addEventListener('mouseleave', this);\r\n    window.addEventListener('mouseup', this);\r\n    this.psv.container.addEventListener('touchstart', this);\r\n    window.addEventListener('touchend', this);\r\n    this.psv.container.addEventListener('mousemove', this);\r\n    this.psv.container.addEventListener('touchmove', this);\r\n    this.psv.container.addEventListener(SYSTEM.mouseWheelEvent, this);\r\n\r\n    if (SYSTEM.fullscreenEvent) {\r\n      document.addEventListener(SYSTEM.fullscreenEvent, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    window.removeEventListener('resize', this);\r\n    window.removeEventListener('keydown', this);\r\n    this.psv.container.removeEventListener('mouseenter', this);\r\n    this.psv.container.removeEventListener('mousedown', this);\r\n    this.psv.container.removeEventListener('mouseleave', this);\r\n    window.removeEventListener('mouseup', this);\r\n    this.psv.container.removeEventListener('touchstart', this);\r\n    window.removeEventListener('touchend', this);\r\n    this.psv.container.removeEventListener('mousemove', this);\r\n    this.psv.container.removeEventListener('touchmove', this);\r\n    this.psv.container.removeEventListener(SYSTEM.mouseWheelEvent, this);\r\n\r\n    if (SYSTEM.fullscreenEvent) {\r\n      document.removeEventListener(SYSTEM.fullscreenEvent, this);\r\n    }\r\n\r\n    clearTimeout(this.state.dblclickTimeout);\r\n    clearTimeout(this.state.longtouchTimeout);\r\n    clearTimeout(this.state.twofingersTimeout);\r\n\r\n    delete this.state;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} evt\r\n   * @private\r\n   */\r\n  handleEvent(evt) {\r\n    /* eslint-disable */\r\n    switch (evt.type) {\r\n      // @formatter:off\r\n      case 'resize':   this.__onResize(); break;\r\n      case 'keydown':  this.__onKeyDown(evt); break;\r\n      case 'mouseup':  this.__onMouseUp(evt); break;\r\n      case 'touchend': this.__onTouchEnd(evt); break;\r\n      case SYSTEM.fullscreenEvent: this.__fullscreenToggled(); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n\r\n    if (!getClosest(evt.target, '.psv-navbar') && !getClosest(evt.target, '.psv-panel')) {\r\n      /* eslint-disable */\r\n      switch (evt.type) {\r\n        // @formatter:off\r\n        case 'mousedown':  this.__onMouseDown(evt); break;\r\n        case 'mouseenter': this.__onMouseEnter(evt); break;\r\n        case 'touchstart': this.__onTouchStart(evt); break;\r\n        case 'mouseleave': this.__onMouseLeave(evt); break;\r\n        case 'mousemove':  this.__onMouseMove(evt); break;\r\n        case 'touchmove':  this.__onTouchMove(evt); break;\r\n        case SYSTEM.mouseWheelEvent: this.__onMouseWheel(evt); break;\r\n        // @formatter:on\r\n      }\r\n      /* eslint-enable */\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enables the keyboard controls\r\n   * @protected\r\n   */\r\n  enableKeyboard() {\r\n    this.state.keyboardEnabled = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Disables the keyboard controls\r\n   * @protected\r\n   */\r\n  disableKeyboard() {\r\n    this.state.keyboardEnabled = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Handles keyboard events\r\n   * @param {KeyboardEvent} evt\r\n   * @private\r\n   */\r\n  __onKeyDown(evt) {\r\n    if (!this.state.keyboardEnabled) {\r\n      return;\r\n    }\r\n\r\n    let dLong = 0;\r\n    let dLat = 0;\r\n    let dZoom = 0;\r\n\r\n    const key = getEventKey(evt);\r\n    const action = this.config.keyboard[key];\r\n\r\n    /* eslint-disable */\r\n    switch (action) {\r\n      // @formatter:off\r\n      case ACTIONS.ROTATE_LAT_UP    : dLat = 0.01;   break;\r\n      case ACTIONS.ROTATE_LAT_DOWN  : dLat = -0.01;  break;\r\n      case ACTIONS.ROTATE_LONG_RIGHT: dLong = 0.01;  break;\r\n      case ACTIONS.ROTATE_LONG_LEFT : dLong = -0.01; break;\r\n      case ACTIONS.ZOOM_IN          : dZoom = 1;     break;\r\n      case ACTIONS.ZOOM_OUT         : dZoom = -1;    break;\r\n      case ACTIONS.TOGGLE_AUTOROTATE: this.psv.toggleAutorotate(); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n\r\n    if (dZoom !== 0) {\r\n      this.psv.zoom(this.prop.zoomLvl + dZoom * this.config.zoomButtonIncrement);\r\n    }\r\n    else if (dLat !== 0 || dLong !== 0) {\r\n      this.psv.rotate({\r\n        longitude: this.prop.position.longitude + dLong * this.prop.moveSpeed * this.prop.hFov,\r\n        latitude : this.prop.position.latitude + dLat * this.prop.moveSpeed * this.prop.vFov,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse down events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseDown(evt) {\r\n    if (!this.config.mousemove || this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__startMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse enter events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseEnter(evt) {\r\n    if (!this.config.mousemove || !this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__startMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse up events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseUp(evt) {\r\n    if (!this.config.mousemove || this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__stopMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse leave events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseLeave(evt) {\r\n    if (!this.config.mousemove || !this.config.captureCursor) {\r\n      return;\r\n    }\r\n\r\n    this.__stopMove(evt);\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse move events\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseMove(evt) {\r\n    if (!this.config.mousemove) {\r\n      return;\r\n    }\r\n\r\n    if (evt.buttons !== 0) {\r\n      evt.preventDefault();\r\n      this.__move(evt);\r\n    }\r\n    else if (this.config.captureCursor) {\r\n      this.__moveAbsolute(evt);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchStart(evt) {\r\n    if (!this.config.mousemove) {\r\n      return;\r\n    }\r\n\r\n    if (evt.touches.length === 1) {\r\n      if (!this.config.touchmoveTwoFingers) {\r\n        this.__startMove(evt.touches[0]);\r\n        evt.preventDefault(); // prevent mouse events emulation\r\n      }\r\n\r\n      if (!this.prop.longtouchTimeout) {\r\n        this.prop.longtouchTimeout = setTimeout(() => {\r\n          this.__click(evt.touches[0], true);\r\n          this.prop.longtouchTimeout = null;\r\n        }, LONGTOUCH_DELAY);\r\n      }\r\n    }\r\n    else if (evt.touches.length === 2) {\r\n      this.__cancelLongTouch();\r\n      this.__startMoveZoom(evt);\r\n      evt.preventDefault();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchEnd(evt) {\r\n    if (!this.config.mousemove) {\r\n      return;\r\n    }\r\n\r\n    this.__cancelLongTouch();\r\n\r\n    if (evt.touches.length === 1) {\r\n      this.__stopMoveZoom();\r\n    }\r\n    else if (evt.touches.length === 0) {\r\n      this.__stopMove(evt.changedTouches[0]);\r\n    }\r\n\r\n    if (this.config.touchmoveTwoFingers) {\r\n      this.__cancelTwoFingersOverlay();\r\n      this.psv.overlay.hide(IDS.TWO_FINGERS);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles touch move events\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __onTouchMove(evt) {\r\n    if (!this.config.mousemove) {\r\n      return;\r\n    }\r\n\r\n    if (evt.touches.length === 1) {\r\n      if (this.config.touchmoveTwoFingers) {\r\n        if (!this.prop.twofingersTimeout) {\r\n          this.prop.twofingersTimeout = setTimeout(() => {\r\n            this.psv.overlay.show({\r\n              id: IDS.TWO_FINGERS,\r\n              image: gestureIcon,\r\n              text: this.config.lang.twoFingers[0],\r\n            });\r\n          }, TWOFINGERSOVERLAY_DELAY);\r\n        }\r\n      }\r\n      else {\r\n        evt.preventDefault();\r\n        this.__move(evt.touches[0]);\r\n      }\r\n    }\r\n    else if (evt.touches.length === 2) {\r\n      evt.preventDefault();\r\n      this.__moveZoom(evt);\r\n      if (this.config.touchmoveTwoFingers) {\r\n        this.__cancelTwoFingersOverlay();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Cancel the long touch timer if any\r\n   * @private\r\n   */\r\n  __cancelLongTouch() {\r\n    if (this.prop.longtouchTimeout) {\r\n      clearTimeout(this.prop.longtouchTimeout);\r\n      this.prop.longtouchTimeout = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Cancel the two fingers overlay timer if any\r\n   * @private\r\n   */\r\n  __cancelTwoFingersOverlay() {\r\n    if (this.prop.twofingersTimeout) {\r\n      clearTimeout(this.prop.twofingersTimeout);\r\n      this.prop.twofingersTimeout = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles mouse wheel events\r\n   * @param {MouseWheelEvent} evt\r\n   * @private\r\n   */\r\n  __onMouseWheel(evt) {\r\n    if (!this.config.mousewheel) {\r\n      return;\r\n    }\r\n\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n\r\n    const delta = normalizeWheel(evt).spinY * 5;\r\n\r\n    if (delta !== 0) {\r\n      this.psv.zoom(this.prop.zoomLvl - delta * this.config.mousewheelSpeed);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Handles fullscreen events\r\n   * @param {boolean} [force] force state\r\n   * @fires PSV.fullscreen-updated\r\n   * @package\r\n   */\r\n  __fullscreenToggled(force) {\r\n    this.prop.fullscreen = force !== undefined ? force : isFullscreenEnabled(this.psv.container);\r\n\r\n    if (this.config.keyboard) {\r\n      if (this.prop.fullscreen) {\r\n        this.psv.startKeyboardControl();\r\n      }\r\n      else {\r\n        this.psv.stopKeyboardControl();\r\n      }\r\n    }\r\n\r\n    this.psv.trigger(EVENTS.FULLSCREEN_UPDATED, this.prop.fullscreen);\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes the movement\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __startMove(evt) {\r\n    this.psv.stopAutorotate();\r\n    this.psv.stopAnimation()\r\n      .then(() => {\r\n        this.state.mouseX = evt.clientX;\r\n        this.state.mouseY = evt.clientY;\r\n        this.state.startMouseX = this.state.mouseX;\r\n        this.state.startMouseY = this.state.mouseY;\r\n        this.state.moving = true;\r\n        this.state.zooming = false;\r\n\r\n        this.state.mouseHistory.length = 0;\r\n        this.__logMouseMove(evt);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Initializes the combines move and zoom\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __startMoveZoom(evt) {\r\n    const p1 = { x: evt.touches[0].clientX, y: evt.touches[0].clientY };\r\n    const p2 = { x: evt.touches[1].clientX, y: evt.touches[1].clientY };\r\n\r\n    this.state.pinchDist = distance(p1, p2);\r\n    this.state.mouseX = (p1.x + p2.x) / 2;\r\n    this.state.mouseY = (p1.y + p2.y) / 2;\r\n    this.state.startMouseX = this.state.mouseX;\r\n    this.state.startMouseY = this.state.mouseY;\r\n    this.state.moving = true;\r\n    this.state.zooming = true;\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the movement\r\n   * @description If the move threshold was not reached a click event is triggered, otherwise an animation is launched to simulate inertia\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __stopMove(evt) {\r\n    if (!getClosest(evt.target, '.psv-container')) {\r\n      this.state.moving = false;\r\n      this.state.mouseHistory.length = 0;\r\n      return;\r\n    }\r\n\r\n    if (this.state.moving) {\r\n      // move threshold to trigger a click\r\n      if (Math.abs(evt.clientX - this.state.startMouseX) < MOVE_THRESHOLD && Math.abs(evt.clientY - this.state.startMouseY) < MOVE_THRESHOLD) {\r\n        this.__click(evt);\r\n        this.state.moving = false;\r\n      }\r\n      // inertia animation\r\n      else if (this.config.moveInertia) {\r\n        this.__logMouseMove(evt);\r\n        this.__stopMoveInertia(evt);\r\n      }\r\n      else {\r\n        this.state.moving = false;\r\n      }\r\n\r\n      this.state.mouseHistory.length = 0;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the combined move and zoom\r\n   * @private\r\n   */\r\n  __stopMoveZoom() {\r\n    this.state.mouseHistory.length = 0;\r\n    this.state.moving = false;\r\n    this.state.zooming = false;\r\n  }\r\n\r\n  /**\r\n   * @summary Performs an animation to simulate inertia when the movement stops\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __stopMoveInertia(evt) {\r\n    const direction = {\r\n      x: evt.clientX - this.state.mouseHistory[0][1],\r\n      y: evt.clientY - this.state.mouseHistory[0][2],\r\n    };\r\n\r\n    const norm = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\r\n\r\n    this.prop.animationPromise = new Animation({\r\n      properties: {\r\n        clientX: { start: evt.clientX, end: evt.clientX + direction.x },\r\n        clientY: { start: evt.clientY, end: evt.clientY + direction.y },\r\n      },\r\n      duration  : norm * INERTIA_WINDOW / 100,\r\n      easing    : 'outCirc',\r\n      onTick    : (properties) => {\r\n        this.__move(properties, false);\r\n      },\r\n    })\r\n      .finally(() => {\r\n        this.state.moving = false;\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Triggers an event with all coordinates when a simple click is performed\r\n   * @param {MouseEvent|Touch} evt\r\n   * @param {boolean} [longtouch=false]\r\n   * @fires PSV.click\r\n   * @fires PSV.dblclick\r\n   * @private\r\n   */\r\n  __click(evt, longtouch = false) {\r\n    const boundingRect = this.psv.container.getBoundingClientRect();\r\n\r\n    /**\r\n     * @type {PSV.ClickData}\r\n     */\r\n    const data = {\r\n      rightclick: longtouch || evt.button === 2,\r\n      target    : evt.target,\r\n      clientX   : evt.clientX,\r\n      clientY   : evt.clientY,\r\n      viewerX   : evt.clientX - boundingRect.left,\r\n      viewerY   : evt.clientY - boundingRect.top,\r\n    };\r\n\r\n    const intersect = this.psv.dataHelper.viewerCoordsToVector3({\r\n      x: data.viewerX,\r\n      y: data.viewerY,\r\n    });\r\n\r\n    if (intersect) {\r\n      const sphericalCoords = this.psv.dataHelper.vector3ToSphericalCoords(intersect);\r\n      data.longitude = sphericalCoords.longitude;\r\n      data.latitude = sphericalCoords.latitude;\r\n\r\n      // TODO: for cubemap, computes texture's index and coordinates\r\n      if (!this.prop.isCubemap) {\r\n        const textureCoords = this.psv.dataHelper.sphericalCoordsToTextureCoords(data);\r\n        data.textureX = textureCoords.x;\r\n        data.textureY = textureCoords.y;\r\n      }\r\n\r\n      if (!this.state.dblclickTimeout) {\r\n        this.psv.trigger(EVENTS.CLICK, data);\r\n\r\n        this.state.dblclickData = clone(data);\r\n        this.state.dblclickTimeout = setTimeout(() => {\r\n          this.state.dblclickTimeout = null;\r\n          this.state.dblclickData = null;\r\n        }, DBLCLICK_DELAY);\r\n      }\r\n      else {\r\n        if (Math.abs(this.state.dblclickData.clientX - data.clientX) < MOVE_THRESHOLD\r\n          && Math.abs(this.state.dblclickData.clientY - data.clientY) < MOVE_THRESHOLD) {\r\n          this.psv.trigger(EVENTS.DOUBLE_CLICK, this.state.dblclickData);\r\n        }\r\n\r\n        clearTimeout(this.state.dblclickTimeout);\r\n        this.state.dblclickTimeout = null;\r\n        this.state.dblclickData = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Performs movement\r\n   * @param {MouseEvent|Touch} evt\r\n   * @param {boolean} [log=true]\r\n   * @private\r\n   */\r\n  __move(evt, log) {\r\n    if (this.state.moving) {\r\n      const x = evt.clientX;\r\n      const y = evt.clientY;\r\n\r\n      const rotation = {\r\n        longitude: (x - this.state.mouseX) / this.prop.size.width * this.prop.moveSpeed * this.prop.hFov * SYSTEM.pixelRatio,\r\n        latitude : (y - this.state.mouseY) / this.prop.size.height * this.prop.moveSpeed * this.prop.vFov * SYSTEM.pixelRatio,\r\n      };\r\n\r\n      this.psv.rotate({\r\n        longitude: this.prop.position.longitude - rotation.longitude,\r\n        latitude : this.prop.position.latitude + rotation.latitude,\r\n      });\r\n\r\n      this.state.mouseX = x;\r\n      this.state.mouseY = y;\r\n\r\n      if (log !== false) {\r\n        this.__logMouseMove(evt);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Performs movement absolute to cursor position in viewer\r\n   * @param {MouseEvent} evt\r\n   * @private\r\n   */\r\n  __moveAbsolute(evt) {\r\n    if (this.state.moving) {\r\n      const containerRect = this.psv.container.getBoundingClientRect();\r\n      this.psv.rotate({\r\n        longitude: ((evt.clientX - containerRect.left) / containerRect.width - 0.5) * Math.PI * 2,\r\n        latitude : -((evt.clientY - containerRect.top) / containerRect.height - 0.5) * Math.PI,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Perfoms combined move and zoom\r\n   * @param {TouchEvent} evt\r\n   * @private\r\n   */\r\n  __moveZoom(evt) {\r\n    if (this.state.zooming && this.state.moving) {\r\n      const p1 = { x: evt.touches[0].clientX, y: evt.touches[0].clientY };\r\n      const p2 = { x: evt.touches[1].clientX, y: evt.touches[1].clientY };\r\n\r\n      const p = distance(p1, p2);\r\n      const delta = 80 * (p - this.state.pinchDist) / this.prop.size.width;\r\n\r\n      this.psv.zoom(this.prop.zoomLvl + delta);\r\n\r\n      this.__move({\r\n        clientX: (p1.x + p2.x) / 2,\r\n        clientY: (p1.y + p2.y) / 2,\r\n      });\r\n\r\n      this.state.pinchDist = p;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Stores each mouse position during a mouse move\r\n   * @description Positions older than \"INERTIA_WINDOW\" are removed<br>\r\n   *     Positions before a pause of \"INERTIA_WINDOW\" / 10 are removed\r\n   * @param {MouseEvent|Touch} evt\r\n   * @private\r\n   */\r\n  __logMouseMove(evt) {\r\n    const now = Date.now();\r\n    this.state.mouseHistory.push([now, evt.clientX, evt.clientY]);\r\n\r\n    let previous = null;\r\n\r\n    for (let i = 0; i < this.state.mouseHistory.length;) {\r\n      if (this.state.mouseHistory[0][i] < now - INERTIA_WINDOW) {\r\n        this.state.mouseHistory.splice(i, 1);\r\n      }\r\n      else if (previous && this.state.mouseHistory[0][i] - previous > INERTIA_WINDOW / 10) {\r\n        this.state.mouseHistory.splice(0, i);\r\n        i = 0;\r\n        previous = this.state.mouseHistory[0][i];\r\n      }\r\n      else {\r\n        i++;\r\n        previous = this.state.mouseHistory[0][i];\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { Animation } from '../Animation';\r\nimport { CUBE_VERTICES, EVENTS, SPHERE_RADIUS, SPHERE_VERTICES } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { logWarn } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Viewer and renderer\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class Renderer extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @member {number}\r\n     * @private\r\n     */\r\n    this.mainReqid = undefined;\r\n\r\n    /**\r\n     * @member {external:THREE.WebGLRenderer}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.renderer = null;\r\n\r\n    /**\r\n     * @member {external:THREE.Scene}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.scene = null;\r\n\r\n    /**\r\n     * @member {external:THREE.PerspectiveCamera}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.camera = null;\r\n\r\n    /**\r\n     * @member {external:THREE.Mesh}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.mesh = null;\r\n\r\n    /**\r\n     * @member {external:THREE.Raycaster}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.raycaster = null;\r\n\r\n    /**\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @protected\r\n     */\r\n    this.canvasContainer = document.createElement('div');\r\n    this.canvasContainer.className = 'psv-canvas-container';\r\n    this.canvasContainer.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\r\n    this.psv.container.appendChild(this.canvasContainer);\r\n\r\n    psv.on(EVENTS.SIZE_UPDATED, (e, size) => {\r\n      if (this.renderer) {\r\n        this.renderer.setSize(size.width, size.height);\r\n      }\r\n    });\r\n\r\n    psv.on(EVENTS.CONFIG_CHANGED, () => {\r\n      this.canvasContainer.style.cursor = this.psv.config.mousemove ? 'move' : 'default';\r\n    });\r\n\r\n    this.hide();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    // cancel render loop\r\n    if (this.mainReqid) {\r\n      window.cancelAnimationFrame(this.mainReqid);\r\n    }\r\n\r\n    // destroy ThreeJS view\r\n    if (this.scene) {\r\n      this.__cleanTHREEScene(this.scene);\r\n    }\r\n\r\n    // remove container\r\n    this.psv.container.removeChild(this.canvasContainer);\r\n\r\n    delete this.canvasContainer;\r\n    delete this.renderer;\r\n    delete this.scene;\r\n    delete this.camera;\r\n    delete this.mesh;\r\n    delete this.raycaster;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the viewer\r\n   */\r\n  hide() {\r\n    this.canvasContainer.style.opacity = 0;\r\n  }\r\n\r\n  /**\r\n   * @summary Shows the viewer\r\n   */\r\n  show() {\r\n    this.canvasContainer.style.opacity = 1;\r\n  }\r\n\r\n  /**\r\n   * @summary Main event loop, calls {@link render} if `prop.needsUpdate` is true\r\n   * @param {number} timestamp\r\n   * @fires PSV.before-render\r\n   * @package\r\n   */\r\n  __renderLoop(timestamp) {\r\n    this.psv.trigger(EVENTS.BEFORE_RENDER, timestamp);\r\n\r\n    if (this.prop.needsUpdate) {\r\n      this.render();\r\n      this.prop.needsUpdate = false;\r\n    }\r\n\r\n    this.mainReqid = window.requestAnimationFrame(t => this.__renderLoop(t));\r\n  }\r\n\r\n  /**\r\n   * @summary Performs a render\r\n   * @description Do not call this method directly, instead call\r\n   * {@link PSV.Viewer#needsUpdate} on {@link PSV.event:before-render}.\r\n   * @fires PSV.render\r\n   */\r\n  render() {\r\n    this.prop.direction = this.psv.dataHelper.sphericalCoordsToVector3(this.prop.position);\r\n    this.camera.position.set(0, 0, 0);\r\n    this.camera.lookAt(this.prop.direction);\r\n\r\n    if (this.config.fisheye) {\r\n      this.camera.position.copy(this.prop.direction).multiplyScalar(this.config.fisheye / 2).negate();\r\n    }\r\n\r\n    this.camera.aspect = this.prop.aspect;\r\n    this.camera.fov = this.prop.vFov;\r\n    this.camera.updateProjectionMatrix();\r\n\r\n    this.renderer.render(this.scene, this.camera);\r\n\r\n    this.psv.trigger(EVENTS.RENDER);\r\n  }\r\n\r\n  /**\r\n   * @summary Applies the texture to the scene, creates the scene if needed\r\n   * @param {PSV.TextureData} textureData\r\n   * @fires PSV.panorama-loaded\r\n   * @package\r\n   */\r\n  setTexture(textureData) {\r\n    const { texture, panoData } = textureData;\r\n    this.prop.panoData = panoData;\r\n\r\n    if (!this.scene) {\r\n      this.__createScene();\r\n    }\r\n\r\n    if (this.prop.isCubemap) {\r\n      for (let i = 0; i < 6; i++) {\r\n        if (this.mesh.material[i].map) {\r\n          this.mesh.material[i].map.dispose();\r\n        }\r\n\r\n        this.mesh.material[i].map = texture[i];\r\n      }\r\n    }\r\n    else {\r\n      if (this.mesh.material.map) {\r\n        this.mesh.material.map.dispose();\r\n      }\r\n\r\n      this.mesh.material.map = texture;\r\n    }\r\n\r\n    this.psv.needsUpdate();\r\n\r\n    this.psv.trigger(EVENTS.PANORAMA_LOADED);\r\n  }\r\n\r\n  /**\r\n   * @summary Apply a SphereCorrection to a Mesh\r\n   * @param {PSV.SphereCorrection} sphereCorrection\r\n   * @param {external:THREE.Mesh} [mesh=this.mesh]\r\n   * @package\r\n   */\r\n  setSphereCorrection(sphereCorrection, mesh = this.mesh) {\r\n    const cleanCorrection = this.psv.dataHelper.cleanSphereCorrection(sphereCorrection);\r\n\r\n    mesh.rotation.set(\r\n      cleanCorrection.tilt,\r\n      cleanCorrection.pan,\r\n      cleanCorrection.roll\r\n    );\r\n  }\r\n\r\n  /**\r\n   * @summary Creates the 3D scene and GUI components\r\n   * @private\r\n   */\r\n  __createScene() {\r\n    this.raycaster = new THREE.Raycaster();\r\n\r\n    this.renderer = new THREE.WebGLRenderer();\r\n    this.renderer.setSize(this.prop.size.width, this.prop.size.height);\r\n    this.renderer.setPixelRatio(SYSTEM.pixelRatio);\r\n\r\n    this.camera = new THREE.PerspectiveCamera(this.prop.vFov, this.prop.size.width / this.prop.size.height, 1, 3 * SPHERE_RADIUS);\r\n    this.camera.position.set(0, 0, 0);\r\n\r\n    this.scene = new THREE.Scene();\r\n    this.scene.add(this.camera);\r\n\r\n    if (this.prop.isCubemap) {\r\n      this.mesh = this.__createCubemap();\r\n    }\r\n    else {\r\n      this.mesh = this.__createSphere();\r\n    }\r\n\r\n    this.scene.add(this.mesh);\r\n\r\n    // create canvas container\r\n    this.renderer.domElement.className = 'psv-canvas';\r\n    this.canvasContainer.appendChild(this.renderer.domElement);\r\n  }\r\n\r\n  /**\r\n   * @summary Creates the sphere mesh\r\n   * @param {number} [scale=1]\r\n   * @returns {external:THREE.Mesh}\r\n   * @private\r\n   */\r\n  __createSphere(scale = 1) {\r\n    // The middle of the panorama is placed at longitude=0\r\n    const geometry = new THREE.SphereGeometry(SPHERE_RADIUS * scale, SPHERE_VERTICES, SPHERE_VERTICES, -Math.PI / 2);\r\n\r\n    const material = new THREE.MeshBasicMaterial({\r\n      side: THREE.BackSide,\r\n    });\r\n\r\n    const mesh = new THREE.Mesh(geometry, material);\r\n    mesh.scale.set(-1, 1, 1);\r\n\r\n    return mesh;\r\n  }\r\n\r\n  /**\r\n   * @summary Creates the cube mesh\r\n   * @param {number} [scale=1]\r\n   * @returns {external:THREE.Mesh}\r\n   * @private\r\n   */\r\n  __createCubemap(scale = 1) {\r\n    const cubeSize = SPHERE_RADIUS * 2 * scale;\r\n    const geometry = new THREE.BoxGeometry(cubeSize, cubeSize, cubeSize, CUBE_VERTICES, CUBE_VERTICES, CUBE_VERTICES);\r\n\r\n    const materials = [];\r\n    for (let i = 0; i < 6; i++) {\r\n      materials.push(new THREE.MeshBasicMaterial({\r\n        side: THREE.BackSide,\r\n      }));\r\n    }\r\n\r\n    const mesh = new THREE.Mesh(geometry, materials);\r\n    mesh.scale.set(1, 1, -1);\r\n\r\n    return mesh;\r\n  }\r\n\r\n  /**\r\n   * @summary Performs transition between the current and a new texture\r\n   * @param {PSV.TextureData} textureData\r\n   * @param {PSV.PanoramaOptions} options\r\n   * @returns {PSV.Animation}\r\n   * @package\r\n   */\r\n  transition(textureData, options) {\r\n    const { texture } = textureData;\r\n\r\n    let positionProvided = this.psv.dataHelper.isExtendedPosition(options);\r\n    const zoomProvided = 'zoom' in options;\r\n\r\n    let mesh;\r\n\r\n    if (this.prop.isCubemap) {\r\n      if (positionProvided) {\r\n        logWarn('cannot perform cubemap transition to different position');\r\n        positionProvided = false;\r\n      }\r\n\r\n      mesh = this.__createCubemap(0.9);\r\n\r\n      mesh.material.forEach((material, i) => {\r\n        material.map = texture[i];\r\n        material.transparent = true;\r\n        material.opacity = 0;\r\n      });\r\n    }\r\n    else {\r\n      mesh = this.__createSphere(0.9);\r\n\r\n      mesh.material.map = texture;\r\n      mesh.material.transparent = true;\r\n      mesh.material.opacity = 0;\r\n\r\n      if (options.sphereCorrection) {\r\n        this.setSphereCorrection(options.sphereCorrection, mesh);\r\n      }\r\n    }\r\n\r\n    // rotate the new sphere to make the target position face the camera\r\n    if (positionProvided) {\r\n      const cleanPosition = this.psv.dataHelper.cleanPosition(options);\r\n\r\n      // Longitude rotation along the vertical axis\r\n      const verticalAxis = new THREE.Vector3(0, 1, 0);\r\n      mesh.rotateOnWorldAxis(verticalAxis, cleanPosition.longitude - this.prop.position.longitude);\r\n\r\n      // Latitude rotation along the camera horizontal axis\r\n      const horizontalAxis = new THREE.Vector3(0, 1, 0).cross(this.camera.getWorldDirection(new THREE.Vector3())).normalize();\r\n      mesh.rotateOnWorldAxis(horizontalAxis, cleanPosition.latitude - this.prop.position.latitude);\r\n\r\n      // TODO: find a better way to handle ranges\r\n      if (this.config.latitudeRange || this.config.longitudeRange) {\r\n        this.config.longitudeRange = null;\r\n        this.config.latitudeRange = null;\r\n        logWarn('trying to perform transition with longitudeRange and/or latitudeRange, ranges cleared');\r\n      }\r\n    }\r\n\r\n    this.scene.add(mesh);\r\n    this.psv.needsUpdate();\r\n\r\n    return new Animation({\r\n      properties: {\r\n        opacity: { start: 0.0, end: 1.0 },\r\n        zoom   : zoomProvided ? { start: this.prop.zoomLvl, end: options.zoom } : undefined,\r\n      },\r\n      duration  : options.transition,\r\n      easing    : 'outCubic',\r\n      onTick    : (properties) => {\r\n        if (this.prop.isCubemap) {\r\n          for (let i = 0; i < 6; i++) {\r\n            mesh.material[i].opacity = properties.opacity;\r\n          }\r\n        }\r\n        else {\r\n          mesh.material.opacity = properties.opacity;\r\n        }\r\n\r\n        if (zoomProvided) {\r\n          this.psv.zoom(properties.zoom);\r\n        }\r\n\r\n        this.psv.needsUpdate();\r\n      },\r\n    })\r\n      .then(() => {\r\n        // remove temp sphere and transfer the texture to the main sphere\r\n        this.setTexture(textureData);\r\n        this.scene.remove(mesh);\r\n\r\n        mesh.geometry.dispose();\r\n        mesh.geometry = null;\r\n\r\n        if (options.sphereCorrection) {\r\n          this.setSphereCorrection(options.sphereCorrection);\r\n        }\r\n        else {\r\n          this.setSphereCorrection({});\r\n        }\r\n\r\n        // actually rotate the camera\r\n        if (positionProvided) {\r\n          this.psv.rotate(options);\r\n        }\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Calls `dispose` on all objects and textures\r\n   * @param {external:THREE.Object3D} object\r\n   * @private\r\n   */\r\n  __cleanTHREEScene(object) {\r\n    object.traverse((item) => {\r\n      if (item.geometry) {\r\n        item.geometry.dispose();\r\n      }\r\n\r\n      if (item.material) {\r\n        if (Array.isArray(item.material)) {\r\n          item.material.forEach((material) => {\r\n            if (material.map) {\r\n              material.map.dispose();\r\n            }\r\n\r\n            material.dispose();\r\n          });\r\n        }\r\n        else {\r\n          if (item.material.map) {\r\n            item.material.map.dispose();\r\n          }\r\n\r\n          item.material.dispose();\r\n        }\r\n      }\r\n\r\n      if (item.dispose) {\r\n        item.dispose();\r\n      }\r\n\r\n      if (item !== object) {\r\n        this.__cleanTHREEScene(item);\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { CUBE_HASHMAP, CUBE_MAP } from '../data/constants';\r\nimport { SYSTEM } from '../data/system';\r\nimport { PSVError } from '../PSVError';\r\nimport { getXMPValue, logWarn, sum } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Texture loader\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class TextureLoader extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @summary Current HTTP requests\r\n     * @type {XMLHttpRequest[]}\r\n     * @private\r\n     */\r\n    this.requests = [];\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    this.abortLoading();\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Loads the panorama texture(s)\r\n   * @param {string|string[]|PSV.Cubemap} panorama\r\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\r\n   * @returns {Promise.<PSV.TextureData>}\r\n   * @throws {PSV.PSVError} when the image cannot be loaded\r\n   * @package\r\n   */\r\n  loadTexture(panorama, newPanoData) {\r\n    const tempPanorama = [];\r\n\r\n    if (Array.isArray(panorama)) {\r\n      if (panorama.length !== 6) {\r\n        throw new PSVError('Must provide exactly 6 image paths when using cubemap.');\r\n      }\r\n\r\n      // reorder images\r\n      for (let i = 0; i < 6; i++) {\r\n        tempPanorama[i] = panorama[CUBE_MAP[i]];\r\n      }\r\n\r\n      return this.__loadCubemapTexture(tempPanorama);\r\n    }\r\n    else if (typeof panorama === 'object') {\r\n      if (!CUBE_HASHMAP.every(side => !!panorama[side])) {\r\n        throw new PSVError('Must provide exactly left, front, right, back, top, bottom when using cubemap.');\r\n      }\r\n\r\n      // transform into array\r\n      CUBE_HASHMAP.forEach((side, i) => {\r\n        tempPanorama[i] = panorama[side];\r\n      });\r\n\r\n      return this.__loadCubemapTexture(tempPanorama);\r\n    }\r\n    else {\r\n      return this.__loadEquirectangularTexture(panorama, newPanoData);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Cancels current HTTP requests\r\n   */\r\n  abortLoading() {\r\n    [...this.requests].forEach(r => r.abort());\r\n  }\r\n\r\n  /**\r\n   * @summary Loads a Blob with FileLoader\r\n   * @param {string} url\r\n   * @param {function(number)} [onProgress]\r\n   * @returns {Promise<Blob>}\r\n   * @private\r\n   */\r\n  __loadFile(url, onProgress) {\r\n    return new Promise((resolve, reject) => {\r\n      let progress = 0;\r\n      onProgress && onProgress(progress);\r\n\r\n      const loader = new THREE.FileLoader();\r\n\r\n      if (this.config.withCredentials) {\r\n        loader.setWithCredentials(true);\r\n      }\r\n\r\n      loader.setResponseType('blob');\r\n\r\n      const request = loader.load(\r\n        url,\r\n        (result) => {\r\n          const rIdx = this.requests.indexOf(request);\r\n          if (rIdx !== -1) this.requests.splice(rIdx, 1);\r\n\r\n          progress = 100;\r\n          onProgress && onProgress(progress);\r\n          resolve(result);\r\n        },\r\n        (e) => {\r\n          if (e.lengthComputable) {\r\n            const newProgress = e.loaded / e.total * 100;\r\n            if (newProgress > progress) {\r\n              progress = newProgress;\r\n              onProgress && onProgress(progress);\r\n            }\r\n          }\r\n        },\r\n        (err) => {\r\n          const rIdx = this.requests.indexOf(request);\r\n          if (rIdx !== -1) this.requests.splice(rIdx, 1);\r\n\r\n          reject(err);\r\n        }\r\n      );\r\n\r\n      // when we hit the cache, the result is the cache value\r\n      if (request instanceof XMLHttpRequest) {\r\n        this.requests.push(request);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Loads an Image using FileLoader to have progress events\r\n   * @param {string} url\r\n   * @param {function(number)} [onProgress]\r\n   * @returns {Promise<Image>}\r\n   * @private\r\n   */\r\n  __loadImage(url, onProgress) {\r\n    return this.__loadFile(url, onProgress)\r\n      .then(result => new Promise((resolve, reject) => {\r\n        const img = document.createElementNS('http://www.w3.org/1999/xhtml', 'img');\r\n        img.onload = () => {\r\n          URL.revokeObjectURL(img.src);\r\n          resolve(img);\r\n        };\r\n        img.onerror = reject;\r\n        img.src = URL.createObjectURL(result);\r\n      }));\r\n  }\r\n\r\n  /**\r\n   * @summmary read a Blob as string\r\n   * @param {Blob} blob\r\n   * @returns {Promise<string>}\r\n   * @private\r\n   */\r\n  __loadBlobAsString(blob) {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = () => resolve(reader.result);\r\n      reader.onerror = reject;\r\n      reader.readAsText(blob);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Loads the sphere texture\r\n   * @param {string} panorama\r\n   * @param {PSV.PanoData | PSV.PanoDataProvider} [newPanoData]\r\n   * @returns {Promise.<PSV.TextureData>}\r\n   * @throws {PSV.PSVError} when the image cannot be loaded\r\n   * @private\r\n   */\r\n  __loadEquirectangularTexture(panorama, newPanoData) {\r\n    /* eslint no-shadow: [\"error\", {allow: [\"newPanoData\"]}] */\r\n    if (this.prop.isCubemap === true) {\r\n      throw new PSVError('The viewer was initialized with an cubemap, cannot switch to equirectangular panorama.');\r\n    }\r\n\r\n    this.prop.isCubemap = false;\r\n\r\n    return (\r\n      newPanoData || !this.config.useXmpData\r\n        ? this.__loadImage(panorama, p => this.psv.loader.setProgress(p))\r\n          .then(img => ({ img, newPanoData }))\r\n        : this.__loadXMP(panorama, p => this.psv.loader.setProgress(p))\r\n          .then(newPanoData => this.__loadImage(panorama).then(img => ({ img, newPanoData })))\r\n    )\r\n      .then(({ img, newPanoData }) => {\r\n        if (typeof newPanoData === 'function') {\r\n          // eslint-disable-next-line no-param-reassign\r\n          newPanoData = newPanoData(img);\r\n        }\r\n\r\n        const panoData = newPanoData || {\r\n          fullWidth    : img.width,\r\n          fullHeight   : img.height,\r\n          croppedWidth : img.width,\r\n          croppedHeight: img.height,\r\n          croppedX     : 0,\r\n          croppedY     : 0,\r\n        };\r\n\r\n        if (panoData.croppedWidth !== img.width || panoData.croppedHeight !== img.height) {\r\n          logWarn(`Invalid panoData, croppedWidth and/or croppedHeight is not coherent with loaded image\r\n    panoData: ${panoData.croppedWidth}x${panoData.croppedHeight}, image: ${img.width}x${img.height}`);\r\n        }\r\n\r\n        const texture = this.__createEquirectangularTexture(img, panoData);\r\n\r\n        return { texture, panoData };\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Loads the XMP data of an image\r\n   * @param {string} panorama\r\n   * @param {function(number)} [onProgress]\r\n   * @returns {Promise<PSV.PanoData>}\r\n   * @throws {PSV.PSVError} when the image cannot be loaded\r\n   * @private\r\n   */\r\n  __loadXMP(panorama, onProgress) {\r\n    return this.__loadFile(panorama, onProgress)\r\n      .then(blob => this.__loadBlobAsString(blob))\r\n      .then((binary) => {\r\n        const a = binary.indexOf('<x:xmpmeta');\r\n        const b = binary.indexOf('</x:xmpmeta>');\r\n        const data = binary.substring(a, b);\r\n        let panoData = null;\r\n\r\n        if (a !== -1 && b !== -1 && data.indexOf('GPano:') !== -1) {\r\n          panoData = {\r\n            fullWidth    : parseInt(getXMPValue(data, 'FullPanoWidthPixels'), 10),\r\n            fullHeight   : parseInt(getXMPValue(data, 'FullPanoHeightPixels'), 10),\r\n            croppedWidth : parseInt(getXMPValue(data, 'CroppedAreaImageWidthPixels'), 10),\r\n            croppedHeight: parseInt(getXMPValue(data, 'CroppedAreaImageHeightPixels'), 10),\r\n            croppedX     : parseInt(getXMPValue(data, 'CroppedAreaLeftPixels'), 10),\r\n            croppedY     : parseInt(getXMPValue(data, 'CroppedAreaTopPixels'), 10),\r\n          };\r\n\r\n          if (!panoData.fullWidth || !panoData.fullHeight || !panoData.croppedWidth || !panoData.croppedHeight) {\r\n            logWarn('invalid XMP data');\r\n            panoData = null;\r\n          }\r\n        }\r\n\r\n        return panoData;\r\n      });\r\n  }\r\n\r\n  /**\r\n   * @summary Creates the final texture from image and panorama data\r\n   * @param {Image} img\r\n   * @param {PSV.PanoData} panoData\r\n   * @returns {external:THREE.Texture}\r\n   * @private\r\n   */\r\n  __createEquirectangularTexture(img, panoData) {\r\n    let texture;\r\n\r\n    // resize image / fill cropped parts with black\r\n    if (panoData.fullWidth > SYSTEM.maxTextureWidth\r\n      || panoData.croppedWidth !== panoData.fullWidth\r\n      || panoData.croppedHeight !== panoData.fullHeight\r\n    ) {\r\n      const resizedPanoData = { ...panoData };\r\n\r\n      const ratio = SYSTEM.maxCanvasWidth / panoData.fullWidth;\r\n\r\n      resizedPanoData.fullWidth *= ratio;\r\n      resizedPanoData.fullHeight *= ratio;\r\n      resizedPanoData.croppedWidth *= ratio;\r\n      resizedPanoData.croppedHeight *= ratio;\r\n      resizedPanoData.croppedX *= ratio;\r\n      resizedPanoData.croppedY *= ratio;\r\n\r\n      const buffer = document.createElement('canvas');\r\n      buffer.width = resizedPanoData.fullWidth;\r\n      buffer.height = resizedPanoData.fullHeight;\r\n\r\n      const ctx = buffer.getContext('2d');\r\n      ctx.drawImage(img,\r\n        resizedPanoData.croppedX, resizedPanoData.croppedY,\r\n        resizedPanoData.croppedWidth, resizedPanoData.croppedHeight);\r\n\r\n      texture = new THREE.Texture(buffer);\r\n    }\r\n    else {\r\n      texture = new THREE.Texture(img);\r\n    }\r\n\r\n    texture.needsUpdate = true;\r\n    texture.minFilter = THREE.LinearFilter;\r\n    texture.generateMipmaps = false;\r\n\r\n    return texture;\r\n  }\r\n\r\n  /**\r\n   * @summary Load the six textures of the cube\r\n   * @param {string[]} panorama\r\n   * @returns {Promise.<PSV.TextureData>}\r\n   * @throws {PSV.PSVError} when the image cannot be loaded\r\n   * @private\r\n   */\r\n  __loadCubemapTexture(panorama) {\r\n    if (this.prop.isCubemap === false) {\r\n      throw new PSVError('The viewer was initialized with an equirectangular panorama, cannot switch to cubemap.');\r\n    }\r\n\r\n    if (this.config.fisheye) {\r\n      logWarn('fisheye effect with cubemap texture can generate distorsion');\r\n    }\r\n\r\n    this.prop.isCubemap = true;\r\n\r\n    const promises = [];\r\n    const progress = [0, 0, 0, 0, 0, 0];\r\n\r\n    for (let i = 0; i < 6; i++) {\r\n      promises.push(\r\n        this.__loadImage(panorama[i], (p) => {\r\n          progress[i] = p;\r\n          this.psv.loader.setProgress(sum(progress) / 6);\r\n        })\r\n          .then(img => this.__createCubemapTexture(img))\r\n      );\r\n    }\r\n\r\n    return Promise.all(promises)\r\n      .then(texture => ({ texture }));\r\n  }\r\n\r\n  /**\r\n   * @summary Creates the final texture from image\r\n   * @param {Image} img\r\n   * @returns {external:THREE.Texture}\r\n   * @private\r\n   */\r\n  __createCubemapTexture(img) {\r\n    let texture;\r\n\r\n    // resize image\r\n    if (img.width > SYSTEM.maxTextureWidth) {\r\n      const buffer = document.createElement('canvas');\r\n      const ratio = SYSTEM.maxCanvasWidth / img.width;\r\n\r\n      buffer.width = img.width * ratio;\r\n      buffer.height = img.height * ratio;\r\n\r\n      const ctx = buffer.getContext('2d');\r\n      ctx.drawImage(img, 0, 0, buffer.width, buffer.height);\r\n\r\n      texture = new THREE.Texture(buffer);\r\n    }\r\n    else {\r\n      texture = new THREE.Texture(img);\r\n    }\r\n\r\n    texture.needsUpdate = true;\r\n    texture.minFilter = THREE.LinearFilter;\r\n    texture.generateMipmaps = false;\r\n\r\n    return texture;\r\n  }\r\n\r\n  /**\r\n   * @summary Preload a panorama file without displaying it\r\n   * @param {string} panorama\r\n   * @returns {Promise}\r\n   */\r\n  preloadPanorama(panorama) {\r\n    return this.loadTexture(panorama);\r\n  }\r\n\r\n}\r\n","import { EVENTS } from '../data/constants';\r\nimport { PSVError } from '../PSVError';\r\nimport { addClasses, parsePosition } from '../utils';\r\nimport { AbstractComponent } from './AbstractComponent';\r\n\r\nimport '../styles/tooltip.scss';\r\n\r\nconst LEFT_MAP = { 0: 'left', 0.5: 'center', 1: 'right' };\r\nconst TOP_MAP = { 0: 'top', 0.5: 'center', 1: 'bottom' };\r\nconst STATE = { NONE: 0, SHOWING: 1, HIDING: 2, READY: 3 };\r\n\r\n/**\r\n * @typedef {Object} PSV.components.Tooltip.Position\r\n * @summary Object defining the tooltip position\r\n * @property {number} top - Position of the tip of the arrow of the tooltip, in pixels\r\n * @property {number} left - Position of the tip of the arrow of the tooltip, in pixels\r\n * @property {string|string[]} [position='top center'] - Tooltip position toward it's arrow tip.\r\n *           Accepted values are combinations of `top`, `center`, `bottom` and `left`, `center`, `right`\r\n * @property {Object} [box] - Used when displaying a tooltip on a marker\r\n * @property {number} [box.width=0]\r\n * @property {number} [box.height=0]\r\n */\r\n\r\n/**\r\n * @typedef {PSV.components.Tooltip.Position} PSV.components.Tooltip.Config\r\n * @summary Object defining the tooltip configuration\r\n * @property {string} content - HTML content of the tooltip\r\n * @property {string} [className] - Additional CSS class added to the tooltip\r\n * @property {*} [data] - Userdata associated to the tooltip\r\n */\r\n\r\n/**\r\n * @summary Tooltip class\r\n * @extends PSV.components.AbstractComponent\r\n * @memberof PSV.components\r\n */\r\nexport class Tooltip extends AbstractComponent {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   * @param {{arrow: number, offset: number}} size\r\n   */\r\n  constructor(psv, size) {\r\n    super(psv, 'psv-tooltip');\r\n\r\n    /**\r\n     * @override\r\n     * @property {number} arrow\r\n     * @property {number} offset\r\n     * @property {number} width\r\n     * @property {number} height\r\n     * @property {string} pos\r\n     * @property {string} state\r\n     * @property {*} data\r\n     */\r\n    this.prop = {\r\n      ...this.prop,\r\n      ...size,\r\n      state : STATE.NONE,\r\n      width : 0,\r\n      height: 0,\r\n      pos   : '',\r\n      data  : null,\r\n    };\r\n\r\n    /**\r\n     * Tooltip content\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.content = document.createElement('div');\r\n    this.content.className = 'psv-tooltip-content';\r\n    this.container.appendChild(this.content);\r\n\r\n    /**\r\n     * Tooltip arrow\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.arrow = document.createElement('div');\r\n    this.arrow.className = 'psv-tooltip-arrow';\r\n    this.container.appendChild(this.arrow);\r\n\r\n    this.container.addEventListener('transitionend', this);\r\n\r\n    this.container.style.top = '-1000px';\r\n    this.container.style.left = '-1000px';\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.arrow;\r\n    delete this.content;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    /* eslint-disable */\r\n    switch (e.type) {\r\n      // @formatter:off\r\n      case 'transitionend': this.__onTransitionEnd(e); break;\r\n      // @formatter:on\r\n    }\r\n    /* eslint-enable */\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  toggle() {\r\n    throw new PSVError('Tooltip cannot be toggled');\r\n  }\r\n\r\n  /**\r\n   * @summary Displays the tooltip on the viewer\r\n   * Do not call this method directly, use {@link PSV.services.TooltipRenderer} instead.\r\n   * @param {PSV.components.Tooltip.Config} config\r\n   *\r\n   * @fires PSV.show-tooltip\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   *\r\n   * @package\r\n   */\r\n  show(config) {\r\n    if (this.prop.state !== STATE.NONE) {\r\n      throw new PSVError('Initialized tooltip cannot be re-initialized');\r\n    }\r\n\r\n    if (config.className) {\r\n      addClasses(this.container, config.className);\r\n    }\r\n\r\n    this.content.innerHTML = config.content;\r\n\r\n    const rect = this.container.getBoundingClientRect();\r\n    this.prop.width = rect.right - rect.left;\r\n    this.prop.height = rect.bottom - rect.top;\r\n\r\n    this.prop.state = STATE.READY;\r\n\r\n    this.move(config);\r\n\r\n    this.prop.data = config.data;\r\n    this.prop.state = STATE.SHOWING;\r\n\r\n    this.psv.trigger(EVENTS.SHOW_TOOLTIP, this.prop.data, this);\r\n  }\r\n\r\n  /**\r\n   * @summary Moves the tooltip to a new position\r\n   * @param {PSV.components.Tooltip.Position} config\r\n   *\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   */\r\n  move(config) {\r\n    if (this.prop.state !== STATE.SHOWING && this.prop.state !== STATE.READY) {\r\n      throw new PSVError('Uninitialized tooltip cannot be moved');\r\n    }\r\n\r\n    const t = this.container;\r\n    const a = this.arrow;\r\n\r\n    if (!config.position) {\r\n      config.position = ['top', 'center'];\r\n    }\r\n\r\n    // parse position\r\n    if (typeof config.position === 'string') {\r\n      const tempPos = parsePosition(config.position);\r\n\r\n      if (!(tempPos.x in LEFT_MAP) || !(tempPos.y in TOP_MAP)) {\r\n        throw new PSVError(`Unable to parse tooltip position \"${config.position}\"`);\r\n      }\r\n\r\n      config.position = [TOP_MAP[tempPos.y], LEFT_MAP[tempPos.x]];\r\n    }\r\n\r\n    if (config.position[0] === 'center' && config.position[1] === 'center') {\r\n      throw new PSVError('Unable to parse tooltip position \"center center\"');\r\n    }\r\n\r\n    // compute size\r\n    const style = {\r\n      posClass : config.position.slice(),\r\n      width    : this.prop.width,\r\n      height   : this.prop.height,\r\n      top      : 0,\r\n      left     : 0,\r\n      arrowTop : 0,\r\n      arrowLeft: 0,\r\n    };\r\n\r\n    // set initial position\r\n    this.__computeTooltipPosition(style, config);\r\n\r\n    // correct position if overflow\r\n    let refresh = false;\r\n    if (style.top < this.prop.offset) {\r\n      style.posClass[0] = 'bottom';\r\n      refresh = true;\r\n    }\r\n    else if (style.top + style.height > this.psv.prop.size.height - this.prop.offset) {\r\n      style.posClass[0] = 'top';\r\n      refresh = true;\r\n    }\r\n    if (style.left < this.prop.offset) {\r\n      style.posClass[1] = 'right';\r\n      refresh = true;\r\n    }\r\n    else if (style.left + style.width > this.psv.prop.size.width - this.prop.offset) {\r\n      style.posClass[1] = 'left';\r\n      refresh = true;\r\n    }\r\n    if (refresh) {\r\n      this.__computeTooltipPosition(style, config);\r\n    }\r\n\r\n    // apply position\r\n    t.style.top = style.top + 'px';\r\n    t.style.left = style.left + 'px';\r\n\r\n    a.style.top = style.arrowTop + 'px';\r\n    a.style.left = style.arrowLeft + 'px';\r\n\r\n    const newPos = style.posClass.join('-');\r\n    if (newPos !== this.prop.pos) {\r\n      t.classList.remove(`psv-tooltip--${this.prop.pos}`);\r\n\r\n      this.prop.pos = newPos;\r\n      t.classList.add(`psv-tooltip--${this.prop.pos}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the tooltip\r\n   * @fires PSV.hide-tooltip\r\n   */\r\n  hide() {\r\n    this.container.classList.remove('psv-tooltip--visible');\r\n    this.prop.state = STATE.HIDING;\r\n\r\n    this.psv.trigger(EVENTS.HIDE_TOOLTIP, this.prop.data);\r\n  }\r\n\r\n  /**\r\n   * @summary Finalize transition\r\n   * @param {TransitionEvent} e\r\n   * @private\r\n   */\r\n  __onTransitionEnd(e) {\r\n    if (e.propertyName === 'transform') {\r\n      switch (this.prop.state) {\r\n        case STATE.SHOWING:\r\n          this.container.classList.add('psv-tooltip--visible');\r\n          this.prop.state = STATE.READY;\r\n          break;\r\n\r\n        case STATE.HIDING:\r\n          this.prop.state = STATE.NONE;\r\n          this.destroy();\r\n          break;\r\n\r\n        default:\r\n          // nothing\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Computes the position of the tooltip and its arrow\r\n   * @param {Object} style\r\n   * @param {Object} config\r\n   * @private\r\n   */\r\n  __computeTooltipPosition(style, config) {\r\n    let topBottom = false;\r\n\r\n    if (!config.box) {\r\n      config.box = {\r\n        width : 0,\r\n        height: 0,\r\n      };\r\n    }\r\n\r\n    switch (style.posClass[0]) {\r\n      case 'bottom':\r\n        style.top = config.top + config.box.height + this.prop.offset + this.prop.arrow;\r\n        style.arrowTop = -this.prop.arrow * 2;\r\n        topBottom = true;\r\n        break;\r\n\r\n      case 'center':\r\n        style.top = config.top + config.box.height / 2 - style.height / 2;\r\n        style.arrowTop = style.height / 2 - this.prop.arrow;\r\n        break;\r\n\r\n      case 'top':\r\n        style.top = config.top - style.height - this.prop.offset - this.prop.arrow;\r\n        style.arrowTop = style.height;\r\n        topBottom = true;\r\n        break;\r\n\r\n      // no default\r\n    }\r\n\r\n    switch (style.posClass[1]) {\r\n      case 'right':\r\n        if (topBottom) {\r\n          style.left = config.left + config.box.width / 2 - this.prop.offset - this.prop.arrow;\r\n          style.arrowLeft = this.prop.offset;\r\n        }\r\n        else {\r\n          style.left = config.left + config.box.width + this.prop.offset + this.prop.arrow;\r\n          style.arrowLeft = -this.prop.arrow * 2;\r\n        }\r\n        break;\r\n\r\n      case 'center':\r\n        style.left = config.left + config.box.width / 2 - style.width / 2;\r\n        style.arrowLeft = style.width / 2 - this.prop.arrow;\r\n        break;\r\n\r\n      case 'left':\r\n        if (topBottom) {\r\n          style.left = config.left - style.width + config.box.width / 2 + this.prop.offset + this.prop.arrow;\r\n          style.arrowLeft = style.width - this.prop.offset - this.prop.arrow * 2;\r\n        }\r\n        else {\r\n          style.left = config.left - style.width - this.prop.offset - this.prop.arrow;\r\n          style.arrowLeft = style.width;\r\n        }\r\n        break;\r\n\r\n      // no default\r\n    }\r\n  }\r\n\r\n}\r\n","import { Tooltip } from '../components/Tooltip';\r\nimport { getStyle } from '../utils';\r\nimport { AbstractService } from './AbstractService';\r\n\r\n/**\r\n * @summary Tooltip renderer\r\n * @extends PSV.services.AbstractService\r\n * @memberof PSV.services\r\n */\r\nexport class TooltipRenderer extends AbstractService {\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    const testTooltip = new Tooltip(this.psv);\r\n\r\n    /**\r\n     * @summary Computed static sizes\r\n     * @member {Object}\r\n     * @package\r\n     * @property {number} arrowSize\r\n     * @property {number} offset\r\n     */\r\n    this.size = {\r\n      arrow : parseInt(getStyle(testTooltip.arrow, 'borderTopWidth'), 10),\r\n      offset: parseInt(getStyle(testTooltip.container, 'outlineWidth'), 10),\r\n    };\r\n\r\n    testTooltip.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    delete this.size;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @summary Displays a tooltip on the viewer\r\n   * @param {PSV.components.Tooltip.Config} config\r\n   * @returns {PSV.components.Tooltip}\r\n   *\r\n   * @fires PSV.show-tooltip\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   *\r\n   * @example\r\n   * viewer.tooltip.create({ content: 'Hello world', top: 200, left: 450, position: 'center bottom'})\r\n   */\r\n  create(config) {\r\n    const tooltip = new Tooltip(this.psv, this.size);\r\n    tooltip.show(config);\r\n\r\n    return tooltip;\r\n  }\r\n\r\n}\r\n","import * as THREE from 'three';\r\nimport { EventEmitter } from 'uevent';\r\nimport { Animation } from './Animation';\r\nimport { Loader } from './components/Loader';\r\nimport { Navbar } from './components/Navbar';\r\nimport { Notification } from './components/Notification';\r\nimport { Overlay } from './components/Overlay';\r\nimport { Panel } from './components/Panel';\r\nimport { CONFIG_PARSERS, DEFAULTS, getConfig, READONLY_OPTIONS } from './data/config';\r\nimport { CHANGE_EVENTS, EVENTS, IDS, VIEWER_DATA } from './data/constants';\r\nimport { SYSTEM } from './data/system';\r\nimport errorIcon from './icons/error.svg';\r\nimport { PSVError } from './PSVError';\r\nimport { DataHelper } from './services/DataHelper';\r\nimport { EventsHandler } from './services/EventsHandler';\r\nimport { Renderer } from './services/Renderer';\r\nimport { TextureLoader } from './services/TextureLoader';\r\nimport { TooltipRenderer } from './services/TooltipRenderer';\r\nimport './styles/viewer.scss';\r\nimport {\r\n  bound,\r\n  each,\r\n  exitFullscreen,\r\n  getAngle,\r\n  getShortestArc,\r\n  isFullscreenEnabled,\r\n  requestFullscreen,\r\n  throttle,\r\n  toggleClass\r\n} from './utils';\r\n\r\nTHREE.Cache.enabled = true;\r\n\r\n/**\r\n * @summary Main class\r\n * @memberOf PSV\r\n * @extends {external:uEvent.EventEmitter}\r\n */\r\nexport class Viewer extends EventEmitter {\r\n\r\n  /**\r\n   * @param {PSV.Options} options\r\n   * @fires PSV.ready\r\n   * @throws {PSV.PSVError} when the configuration is incorrect\r\n   */\r\n  constructor(options) {\r\n    super();\r\n\r\n    SYSTEM.load();\r\n\r\n    // must support WebGL\r\n    if (!SYSTEM.isWebGLSupported) {\r\n      throw new PSVError('WebGL is not supported.');\r\n    }\r\n\r\n    if (SYSTEM.maxCanvasWidth === 0 || SYSTEM.maxTextureWidth === 0) {\r\n      throw new PSVError('Unable to detect system capabilities');\r\n    }\r\n\r\n    /**\r\n     * @summary Internal properties\r\n     * @member {Object}\r\n     * @protected\r\n     * @property {boolean} ready - when all components are loaded\r\n     * @property {boolean} needsUpdate - if the view needs to be renderer\r\n     * @property {boolean} isCubemap - if the panorama is a cubemap\r\n     * @property {PSV.Position} position - current direction of the camera\r\n     * @property {external:THREE.Vector3} direction - direction of the camera\r\n     * @property {number} zoomLvl - current zoom level\r\n     * @property {number} vFov - vertical FOV\r\n     * @property {number} hFov - horizontal FOV\r\n     * @property {number} aspect - viewer aspect ratio\r\n     * @property {number} moveSpeed - move speed (computed with pixel ratio and configuration moveSpeed)\r\n     * @property {Function} autorotateCb - update callback of the automatic rotation\r\n     * @property {PSV.Animation} animationPromise - promise of the current animation (either go to position or image transition)\r\n     * @property {Promise} loadingPromise - promise of the setPanorama method\r\n     * @property startTimeout - timeout id of the automatic rotation delay\r\n     * @property {PSV.Size} size - size of the container\r\n     * @property {PSV.PanoData} panoData - panorama metadata\r\n     */\r\n    this.prop = {\r\n      ready           : false,\r\n      uiRefresh       : false,\r\n      needsUpdate     : false,\r\n      fullscreen      : false,\r\n      isCubemap       : undefined,\r\n      position        : {\r\n        longitude: 0,\r\n        latitude : 0,\r\n      },\r\n      direction       : null,\r\n      zoomLvl         : null,\r\n      vFov            : null,\r\n      hFov            : null,\r\n      aspect          : null,\r\n      moveSpeed       : 0.1,\r\n      autorotateCb    : null,\r\n      animationPromise: null,\r\n      loadingPromise  : null,\r\n      startTimeout    : null,\r\n      size            : {\r\n        width : 0,\r\n        height: 0,\r\n      },\r\n      panoData        : {\r\n        fullWidth    : 0,\r\n        fullHeight   : 0,\r\n        croppedWidth : 0,\r\n        croppedHeight: 0,\r\n        croppedX     : 0,\r\n        croppedY     : 0,\r\n      },\r\n    };\r\n\r\n    /**\r\n     * @summary Configuration holder\r\n     * @type {PSV.Options}\r\n     * @readonly\r\n     */\r\n    this.config = getConfig(options);\r\n\r\n    /**\r\n     * @summary Top most parent\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     */\r\n    this.parent = (typeof options.container === 'string') ? document.getElementById(options.container) : options.container;\r\n    this.parent[VIEWER_DATA] = this;\r\n\r\n    /**\r\n     * @summary Main container\r\n     * @member {HTMLElement}\r\n     * @readonly\r\n     */\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('psv-container');\r\n    this.parent.appendChild(this.container);\r\n\r\n    /**\r\n     * @summary All child components\r\n     * @type {PSV.components.AbstractComponent[]}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.children = [];\r\n\r\n    /**\r\n     * @summary All plugins\r\n     * @type {Object<string, PSV.plugins.AbstractPlugin>}\r\n     * @readonly\r\n     * @package\r\n     */\r\n    this.plugins = {};\r\n\r\n    /**\r\n     * @summary Main render controller\r\n     * @type {PSV.services.Renderer}\r\n     * @readonly\r\n     */\r\n    this.renderer = new Renderer(this);\r\n\r\n    /**\r\n     * @summary Textures loader\r\n     * @type {PSV.services.TextureLoader}\r\n     * @readonly\r\n     */\r\n    this.textureLoader = new TextureLoader(this);\r\n\r\n    /**\r\n     * @summary Main event handler\r\n     * @type {PSV.services.EventsHandler}\r\n     * @readonly\r\n     */\r\n    this.eventsHandler = new EventsHandler(this);\r\n\r\n    /**\r\n     * @summary Utilities to help converting data\r\n     * @type {PSV.services.DataHelper}\r\n     * @readonly\r\n     */\r\n    this.dataHelper = new DataHelper(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Loader}\r\n     * @readonly\r\n     */\r\n    this.loader = new Loader(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Navbar}\r\n     * @readonly\r\n     */\r\n    this.navbar = new Navbar(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Panel}\r\n     * @readonly\r\n     */\r\n    this.panel = new Panel(this);\r\n\r\n    /**\r\n     * @member {PSV.services.TooltipRenderer}\r\n     * @readonly\r\n     */\r\n    this.tooltip = new TooltipRenderer(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Notification}\r\n     * @readonly\r\n     */\r\n    this.notification = new Notification(this);\r\n\r\n    /**\r\n     * @member {PSV.components.Overlay}\r\n     * @readonly\r\n     */\r\n    this.overlay = new Overlay(this);\r\n\r\n    this.eventsHandler.init();\r\n\r\n    this.__resizeRefresh = throttle(() => this.refreshUi('resize'), 500);\r\n\r\n    // apply container size\r\n    this.resize(this.config.size);\r\n\r\n    // actual move speed depends on pixel-ratio\r\n    this.prop.moveSpeed = THREE.Math.degToRad(this.config.moveSpeed / SYSTEM.pixelRatio);\r\n\r\n    // init plugins\r\n    this.config.plugins.forEach(([plugin, opts]) => {\r\n      this.plugins[plugin.id] = new plugin(this, opts); // eslint-disable-line new-cap\r\n    });\r\n\r\n    // init buttons\r\n    this.navbar.setButtons(this.config.navbar);\r\n\r\n    // load panorama\r\n    if (this.config.panorama) {\r\n      this.setPanorama(this.config.panorama);\r\n    }\r\n\r\n    SYSTEM.isTouchEnabled.then(enabled => toggleClass(this.container, 'psv--is-touch', enabled));\r\n\r\n    // enable GUI after first render\r\n    this.once(EVENTS.RENDER, () => {\r\n      if (this.config.navbar) {\r\n        this.container.classList.add('psv--has-navbar');\r\n        this.navbar.show();\r\n      }\r\n\r\n      // Queue autorotate\r\n      if (this.config.autorotateDelay) {\r\n        this.prop.startTimeout = setTimeout(() => this.startAutorotate(), this.config.autorotateDelay);\r\n      }\r\n\r\n      this.prop.ready = true;\r\n\r\n      setTimeout(() => {\r\n        this.refreshUi('init');\r\n\r\n        this.trigger(EVENTS.READY);\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Destroys the viewer\r\n   * @description The memory used by the ThreeJS context is not totally cleared. This will be fixed as soon as possible.\r\n   */\r\n  destroy() {\r\n    this.__stopAll();\r\n    this.stopKeyboardControl();\r\n    this.exitFullscreen();\r\n\r\n    this.eventsHandler.destroy();\r\n    this.renderer.destroy();\r\n    this.textureLoader.destroy();\r\n    this.dataHelper.destroy();\r\n\r\n    this.children.slice().forEach(child => child.destroy());\r\n    this.children.length = 0;\r\n\r\n    each(this.plugins, plugin => plugin.destroy());\r\n    delete this.plugins;\r\n\r\n    this.parent.removeChild(this.container);\r\n    delete this.parent[VIEWER_DATA];\r\n\r\n    delete this.parent;\r\n    delete this.container;\r\n\r\n    delete this.loader;\r\n    delete this.navbar;\r\n    delete this.panel;\r\n    delete this.tooltip;\r\n    delete this.notification;\r\n    delete this.overlay;\r\n\r\n    delete this.config;\r\n  }\r\n\r\n  /**\r\n   * @summary Refresh UI\r\n   * @package\r\n   */\r\n  refreshUi(reason) {\r\n    if (!this.prop.ready) {\r\n      return;\r\n    }\r\n\r\n    if (!this.prop.uiRefresh) {\r\n      // console.log(`PhotoSphereViewer: UI Refresh, ${reason}`);\r\n\r\n      this.prop.uiRefresh = true;\r\n\r\n      this.children.every((child) => {\r\n        child.refreshUi();\r\n        return this.prop.uiRefresh === true;\r\n      });\r\n\r\n      this.prop.uiRefresh = false;\r\n    }\r\n    else if (this.prop.uiRefresh !== 'new') {\r\n      this.prop.uiRefresh = 'new';\r\n\r\n      // wait for current refresh to cancel\r\n      setTimeout(() => {\r\n        this.prop.uiRefresh = false;\r\n        this.refreshUi(reason);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the instance of a plugin if it exists\r\n   * @param {Class<PSV.plugins.AbstractPlugin>|string} pluginId\r\n   * @returns {PSV.plugins.AbstractPlugin}\r\n   */\r\n  getPlugin(pluginId) {\r\n    return pluginId ? this.plugins[typeof pluginId === 'function' ? pluginId.id : pluginId] : null;\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the current position of the camera\r\n   * @returns {PSV.Position}\r\n   */\r\n  getPosition() {\r\n    return {\r\n      longitude: this.prop.position.longitude,\r\n      latitude : this.prop.position.latitude,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the current zoom level\r\n   * @returns {number}\r\n   */\r\n  getZoomLevel() {\r\n    return this.prop.zoomLvl;\r\n  }\r\n\r\n  /**\r\n   * @summary Returns the current viewer size\r\n   * @returns {PSV.Size}\r\n   */\r\n  getSize() {\r\n    return {\r\n      width : this.prop.size.width,\r\n      height: this.prop.size.height,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the automatic rotation is enabled\r\n   * @returns {boolean}\r\n   */\r\n  isAutorotateEnabled() {\r\n    return !!this.prop.autorotateCb;\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the viewer is in fullscreen\r\n   * @returns {boolean}\r\n   */\r\n  isFullscreenEnabled() {\r\n    if (SYSTEM.fullscreenEvent) {\r\n      return isFullscreenEnabled(this.container);\r\n    }\r\n    else {\r\n      return this.prop.fullscreen;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Flags the view has changed for the next render\r\n   */\r\n  needsUpdate() {\r\n    this.prop.needsUpdate = true;\r\n\r\n    if (!this.renderer.mainReqid && this.renderer.renderer) {\r\n      this.renderer.__renderLoop(+new Date());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Resizes the canvas when the window is resized\r\n   * @fires PSV.size-updated\r\n   */\r\n  autoSize() {\r\n    if (this.container.clientWidth !== this.prop.size.width || this.container.clientHeight !== this.prop.size.height) {\r\n      this.prop.size.width = Math.round(this.container.clientWidth);\r\n      this.prop.size.height = Math.round(this.container.clientHeight);\r\n      this.prop.aspect = this.prop.size.width / this.prop.size.height;\r\n      this.prop.hFov = this.dataHelper.vFovToHFov(this.prop.vFov);\r\n\r\n      this.needsUpdate();\r\n      this.trigger(EVENTS.SIZE_UPDATED, this.getSize());\r\n      this.__resizeRefresh();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Loads a new panorama file\r\n   * @description Loads a new panorama file, optionally changing the camera position/zoom and activating the transition animation.<br>\r\n   * If the \"options\" parameter is not defined, the camera will not move and the ongoing animation will continue.<br>\r\n   * If another loading is already in progress it will be aborted.\r\n   * @param {string|string[]|PSV.Cubemap} path - URL of the new panorama file\r\n   * @param {PSV.PanoramaOptions} [options]\r\n   * @returns {Promise}\r\n   */\r\n  setPanorama(path, options = {}) {\r\n    if (this.prop.loadingPromise !== null) {\r\n      this.textureLoader.abortLoading();\r\n    }\r\n\r\n    if (!this.prop.ready) {\r\n      if (!('longitude' in options) && !this.prop.isCubemap) {\r\n        options.longitude = this.config.defaultLong;\r\n      }\r\n      if (!('latitude' in options) && !this.prop.isCubemap) {\r\n        options.latitude = this.config.defaultLat;\r\n      }\r\n      if (!('zoom' in options)) {\r\n        options.zoom = this.config.defaultZoomLvl;\r\n      }\r\n      if (!('sphereCorrection' in options)) {\r\n        options.sphereCorrection = this.config.sphereCorrection;\r\n      }\r\n      if (!('panoData' in options)) {\r\n        options.panoData = this.config.panoData;\r\n      }\r\n    }\r\n\r\n    if (options.transition === undefined || options.transition === true) {\r\n      options.transition = 1500;\r\n    }\r\n    if (options.showLoader === undefined) {\r\n      options.showLoader = true;\r\n    }\r\n\r\n    const positionProvided = this.dataHelper.isExtendedPosition(options);\r\n    const zoomProvided = 'zoom' in options;\r\n\r\n    if (positionProvided || zoomProvided) {\r\n      this.__stopAll();\r\n    }\r\n\r\n    this.hideError();\r\n\r\n    this.config.panorama = path;\r\n\r\n    const done = (err) => {\r\n      if (err && err.type === 'abort') {\r\n        console.warn(err);\r\n      }\r\n      else if (err) {\r\n        this.showError(this.config.lang.loadError);\r\n        console.error(err);\r\n      }\r\n\r\n      this.loader.hide();\r\n      this.renderer.show();\r\n\r\n      this.prop.loadingPromise = null;\r\n\r\n      if (err) {\r\n        return Promise.reject(err);\r\n      }\r\n      else {\r\n        return true;\r\n      }\r\n    };\r\n\r\n    if (!options.transition || !this.prop.ready) {\r\n      if (options.showLoader || !this.prop.ready) {\r\n        this.loader.show();\r\n      }\r\n\r\n      this.prop.loadingPromise = this.textureLoader.loadTexture(this.config.panorama, options.panoData)\r\n        .then((textureData) => {\r\n          this.renderer.setTexture(textureData);\r\n\r\n          if (options.sphereCorrection) {\r\n            this.renderer.setSphereCorrection(options.sphereCorrection);\r\n          }\r\n          if (zoomProvided) {\r\n            this.zoom(options.zoom);\r\n          }\r\n          if (positionProvided) {\r\n            this.rotate(options);\r\n          }\r\n        })\r\n        .then(done, done);\r\n    }\r\n    else {\r\n      if (options.showLoader) {\r\n        this.loader.show();\r\n      }\r\n\r\n      this.prop.loadingPromise = this.textureLoader.loadTexture(this.config.panorama)\r\n        .then((textureData) => {\r\n          this.loader.hide();\r\n\r\n          return this.renderer.transition(textureData, options);\r\n        })\r\n        .then(done, done);\r\n    }\r\n\r\n    return this.prop.loadingPromise;\r\n  }\r\n\r\n  /**\r\n   * @summary Update options\r\n   * @param {PSV.Options} options\r\n   * @fires PSV.config-changed\r\n   */\r\n  setOptions(options) {\r\n    each(options, (value, key) => {\r\n      if (!Object.prototype.hasOwnProperty.call(DEFAULTS, key)) {\r\n        throw new PSVError(`Unknown option ${key}`);\r\n      }\r\n\r\n      if (READONLY_OPTIONS[key]) {\r\n        throw new PSVError(READONLY_OPTIONS[key]);\r\n      }\r\n\r\n      if (CONFIG_PARSERS[key]) {\r\n        this.config[key] = CONFIG_PARSERS[key](value, options);\r\n      }\r\n      else {\r\n        this.config[key] = value;\r\n      }\r\n\r\n      switch (key) {\r\n        case 'caption':\r\n          this.navbar.setCaption(value);\r\n          break;\r\n\r\n        case 'size':\r\n          this.resize(value);\r\n          break;\r\n\r\n        case 'sphereCorrection':\r\n          this.renderer.setSphereCorrection(value);\r\n          break;\r\n\r\n        case 'navbar':\r\n        case 'lang':\r\n          this.navbar.setButtons(this.config.navbar);\r\n          break;\r\n\r\n        case 'moveSpeed':\r\n          this.prop.moveSpeed = THREE.Math.degToRad(value / SYSTEM.pixelRatio);\r\n          break;\r\n\r\n        case 'minFov':\r\n        case 'maxFov':\r\n          this.prop.zoomLvl = this.dataHelper.fovToZoomLevel(this.prop.vFov);\r\n          this.trigger(EVENTS.ZOOM_UPDATED, this.getZoomLevel());\r\n          break;\r\n\r\n        default:\r\n          break;\r\n      }\r\n    });\r\n\r\n    this.needsUpdate();\r\n    this.refreshUi('set options');\r\n\r\n    this.trigger(EVENTS.CONFIG_CHANGED, Object.keys(options));\r\n  }\r\n\r\n  /**\r\n   * @summary Update options\r\n   * @param {string} option\r\n   * @param {any} value\r\n   * @fires PSV.config-changed\r\n   */\r\n  setOption(option, value) {\r\n    this.setOptions({ [option]: value });\r\n  }\r\n\r\n  /**\r\n   * @summary Starts the automatic rotation\r\n   * @fires PSV.autorotate\r\n   */\r\n  startAutorotate() {\r\n    this.__stopAll();\r\n\r\n    this.prop.autorotateCb = (() => {\r\n      let last;\r\n      let elapsed;\r\n\r\n      return (e, timestamp) => {\r\n        elapsed = last === undefined ? 0 : timestamp - last;\r\n        last = timestamp;\r\n\r\n        this.rotate({\r\n          longitude: this.prop.position.longitude + this.config.autorotateSpeed * elapsed / 1000,\r\n          latitude : this.prop.position.latitude - (this.prop.position.latitude - this.config.autorotateLat) / 200,\r\n        });\r\n      };\r\n    })();\r\n\r\n    this.on(EVENTS.BEFORE_RENDER, this.prop.autorotateCb);\r\n\r\n    this.trigger(EVENTS.AUTOROTATE, true);\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the automatic rotation\r\n   * @fires PSV.autorotate\r\n   */\r\n  stopAutorotate() {\r\n    if (this.prop.startTimeout) {\r\n      clearTimeout(this.prop.startTimeout);\r\n      this.prop.startTimeout = null;\r\n    }\r\n\r\n    if (this.isAutorotateEnabled()) {\r\n      this.off(EVENTS.BEFORE_RENDER, this.prop.autorotateCb);\r\n      this.prop.autorotateCb = null;\r\n\r\n      this.trigger(EVENTS.AUTOROTATE, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Starts or stops the automatic rotation\r\n   * @fires PSV.autorotate\r\n   */\r\n  toggleAutorotate() {\r\n    if (this.isAutorotateEnabled()) {\r\n      this.stopAutorotate();\r\n    }\r\n    else {\r\n      this.startAutorotate();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Displays an error message\r\n   * @param {string} message\r\n   */\r\n  showError(message) {\r\n    this.overlay.show({\r\n      id         : IDS.ERROR,\r\n      image      : errorIcon,\r\n      text       : message,\r\n      dissmisable: false,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Hides the error message\r\n   */\r\n  hideError() {\r\n    this.overlay.hide(IDS.ERROR);\r\n  }\r\n\r\n  /**\r\n   * @summary Rotates the view to specific longitude and latitude\r\n   * @param {PSV.ExtendedPosition} position\r\n   * @fires PSV.before-rotate\r\n   * @fires PSV.position-updated\r\n   */\r\n  rotate(position) {\r\n    const e = this.trigger(EVENTS.BEFORE_ROTATE, position);\r\n    if (e.isDefaultPrevented()) {\r\n      return;\r\n    }\r\n\r\n    const cleanPosition = this.change(CHANGE_EVENTS.GET_ROTATE_POSITION, this.dataHelper.cleanPosition(position));\r\n\r\n    if (this.prop.position.longitude !== cleanPosition.longitude || this.prop.position.latitude !== cleanPosition.latitude) {\r\n      this.prop.position.longitude = cleanPosition.longitude;\r\n      this.prop.position.latitude = cleanPosition.latitude;\r\n\r\n      this.needsUpdate();\r\n\r\n      this.trigger(EVENTS.POSITION_UPDATED, this.getPosition());\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Rotates and zooms the view with a smooth animation\r\n   * @param {PSV.AnimateOptions} options - position and/or zoom level\r\n   * @returns {PSV.Animation}\r\n   */\r\n  animate(options) {\r\n    this.__stopAll();\r\n\r\n    const positionProvided = this.dataHelper.isExtendedPosition(options);\r\n    const zoomProvided = 'zoom' in options;\r\n\r\n    const animProperties = {};\r\n    let duration;\r\n\r\n    // clean/filter position and compute duration\r\n    if (positionProvided) {\r\n      const cleanPosition = this.change(CHANGE_EVENTS.GET_ANIMATE_POSITION, this.dataHelper.cleanPosition(options));\r\n\r\n      // longitude offset for shortest arc\r\n      const tOffset = getShortestArc(this.prop.position.longitude, cleanPosition.longitude);\r\n\r\n      animProperties.longitude = { start: this.prop.position.longitude, end: this.prop.position.longitude + tOffset };\r\n      animProperties.latitude = { start: this.prop.position.latitude, end: cleanPosition.latitude };\r\n\r\n      duration = this.dataHelper.speedToDuration(options.speed, getAngle(this.prop.position, cleanPosition));\r\n    }\r\n\r\n    // clean/filter zoom and compute duration\r\n    if (zoomProvided) {\r\n      const dZoom = Math.abs(options.zoom - this.prop.zoomLvl);\r\n\r\n      animProperties.zoom = { start: this.prop.zoomLvl, end: options.zoom };\r\n\r\n      if (!duration) {\r\n        // if animating zoom only and a speed is given, use an arbitrary PI/4 to compute the duration\r\n        duration = this.dataHelper.speedToDuration(options.speed, Math.PI / 4 * dZoom / 100);\r\n      }\r\n    }\r\n\r\n    // if no animation needed\r\n    if (!duration) {\r\n      if (positionProvided) {\r\n        this.rotate(options);\r\n      }\r\n      if (zoomProvided) {\r\n        this.zoom(options.zoom);\r\n      }\r\n\r\n      return Animation.resolve();\r\n    }\r\n\r\n    this.prop.animationPromise = new Animation({\r\n      properties: animProperties,\r\n      duration  : duration,\r\n      easing    : 'inOutSine',\r\n      onTick    : (properties) => {\r\n        if (positionProvided) {\r\n          this.rotate(properties);\r\n        }\r\n        if (zoomProvided) {\r\n          this.zoom(properties.zoom);\r\n        }\r\n      },\r\n    });\r\n\r\n    return this.prop.animationPromise;\r\n  }\r\n\r\n  /**\r\n   * @summary Stops the ongoing animation\r\n   * @description The return value is a Promise because the is no guaranty the animation can be stopped synchronously.\r\n   * @returns {Promise} Resolved when the animation has ben cancelled\r\n   */\r\n  stopAnimation() {\r\n    if (this.prop.animationPromise) {\r\n      return new Promise((resolve) => {\r\n        this.prop.animationPromise.finally(resolve);\r\n        this.prop.animationPromise.cancel();\r\n        this.prop.animationPromise = null;\r\n      });\r\n    }\r\n    else {\r\n      return Promise.resolve();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Zooms to a specific level between `max_fov` and `min_fov`\r\n   * @param {number} level - new zoom level from 0 to 100\r\n   * @fires PSV.zoom-updated\r\n   */\r\n  zoom(level) {\r\n    const newZoomLvl = bound(level, 0, 100);\r\n\r\n    if (this.prop.zoomLvl !== newZoomLvl) {\r\n      this.prop.zoomLvl = newZoomLvl;\r\n      this.prop.vFov = this.dataHelper.zoomLevelToFov(this.prop.zoomLvl);\r\n      this.prop.hFov = this.dataHelper.vFovToHFov(this.prop.vFov);\r\n\r\n      this.needsUpdate();\r\n      this.trigger(EVENTS.ZOOM_UPDATED, this.getZoomLevel());\r\n      this.rotate(this.prop.position);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Increases the zoom level by 1\r\n   */\r\n  zoomIn() {\r\n    this.zoom(this.prop.zoomLvl + this.config.zoomButtonIncrement);\r\n  }\r\n\r\n  /**\r\n   * @summary Decreases the zoom level by 1\r\n   */\r\n  zoomOut() {\r\n    this.zoom(this.prop.zoomLvl - this.config.zoomButtonIncrement);\r\n  }\r\n\r\n  /**\r\n   * @summary Resizes the viewer\r\n   * @param {PSV.CssSize} size\r\n   */\r\n  resize(size) {\r\n    ['width', 'height'].forEach((dim) => {\r\n      if (size && size[dim]) {\r\n        if (/^[0-9.]+$/.test(size[dim])) {\r\n          size[dim] += 'px';\r\n        }\r\n        this.parent.style[dim] = size[dim];\r\n      }\r\n    });\r\n\r\n    this.autoSize();\r\n  }\r\n\r\n  /**\r\n   * @summary Enters the fullscreen mode\r\n   * @fires PSV.fullscreen-updated\r\n   */\r\n  enterFullscreen() {\r\n    if (SYSTEM.fullscreenEvent) {\r\n      requestFullscreen(this.container);\r\n    }\r\n    else {\r\n      this.container.classList.add('psv-container--fullscreen');\r\n      this.autoSize();\r\n      this.eventsHandler.__fullscreenToggled(true);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Exits the fullscreen mode\r\n   * @fires PSV.fullscreen-updated\r\n   */\r\n  exitFullscreen() {\r\n    if (this.isFullscreenEnabled()) {\r\n      if (SYSTEM.fullscreenEvent) {\r\n        exitFullscreen();\r\n      }\r\n      else {\r\n        this.container.classList.remove('psv-container--fullscreen');\r\n        this.autoSize();\r\n        this.eventsHandler.__fullscreenToggled(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enters or exits the fullscreen mode\r\n   * @fires PSV.fullscreen-updated\r\n   */\r\n  toggleFullscreen() {\r\n    if (!this.isFullscreenEnabled()) {\r\n      this.enterFullscreen();\r\n    }\r\n    else {\r\n      this.exitFullscreen();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enables the keyboard controls (done automatically when entering fullscreen)\r\n   */\r\n  startKeyboardControl() {\r\n    this.eventsHandler.enableKeyboard();\r\n  }\r\n\r\n  /**\r\n   * @summary Disables the keyboard controls (done automatically when exiting fullscreen)\r\n   */\r\n  stopKeyboardControl() {\r\n    this.eventsHandler.disableKeyboard();\r\n  }\r\n\r\n  /**\r\n   * @summary Stops all current animations\r\n   * @private\r\n   */\r\n  __stopAll() {\r\n    this.stopAutorotate();\r\n    this.stopAnimation();\r\n\r\n    this.trigger(EVENTS.STOP_ALL);\r\n  }\r\n\r\n}\r\n"],"names":["MOVE_THRESHOLD","DBLCLICK_DELAY","LONGTOUCH_DELAY","TWOFINGERSOVERLAY_DELAY","INERTIA_WINDOW","SPHERE_RADIUS","SPHERE_VERTICES","CUBE_VERTICES","CUBE_MAP","CUBE_HASHMAP","BUTTON_DATA","VIEWER_DATA","ACTIONS","ROTATE_LAT_UP","ROTATE_LAT_DOWN","ROTATE_LONG_RIGHT","ROTATE_LONG_LEFT","ZOOM_IN","ZOOM_OUT","TOGGLE_AUTOROTATE","EVENTS","AUTOROTATE","BEFORE_RENDER","BEFORE_ROTATE","CLICK","CLOSE_PANEL","CONFIG_CHANGED","DOUBLE_CLICK","FULLSCREEN_UPDATED","HIDE_NOTIFICATION","HIDE_OVERLAY","HIDE_TOOLTIP","OPEN_PANEL","PANORAMA_LOADED","POSITION_UPDATED","READY","RENDER","SHOW_NOTIFICATION","SHOW_OVERLAY","SHOW_TOOLTIP","SIZE_UPDATED","STOP_ALL","ZOOM_UPDATED","CHANGE_EVENTS","GET_ANIMATE_POSITION","GET_ROTATE_POSITION","IDS","MENU","TWO_FINGERS","ERROR","EASINGS","linear","t","inQuad","outQuad","inOutQuad","inCubic","outCubic","inOutCubic","inQuart","outQuart","inOutQuart","inQuint","outQuint","inOutQuint","inSine","Math","cos","PI","outSine","sin","inOutSine","inExpo","pow","outExpo","inOutExpo","inCirc","sqrt","outCirc","inOutCirc","toggleClass","element","className","active","classList","currentClassName","getAttribute","currentActive","indexOf","regex","RegExp","undefined","length","replace","setAttribute","toggle","contains","add","remove","addClasses","split","forEach","name","removeClasses","hasParent","el","parent","test","parentNode","getClosest","selector","matches","msMatchesSelector","bind","SVGElement","parentElement","KEYMAP","MS_KEYMAP","Add","Del","Down","Esc","Left","Right","Spacebar","Subtract","Up","getEventKey","evt","key","keyCode","which","isFullscreenEnabled","elt","document","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","call","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","getStyle","prop","window","getComputedStyle","normalizeWheel","event","PIXEL_STEP","LINE_HEIGHT","PAGE_HEIGHT","spinX","spinY","pixelX","pixelY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","deltaY","deltaX","deltaMode","bound","x","min","max","isInteger","value","Number","isFinite","floor","sum","array","reduce","a","b","distance","p1","p2","y","getShortestArc","from","to","tCandidates","candidate","newCandidate","abs","Infinity","getAngle","position1","position2","acos","latitude","longitude","greatArcDistance","λ1","φ1","λ2","φ2","dasherize","str","s","i","toLowerCase","throttle","func","wait","self","args","result","timeout","previous","later","Date","now","apply","remaining","arguments","clearTimeout","setTimeout","isPlainObject","obj","Object","getPrototypeOf","proto","prototype","toString","deepmerge","target","src","first","merge","Array","isArray","e","keys","clone","isEmpty","constructor","each","object","callback","intersect","array1","array2","filter","PSVError","message","Error","captureStackTrace","stack","create","logWarn","console","warn","getXMPValue","data","attr","match","CSS_POSITIONS","top","bottom","left","right","center","parsePosition","tokens","toLocaleLowerCase","slice","xFirst","map","token","reverse","parsed","join","parseFloat","parseSpeed","speed","speedStr","trim","speedValue","speedUnit","THREE","degToRad","parseAngle","angle","zeroCenter","halfCircle","unit","isNaN","Animation","options","__cancelled","__resolved","__promise","Promise","resolve","reject","__resolve","__reject","easing","__start","delay","__delayTimeout","requestAnimationFrame","__run","timestamp","progress","duration","current","properties","start","end","onTick","then","onFulfilled","onRejected","p","cancel","catch","finally","onFinally","cancelAnimationFrame","AbstractComponent","psv","children","push","visible","container","createElement","appendChild","destroy","removeChild","childIdx","splice","child","refreshUi","every","uiRefresh","isVisible","hide","show","style","display","AbstractButton","navbar","collapsable","id","enabled","supported","collapsed","width","offsetWidth","icon","__setIcon","config","lang","title","addEventListener","onClick","stopPropagation","checkSupported","supportedOrObject","isSupported","initial","promise","toggleActive","iconActive","refresh","disable","enable","collapse","uncollapse","innerHTML","querySelector","AutorotateButton","on","off","handleEvent","type","toggleAutorotate","play","playActive","CustomButton","random","substr","content","DownloadButton","link","href","panorama","download","click","FullscreenButton","toggleFullscreen","fullscreenIn","fullscreenOut","HTML_BUTTON_DATA","buttons","menu","button","MenuButton","__hideMenu","__showMenu","panel","menuTemplate","noMargin","clickHandler","li","buttonId","dataset","getButton","menuIcon","SYSTEM","loaded","pixelRatio","isWebGLSupported","isTouchEnabled","maxTextureWidth","maxCanvasWidth","mouseWheelEvent","fullscreenEvent","load","ctx","getWebGLCtx","devicePixelRatio","getMaxTextureWidth","getMaxCanvasWidth","getMouseWheelEvent","getFullscreenEvent","canvas","names","context","getContext","some","listener","removeEventListener","getParameter","MAX_TEXTURE_SIZE","maxWidth","height","fillStyle","fillRect","getImageData","onmousewheel","FULLSCREEN_EVT_MAP","validExits","exit","AbstractZoomButton","buttondown","longPressTimeout","longPressAnimation","__onMouseUp","__onMouseDown","__startLongPressInterval","zoom","zoomLvl","zoomButtonIncrement","ZoomInButton","zoomIn","ZoomOutButton","zoomOut","ZoomRangeButton","mousedown","mediaMinWidth","zoomRange","zoomValue","parseInt","ready","__moveZoomValue","once","__stopZoomChange","__initZoomChangeWithMouse","__initZoomChangeByTouch","__changeZoomWithMouse","__changeZoomByTouch","size","level","__changeZoom","clientX","changedTouches","preventDefault","userInput","getBoundingClientRect","zoomLevel","DEFAULTS","caption","loadingImg","loadingTxt","fisheye","minFov","maxFov","defaultZoomLvl","defaultLong","defaultLat","sphereCorrection","pan","tilt","roll","moveSpeed","autorotateDelay","autorotateSpeed","autorotateLat","moveInertia","mousewheel","mousewheelSpeed","mousemove","captureCursor","touchmoveTwoFingers","useXmpData","panoData","withCredentials","autorotate","fullscreen","twoFingers","loadError","keyboard","plugins","READONLY_OPTIONS","CONFIG_PARSERS","plugin","getConfig","tempConfig","hasOwnProperty","CaptionButton","notification","info","NavbarCaption","contentVisible","contentWidth","setCaption","html","availableWidth","AVAILABLE_BUTTONS","registerButton","Navbar","setButtons","item","__cleanButtons","warnNotFound","totalWidth","visibleButtons","collapsableButtons","AbstractPlugin","EventEmitter","Loader","loader","clientWidth","tickness","lastChild","inner","round","maxHeight","setProgress","clearRect","lineWidth","strokeStyle","beginPath","arc","stroke","Notification","trigger","Overlay","contentId","dissmisable","image","text","subtext","PANEL_MIN_WIDTH","Panel","mouseX","mouseY","resizer","closeBtn","__onTouchStart","__onMouseMove","__onTouchMove","scrollTop","__startResize","__resize","touches","clientY","AbstractService","DataHelper","fovToZoomLevel","fov","temp","zoomLevelToFov","vFovToHFov","vFov","radToDeg","atan","tan","aspect","speedToDuration","textureCoordsToSphericalCoords","point","isCubemap","relativeX","croppedX","fullWidth","relativeY","croppedY","fullHeight","sphericalCoordsToTextureCoords","position","relativeLong","relativeLat","sphericalCoordsToVector3","vector3ToSphericalCoords","vector","phi","z","theta","atan2","viewerCoordsToVector3","viewerPoint","screen","renderer","raycaster","setFromCamera","camera","intersects","intersectObjects","scene","vector3ToViewerCoords","vectorClone","project","isExtendedPosition","key1","key2","cleanPosition","cleanSphereCorrection","EventsHandler","state","keyboardEnabled","moving","zooming","startMouseX","startMouseY","mouseHistory","pinchDist","dblclickData","dblclickTimeout","longtouchTimeout","twofingersTimeout","__onResize","autoSize","init","__onKeyDown","__onTouchEnd","__fullscreenToggled","__onMouseEnter","__onMouseLeave","__onMouseWheel","enableKeyboard","disableKeyboard","dLong","dLat","dZoom","action","rotate","hFov","__startMove","__stopMove","__move","__moveAbsolute","__click","__cancelLongTouch","__startMoveZoom","__stopMoveZoom","__cancelTwoFingersOverlay","overlay","gestureIcon","__moveZoom","delta","force","startKeyboardControl","stopKeyboardControl","stopAutorotate","stopAnimation","__logMouseMove","__stopMoveInertia","direction","norm","animationPromise","longtouch","boundingRect","rightclick","viewerX","viewerY","dataHelper","sphericalCoords","textureCoords","textureX","textureY","log","rotation","containerRect","Renderer","mainReqid","mesh","canvasContainer","cursor","setSize","__cleanTHREEScene","opacity","__renderLoop","needsUpdate","render","set","lookAt","copy","multiplyScalar","negate","updateProjectionMatrix","setTexture","textureData","texture","__createScene","material","dispose","setSphereCorrection","cleanCorrection","setPixelRatio","__createCubemap","__createSphere","domElement","scale","geometry","side","cubeSize","materials","transition","positionProvided","zoomProvided","transparent","verticalAxis","rotateOnWorldAxis","horizontalAxis","cross","getWorldDirection","normalize","latitudeRange","longitudeRange","traverse","TextureLoader","requests","abortLoading","loadTexture","newPanoData","tempPanorama","__loadCubemapTexture","__loadEquirectangularTexture","r","abort","__loadFile","url","onProgress","setWithCredentials","setResponseType","request","rIdx","lengthComputable","newProgress","total","err","XMLHttpRequest","__loadImage","img","createElementNS","onload","URL","revokeObjectURL","onerror","createObjectURL","__loadBlobAsString","blob","reader","FileReader","readAsText","__loadXMP","croppedWidth","croppedHeight","__createEquirectangularTexture","binary","substring","resizedPanoData","ratio","buffer","drawImage","minFilter","generateMipmaps","promises","__createCubemapTexture","all","preloadPanorama","LEFT_MAP","TOP_MAP","STATE","NONE","SHOWING","HIDING","Tooltip","pos","arrow","__onTransitionEnd","rect","move","tempPos","posClass","arrowTop","arrowLeft","__computeTooltipPosition","offset","newPos","propertyName","topBottom","box","TooltipRenderer","testTooltip","tooltip","Viewer","autorotateCb","loadingPromise","startTimeout","getElementById","textureLoader","eventsHandler","__resizeRefresh","resize","opts","setPanorama","startAutorotate","__stopAll","reason","getPlugin","pluginId","getPosition","getZoomLevel","getSize","isAutorotateEnabled","clientHeight","path","showLoader","hideError","done","showError","error","setOptions","setOption","option","last","elapsed","errorIcon","isDefaultPrevented","change","animate","animProperties","tOffset","newZoomLvl","dim","enterFullscreen"],"mappings":"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"}