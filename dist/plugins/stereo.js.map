{"version":3,"file":"stereo.js","sources":["../../three-examples/effects/StereoEffect.js","../../src/plugins/stereo/StereoButton.js","../../src/plugins/stereo/index.js"],"sourcesContent":["/**\n * @author alteredq / http://alteredqualia.com/\n * @authod mrdoob / http://mrdoob.com/\n * @authod arodic / http://aleksandarrodic.com/\n * @authod fonserbc / http://fonserbc.github.io/\n*/\n\nimport {\n\tStereoCamera,\n\tVector2\n} from \"../../../build/three.module.js\";\n\nvar StereoEffect = function ( renderer ) {\n\n\tvar _stereo = new StereoCamera();\n\t_stereo.aspect = 0.5;\n\tvar size = new Vector2();\n\n\tthis.setEyeSeparation = function ( eyeSep ) {\n\n\t\t_stereo.eyeSep = eyeSep;\n\n\t};\n\n\tthis.setSize = function ( width, height ) {\n\n\t\trenderer.setSize( width, height );\n\n\t};\n\n\tthis.render = function ( scene, camera ) {\n\n\t\tscene.updateMatrixWorld();\n\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\n\n\t\t_stereo.update( camera );\n\n\t\trenderer.getSize( size );\n\n\t\tif ( renderer.autoClear ) renderer.clear();\n\t\trenderer.setScissorTest( true );\n\n\t\trenderer.setScissor( 0, 0, size.width / 2, size.height );\n\t\trenderer.setViewport( 0, 0, size.width / 2, size.height );\n\t\trenderer.render( scene, _stereo.cameraL );\n\n\t\trenderer.setScissor( size.width / 2, 0, size.width / 2, size.height );\n\t\trenderer.setViewport( size.width / 2, 0, size.width / 2, size.height );\n\t\trenderer.render( scene, _stereo.cameraR );\n\n\t\trenderer.setScissorTest( false );\n\n\t};\n\n};\n\nexport { StereoEffect };\n","import { AbstractButton } from 'photo-sphere-viewer';\r\nimport StereoPlugin from './index';\r\nimport stereo from './stereo.svg';\r\n\r\n/**\r\n * @summary Navigation bar stereo button class\r\n * @extends PSV.buttons.AbstractButton\r\n * @memberof PSV.buttons\r\n */\r\nexport class StereoButton extends AbstractButton {\r\n\r\n  static id = 'stereo';\r\n  static icon = stereo;\r\n\r\n  /**\r\n   * @param {PSV.components.Navbar} navbar\r\n   */\r\n  constructor(navbar) {\r\n    super(navbar, 'psv-button--hover-scale psv-stereo-button', true);\r\n\r\n    /**\r\n     * @type {PSV.plugins.StereoPlugin}\r\n     * @private\r\n     * @readonly\r\n     */\r\n    this.plugin = this.psv.getPlugin(StereoPlugin.id);\r\n\r\n    if (this.plugin) {\r\n      this.plugin.on(StereoPlugin.EVENTS.STEREO_UPDATED, this);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  destroy() {\r\n    if (this.plugin) {\r\n      this.plugin.off(StereoPlugin.EVENTS.STEREO_UPDATED, this);\r\n    }\r\n\r\n    delete this.plugin;\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   */\r\n  isSupported() {\r\n    return !this.plugin ? false : { initial: false, promise: this.plugin.prop.isSupported };\r\n  }\r\n\r\n  /**\r\n   * @summary Handles events\r\n   * @param {Event} e\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    if (e.type === StereoPlugin.EVENTS.STEREO_UPDATED) {\r\n      this.toggleActive(e.args[0]);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @override\r\n   * @description Toggles stereo control\r\n   */\r\n  onClick() {\r\n    this.plugin.toggle();\r\n  }\r\n\r\n}\r\n","import { AbstractPlugin, CONSTANTS, DEFAULTS, PSVError, registerButton, utils } from 'photo-sphere-viewer';\r\nimport GyroscopePlugin from 'photo-sphere-viewer/dist/plugins/gyroscope';\r\nimport { StereoEffect } from 'three/examples/jsm/effects/StereoEffect';\r\nimport mobileRotateIcon from './mobile-rotate.svg';\r\nimport { StereoButton } from './StereoButton';\r\n\r\n\r\n/**\r\n * @typedef {Object} external:THREE.StereoEffect\r\n * @summary {@link https://github.com/mrdoob/three.js/blob/dev/examples/jsm/effects/StereoEffect.js}\r\n */\r\n\r\n/**\r\n * @external NoSleep\r\n * @description {@link https://github.com/richtr/NoSleep.js}\r\n */\r\n\r\n\r\n// add stereo button\r\nDEFAULTS.navbar.splice(-1, 0, StereoButton.id);\r\nDEFAULTS.lang[StereoButton.id] = 'Stereo view';\r\nregisterButton(StereoButton);\r\n\r\n// other lang strings\r\nDEFAULTS.lang.stereoNotification = 'Click anywhere to exit stereo view.';\r\nDEFAULTS.lang.pleaseRotate = ['Please rotate your device', '(or tap to continue)'];\r\n\r\n\r\n/**\r\n * @summary Adds stereo view on mobile devices\r\n * @extends PSV.plugins.AbstractPlugin\r\n * @memberof PSV.plugins\r\n */\r\nexport default class StereoPlugin extends AbstractPlugin {\r\n\r\n  static id = 'stereo';\r\n\r\n  /**\r\n   * @summary Identifier of the overlay \"please rotate your screen\"\r\n   * @type {string}\r\n   * @constant\r\n   */\r\n  static ID_OVERLAY_PLEASE_ROTATE = 'pleaseRotate';\r\n\r\n  /**\r\n   * @summary Available events\r\n   * @enum {string}\r\n   * @memberof PSV.plugins.StereoPlugin\r\n   * @constant\r\n   */\r\n  static EVENTS = {\r\n    STEREO_UPDATED: 'stereo-updated',\r\n  };\r\n\r\n  /**\r\n   * @param {PSV.Viewer} psv\r\n   */\r\n  constructor(psv) {\r\n    super(psv);\r\n\r\n    /**\r\n     * @type {PSV.plugins.GyroscopePlugin}\r\n     * @readonly\r\n     * @private\r\n     */\r\n    this.gyroscope = GyroscopePlugin ? psv.getPlugin(GyroscopePlugin) : null;\r\n\r\n    if (!this.gyroscope) {\r\n      throw new PSVError('Stereo plugin requires the Gyroscope plugin');\r\n    }\r\n\r\n    /**\r\n     * @member {Object}\r\n     * @protected\r\n     * @property {Promise<boolean>} isSupported - indicates of the gyroscope API is available\r\n     * @property {external:THREE.WebGLRenderer} renderer - original renderer\r\n     * @property {external:NoSleep} noSleep\r\n     */\r\n    this.prop = {\r\n      isSupported: this.gyroscope.prop.isSupported,\r\n      renderer   : null,\r\n      noSleep    : null,\r\n    };\r\n\r\n    /**\r\n     * @type {PSV.plugins.MarkersPlugin}\r\n     * @private\r\n     */\r\n    this.markers = this.psv.getPlugin('markers');\r\n\r\n    this.psv.on(CONSTANTS.EVENTS.STOP_ALL, this);\r\n    this.psv.on(CONSTANTS.EVENTS.CLICK, this);\r\n  }\r\n\r\n  /**\r\n   * @package\r\n   */\r\n  destroy() {\r\n    this.psv.off(CONSTANTS.EVENTS.STOP_ALL, this);\r\n    this.psv.off(CONSTANTS.EVENTS.CLICK, this);\r\n\r\n    this.stop();\r\n\r\n    super.destroy();\r\n  }\r\n\r\n  /**\r\n   * @private\r\n   */\r\n  handleEvent(e) {\r\n    switch (e.type) {\r\n      case CONSTANTS.EVENTS.STOP_ALL:\r\n      case CONSTANTS.EVENTS.CLICK:\r\n        this.stop();\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Checks if the stereo view is enabled\r\n   * @returns {boolean}\r\n   */\r\n  isEnabled() {\r\n    return !!this.prop.renderer;\r\n  }\r\n\r\n  /**\r\n   * @summary Enables the stereo view\r\n   * @description\r\n   *  - enables NoSleep.js\r\n   *  - enables full screen\r\n   *  - starts gyroscope controle\r\n   *  - hides markers, navbar and panel\r\n   *  - instanciate {@link external:THREE.StereoEffect}\r\n   * @returns {Promise}\r\n   * @fires PSV.plugins.StereoPlugin.stereo-updated\r\n   * @throws {PSV.PSVError} if the gyroscope API is not available/granted\r\n   */\r\n  start() {\r\n    // Need to be in the main event queue\r\n    this.psv.enterFullscreen();\r\n    this.__startNoSleep();\r\n    this.__lockOrientation();\r\n\r\n    return this.gyroscope.start().then(() => {\r\n      // switch renderer\r\n      this.prop.renderer = this.psv.renderer.renderer;\r\n      this.psv.renderer.renderer = new StereoEffect(this.psv.renderer.renderer);\r\n\r\n      this.psv.needsUpdate();\r\n\r\n      if (this.markers) {\r\n        this.markers.hide();\r\n      }\r\n      this.psv.navbar.hide();\r\n      this.psv.panel.hide();\r\n\r\n      /**\r\n       * @event stereo-updated\r\n       * @memberof PSV.plugins.StereoPlugin\r\n       * @summary Triggered when the stereo view is enabled/disabled\r\n       * @param {boolean} enabled\r\n       */\r\n      this.trigger(StereoPlugin.EVENTS.STEREO_UPDATED, true);\r\n\r\n      this.psv.notification.show({\r\n        content: this.psv.config.lang.stereoNotification,\r\n        timeout: 3000,\r\n      });\r\n    }, () => {\r\n      this.__unlockOrientation();\r\n      this.__stopNoSleep();\r\n      this.psv.exitFullscreen();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @summary Disables the stereo view\r\n   * @fires PSV.plugins.StereoPlugin.stereo-updated\r\n   */\r\n  stop() {\r\n    if (this.isEnabled()) {\r\n      this.psv.renderer.renderer = this.prop.renderer;\r\n      this.prop.renderer = null;\r\n\r\n      this.psv.needsUpdate();\r\n\r\n      if (this.markers) {\r\n        this.markers.show();\r\n      }\r\n      this.psv.navbar.show();\r\n\r\n      this.__unlockOrientation();\r\n      this.__stopNoSleep();\r\n      this.psv.exitFullscreen();\r\n      this.gyroscope.stop();\r\n\r\n      this.trigger(StereoPlugin.EVENTS.STEREO_UPDATED, false);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enables or disables the stereo view\r\n   */\r\n  toggle() {\r\n    if (this.isEnabled()) {\r\n      this.stop();\r\n    }\r\n    else {\r\n      this.start();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Enables NoSleep.js\r\n   * TODO WakeLock API when available https://web.dev/wakelock\r\n   * @private\r\n   */\r\n  __startNoSleep() {\r\n    if (!('NoSleep' in window)) {\r\n      utils.logWarn('NoSleep is not available');\r\n      return;\r\n    }\r\n\r\n    if (!this.prop.noSleep) {\r\n      this.prop.noSleep = new window.NoSleep();\r\n    }\r\n\r\n    this.prop.noSleep.enable();\r\n  }\r\n\r\n  /**\r\n   * @summary Disables NoSleep.js\r\n   * @private\r\n   */\r\n  __stopNoSleep() {\r\n    if (this.prop.noSleep) {\r\n      this.prop.noSleep.disable();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Tries to lock the device in landscape or display a message\r\n   * @private\r\n   */\r\n  __lockOrientation() {\r\n    let displayRotateMessageTimeout;\r\n\r\n    const displayRotateMessage = () => {\r\n      if (this.isEnabled() && window.innerHeight > window.innerWidth) {\r\n        this.psv.overlay.show({\r\n          id     : StereoPlugin.ID_OVERLAY_PLEASE_ROTATE,\r\n          image  : mobileRotateIcon,\r\n          text   : this.psv.config.lang.pleaseRotate[0],\r\n          subtext: this.psv.config.lang.pleaseRotate[1],\r\n        });\r\n      }\r\n\r\n      if (displayRotateMessageTimeout) {\r\n        clearTimeout(displayRotateMessageTimeout);\r\n        displayRotateMessageTimeout = null;\r\n      }\r\n    };\r\n\r\n    if (window.screen?.orientation) {\r\n      window.screen.orientation.lock('landscape').then(null, () => displayRotateMessage());\r\n      displayRotateMessageTimeout = setTimeout(() => displayRotateMessage(), 500);\r\n    }\r\n    else {\r\n      displayRotateMessage();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @summary Unlock the device orientation\r\n   * @private\r\n   */\r\n  __unlockOrientation() {\r\n    if (window.screen?.orientation) {\r\n      window.screen.orientation.unlock();\r\n    }\r\n    else {\r\n      this.psv.overlay.hide(StereoPlugin.ID_OVERLAY_PLEASE_ROTATE);\r\n    }\r\n  }\r\n\r\n}\r\n"],"names":["StereoEffect","renderer","_stereo","StereoCamera","aspect","size","Vector2","setEyeSeparation","eyeSep","setSize","width","height","render","scene","camera","updateMatrixWorld","parent","update","getSize","autoClear","clear","setScissorTest","setScissor","setViewport","cameraL","cameraR","StereoButton","navbar","plugin","psv","getPlugin","StereoPlugin","id","on","EVENTS","STEREO_UPDATED","destroy","off","isSupported","initial","promise","prop","handleEvent","e","type","toggleActive","args","onClick","toggle","AbstractButton","icon","stereo","DEFAULTS","splice","lang","registerButton","stereoNotification","pleaseRotate","gyroscope","GyroscopePlugin","PSVError","noSleep","markers","CONSTANTS","STOP_ALL","CLICK","stop","isEnabled","start","enterFullscreen","__startNoSleep","__lockOrientation","then","needsUpdate","hide","panel","trigger","notification","show","content","config","timeout","__unlockOrientation","__stopNoSleep","exitFullscreen","window","utils","logWarn","NoSleep","enable","disable","displayRotateMessageTimeout","displayRotateMessage","innerHeight","innerWidth","overlay","ID_OVERLAY_PLEASE_ROTATE","image","mobileRotateIcon","text","subtext","clearTimeout","screen","orientation","lock","setTimeout","unlock","AbstractPlugin"],"mappings":"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"}